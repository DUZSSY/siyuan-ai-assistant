# AI助手插件

**专注于文本块级 AI 编辑的思源笔记插件** —— 选中即编辑，所见即所得。

## ✨ 核心功能

- 📝 **文本块级 AI 编辑**：选中任意文本块，一键润色、翻译、总结
- 💬 **直接对话功能**：通过自然语言与AI对话，自定义修改文本
- 🤖 **多AI提供商支持**：OpenAI、Ollama、DeepSeek、Moonshot、智谱AI等
- ✨ **7种智能文本处理**：润色、翻译、总结、扩写、精简、改写、续写
- 🔧 **3个自定义按钮**：配置专属AI操作按钮和提示词
- 📊 **可视化 Diff 对比**：清晰展示修改内容（删除标红、新增标绿）
- 🎯 **精准文本替换**：精确定位，支持多相同字符场景
- 🎨 **智能浮动工具栏**：选中文本自动弹出，可拖拽、可置顶
- 🔒 **隐私优先**：API密钥本地存储，支持Ollama本地部署

## 🚀 快速开始

### 方式1：浮动工具栏（推荐）

1. 在思源笔记中选中任意文本
2. 浮动工具栏自动出现在选中文本附近
3. 点击需要的 AI 操作：
   - **快捷操作**：润色、翻译、总结、扩写、精简、改写、续写
   - **💬 对话**：打开对话界面，用自然语言指令修改文本
   - **自定义按钮**：你配置的专属AI操作
4. 在 Diff 弹窗中查看修改，确认后应用

**Diff 查看器功能**：
- 逐条接受/拒绝修改，或一键应用全部
- 直接编辑修改后的内容再应用
- 根据自定义要求重新生成

**对话模式**：
- 输入自然语言指令（如"精简一下"、"增加技术细节"）
- 查看历史对话，恢复之前的会话
- 界面内置快捷操作按钮

### 方式2：右键菜单

1. 右键点击块图标
2. 选择 AI 操作
3. 查看 Diff 对比，确认后应用

### 方式3：对话面板

1. 点击浮动工具栏上的"💬 对话"按钮
2. 输入自然语言修改要求
3. 在 Diff 查看器中查看结果并应用

## ⚙️ 配置指南

### 推荐：Ollama 本地部署（完全免费，隐私最佳）

1. 安装 [Ollama](https://ollama.com)
2. 拉取模型：
   ```bash
   ollama pull llama3.2
   # 或
   ollama pull qwen2.5
   ```
3. 插件设置中选择 Ollama 提供商
4. 使用默认配置即可（API地址：http://localhost:11434）

**🌐 免费云模型推荐**（无需本地部署，截止2026年2月14日可用）：
- **GPT-OSS 120B** - OpenAI开源大模型
- **Qwen3** - 通义千问最新版本
- **GLM-5** - 智谱AI新一代模型
- **Gemini 3 Flash** - Google轻量级快速模型

> 💡 这些云模型可通过兼容OpenAI API的服务使用，具体配置请参考各提供商文档。

### 其他AI提供商

支持以下AI服务：
- **OpenAI** (GPT-5.2 Instant ⭐推荐 / GPT-5.2 Thinking / GPT-5.2 Pro)
- **Claude** (Claude Sonnet 4.5 ⭐推荐 / Claude Opus 4.6)
- **DeepSeek** (DeepSeek-V3.2 / DeepSeek-R1)
- **Moonshot (Kimi)** (Kimi K2.5)
- **智谱AI (Z.ai)** (GLM-4-Flash ⭐免费额度 / GLM-4.7 / GLM-5)
- **自定义 OpenAI 兼容 API** (支持任何OpenAI API格式的服务)

**💡 模型选择建议：**
- **日常使用（润色/翻译/对话）**：GPT-5.2 Instant、Claude Sonnet 4.5、GLM-4-Flash（免费额度）
- **专业写作/复杂推理**：GPT-5.2 Thinking、Claude Opus 4.6、GLM-5
- **极致性能/代码任务**：GPT-5.2 Pro、Kimi K2.5

在插件设置中添加对应API密钥即可使用。

### 工具栏配置

自定义浮动工具栏中显示的按钮：

1. 打开插件设置 → **工具栏** 标签页
2. 启用/禁用标准操作按钮（润色、翻译等）
3. 在"自定义提示词"标签页配置的按钮会自动同步到这里

### 自定义按钮配置

创建最多3个个性化的AI操作按钮：

1. 打开插件设置 → **自定义提示词** 标签页
2. 启用并配置每个自定义按钮：
   - **按钮名称**：显示名称（如"转表格"）
   - **图标**：Emoji图标（如📊）
   - **AI提示词**：给AI的指令（如"将以下内容转换成表格形式"）
3. 保存后会自动同步到浮动工具栏

**💡 关于 Claude 支持**
Claude 通过 OpenAI API 兼容接口提供支持，配置方法：
- API 地址: `https://api.anthropic.com/v1`
- 模型: `claude-3-sonnet-20240229` 或 `claude-3-opus-20240229`
- 需申请 Anthropic API Key

## ⚠️ 免责声明

**使用本插件前，请仔细阅读以下声明：**

1. **AI生成内容风险**：本插件使用AI技术生成内容，AI结果可能不准确、不完整或存在错误。插件开发者不对AI生成内容的准确性、可靠性或适用性承担任何责任。

2. **数据丢失风险**：插件操作可能修改或删除您的笔记内容。虽然我们已经尽力确保操作安全，但仍存在因软件缺陷、网络问题或其他不可预见因素导致数据丢失的风险。**建议您在使用前备份重要数据**。

3. **谨慎操作**：使用"应用修改"功能前，请仔细核对AI生成的内容。一旦应用修改，原始内容将被替换。

4. **API提供商责任**：使用第三方AI服务（如OpenAI、DeepSeek等）时，请遵守相应服务条款。插件不对第三方服务的可用性、响应质量或隐私政策负责。

5. **本地化部署建议**：为保护数据隐私，建议优先使用 **Ollama本地部署**，这样所有数据都在本地处理，不会传输到外部服务器。

**使用本插件即表示您已了解并接受上述风险。**

## 🛡️ 隐私说明

- ✅ API密钥仅本地存储，不会上传到任何服务器
- ✅ 支持本地Ollama部署，数据完全本地处理
- ✅ 可选敏感信息自动脱敏
- ✅ 开源代码，可审计

## 📝 近期更新

### v0.1.17
- 💬 **新增：直接对话功能** — 在原有快捷按钮基础上增加独立对话界面
  - "💬 对话"按钮显示在最右侧并带分隔符，与其他功能清晰区分
  - 支持通过自然语言指令进行实时智能文本修改
  - 对话历史记录功能，支持持久化存储多轮对话
  - 智能输入框，支持自定义提示词和历史记录快速填充
- 🔗 优化连接稳定性和显示效果
- ⚡ 加速结果显示速度，体验更流畅

### v0.1.16
- ⏱️ 超时时间从60秒增加到180秒，支持大模型
- 📝 默认 max_tokens 从2048增加到4096，避免文本截断
- 🏷️ 修复 DiffViewer 标题显示，现在正确显示自定义按钮名称
- ⚠️ 增加详细错误提示（超时、网络、认证、频率限制等）
- 🔧 修复自定义按钮空 prompt 处理问题
- 🛡️ 自定义按钮配置增加非空校验
- 📜 修复模型列表过长时的滚动问题

### v0.1.15
- ✨ 新增移动端代理支持，可在平板、手机等设备使用（已在华为MatePad测试）
- ✨ 扩展支持的平台：后端增加 android、ios；前端增加 browser-mobile、mobile
- 🐛 修复自定义按钮无法读取选中文字的问题
- ⚠️ 移动设备建议使用AI提供商的API服务；Ollama局域网部署需注意CORS配置

[查看完整更新日志](https://github.com/DUZSSY/siyuan-ai-assistant/blob/main/CHANGELOG.md)

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🔗 相关链接

- [GitHub 仓库](https://github.com/DUZSSY/siyuan-ai-assistant)
- [思源笔记官网](https://b3log.org/siyuan)
- [思源社区](https://ld246.com/tags/siyuan)

---

## 💝 支持开发

如果本插件对你有帮助，欢迎打赏支持作者继续开发和维护！

[![打赏支持](https://img.shields.io/badge/❤️-打赏支持-red)](https://www.yuque.com/duzssy/mop740/fm59mkeo86fx5mu9?singleDoc)

您的支持是我持续改进插件的动力！❤️
