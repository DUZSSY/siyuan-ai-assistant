# AI助手插件

**专注于文本块级 AI 编辑的思源笔记插件** —— 选中即编辑，所见即所得。

## ✨ 核心功能

- 📝 **文本块级 AI 编辑**：选中任意文本块，一键润色、翻译、总结
- 🤖 **多AI提供商支持**：OpenAI、Ollama、DeepSeek、Moonshot、智谱AI等
- ✨ **7种智能文本处理**：润色、翻译、总结、扩写、精简、改写、续写
- 📊 **可视化 Diff 对比**：清晰展示修改内容（删除标红、新增标绿）
- 🎯 **精准文本替换**：精确定位，支持多相同字符场景
- 🎨 **智能浮动工具栏**：选中文本自动弹出，可拖拽、可置顶
- 🔒 **隐私优先**：API密钥本地存储，支持Ollama本地部署

## 🌟 为什么选择本插件？

### 1️⃣ **专注于文本块级 AI 编辑** ⭐⭐⭐⭐⭐

与其他 AI 插件不同，本插件**专为思源笔记的文本块设计**：

- 📝 **块级操作**：直接对思源笔记的文本块进行 AI 处理
- 🎯 **精准替换**：智能识别文本位置，精确替换选中的内容
- 📊 **Diff 对比**：应用前清晰查看 AI 修改了哪些内容
- ✏️ **可编辑**：对 AI 结果不满意？直接编辑后再应用
- 🔄 **可撤销**：随时重新生成或取消操作

### 2️⃣ **可拖拽、可置顶的浮动工具栏** ⭐⭐⭐⭐⭐

- 🖱️ **自由拖拽**：按住标题栏可拖动到任意位置，不遮挡选中文本
- 📌 **置顶固定**：点击 📌 按钮固定位置，工具栏不会自动消失
- 🎨 **智能避让**：自动计算最佳显示位置，优先显示在选中文本上方
- ⚡ **快捷操作**：选中文本即弹出，无需点击菜单

### 3️⃣ **多方式交互**

- ✨ **浮动工具栏**：选中文本自动弹出，最常用
- 🎯 **右键菜单**：右键块图标，选择 AI 操作
- 📝 **自定义提示词**：支持 3 组自定义 AI 操作按钮

### 4️⃣ **隐私保护**
- 🏠 **Ollama本地部署推荐**：所有数据处理都在本地完成

## 🚀 快速开始

### 方式1：浮动工具栏（推荐）
1. 在思源笔记中选中任意文本
2. 浮动工具栏自动出现在选中文本附近
3. 点击需要的 AI 操作（润色/翻译/总结等）
4. 在 Diff 弹窗中查看修改，确认后应用

### 方式2：右键菜单
1. 右键点击块图标
2. 选择 AI 操作
3. 查看 Diff 对比，确认后应用

## ⚙️ 配置指南

### 推荐：Ollama 本地部署（完全免费，隐私最佳）

1. 安装 [Ollama](https://ollama.com)
2. 拉取模型：
   ```bash
   ollama pull llama3.2
   # 或
   ollama pull qwen2.5
   ```
3. 插件设置中选择 Ollama 提供商
4. 使用默认配置即可（API地址：http://localhost:11434）

### 其他AI提供商

支持以下AI服务：
- **OpenAI** (GPT-3.5/4)
- **DeepSeek**
- **Moonshot (Kimi)**
- **智谱AI (GLM)**
- **自定义 OpenAI 兼容 API**

在插件设置中添加对应API密钥即可使用。

## 📖 使用说明

### 基础使用流程

1. **选中文本**
   - 在思源笔记编辑器中，用鼠标选中任意文本内容
   - 浮动工具栏会自动出现在选中文本附近

2. **选择 AI 操作**
   - 在浮动工具栏中选择需要的操作：
     - ✨ 润色：优化文本表达
     - 🌐 翻译：翻译成其他语言
     - 📝 总结：提取关键信息
     - 📖 扩写：增加内容细节
     - 📄 精简：去除冗余内容
     - ✏️ 改写：调整写作风格
     - ➡️ 续写：继续后续内容

3. **查看 Diff 对比**
   - AI 处理完成后会弹出 Diff 对比窗口
   - 左侧显示原文，右侧显示修改后的内容
   - 删除的内容标记为红色，新增的内容标记为绿色

4. **编辑和确认**
   - 点击"✏️ 直接编辑"可以手动修改 AI 结果
   - 点击"🔄 重新生成"可以让 AI 重新处理
   - 点击"✓ 应用修改"将修改应用到笔记中
   - 点击"取消"放弃本次操作

### 浮动工具栏使用技巧

- **📌 置顶固定**：点击置顶按钮，工具栏会保持显示，不会自动消失
- **🖱️ 拖拽移动**：按住工具栏标题栏可以拖动到任意位置
- **⚙️ 切换模型**：点击显示的名称（如"Ollama : llama3.2"）可以快速切换 AI 模型
- **✕ 关闭**：点击关闭按钮隐藏工具栏

### 右键菜单使用

1. 在任意文本块上右键点击块图标
2. 在菜单中选择"AI助手"
3. 选择需要的操作

### 自定义操作按钮

在插件设置中可以配置 3 个自定义操作按钮：
1. 打开设置（点击工具栏上的 ⚙️ 按钮）
2. 在"自定义按钮"标签页中配置
3. 输入按钮名称、图标和提示词
4. 保存后即可在工具栏中使用

## 🎮 使用技巧

### 文本块级 AI 编辑流程
1. **选中文本**：在思源笔记中选中任意文本块
2. **选择操作**：使用浮动工具栏或右键菜单选择 AI 操作
3. **查看对比**：在 Diff 弹窗中查看 AI 修改（删除标红、新增标绿）
4. **编辑调整**：对结果不满意？直接在修改后区域编辑
5. **确认应用**：点击"✓ 应用修改"完成编辑

### 浮动工具栏操作
- **拖拽**：按住标题栏拖动到任意位置
- **置顶**：点击 📌 按钮固定位置，不会自动消失
- **切换模型**：点击提供商名称快速切换
- **关闭**：点击 ✕ 按钮

## ⚠️ 免责声明

**使用本插件前，请仔细阅读以下声明：**

1. **AI生成内容风险**：本插件使用AI技术生成内容，AI结果可能不准确、不完整或存在错误。插件开发者不对AI生成内容的准确性、可靠性或适用性承担任何责任。

2. **数据丢失风险**：插件操作可能修改或删除您的笔记内容。虽然我们已经尽力确保操作安全，但仍存在因软件缺陷、网络问题或其他不可预见因素导致数据丢失的风险。**建议您在使用前备份重要数据**。

3. **谨慎操作**：使用"应用修改"功能前，请仔细核对AI生成的内容。一旦应用修改，原始内容将被替换。

4. **API提供商责任**：使用第三方AI服务（如OpenAI、DeepSeek等）时，请遵守相应服务条款。插件不对第三方服务的可用性、响应质量或隐私政策负责。

5. **本地化部署建议**：为保护数据隐私，建议优先使用 **Ollama本地部署**，这样所有数据都在本地处理，不会传输到外部服务器。

**使用本插件即表示您已了解并接受上述风险。**

## 🛡️ 隐私说明

- ✅ API密钥仅本地存储，不会上传到任何服务器
- ✅ 支持本地Ollama部署，数据完全本地处理
- ✅ 可选敏感信息自动脱敏
- ✅ 开源代码，可审计

## 📝 更新日志

### v0.1.8
- 🐛 更新插件图片以符合市场要求
- 🐛 修复 icon.png 和 preview.png 尺寸问题
- 🐛 更新描述和文档
- 📝 版本号更新（0.1.7 → 0.1.8）

### v0.1.7
- 🐛 更新插件图片以符合市场要求
- 🐛 修复 icon.png 和 preview.png 尺寸问题
- 🐛 更新描述和文档
- 📝 版本号更新（0.1.6 → 0.1.7）

### v0.1.6
- 🐛 修复浮动工具栏在禁用后仍可唤起的 Bug
- 🐛 修复右键菜单不显示的问题
- 🐛 修复 ContextMenuManager 缺少 destroy 方法导致的错误
- 🐛 修复浮动工具栏事件监听器泄露导致的重复工具栏问题
- 🐛 修复 eventBus 监听器未正确移除的问题
- 🐛 修复 uninstall 方法使用错误的存储键名
- 🐛 移除所有调试日志（45处）
- 🐛 清理打包的多余文件 icon.png.txt
- 📝 版本号遵循 semver 规范（0.1.5.1 → 0.1.6）

### v0.1.5
- ✨ 新增浮动工具栏拖拽和置顶功能
- ✨ 优化选中文本替换精度（支持多相同字符定位）
- ✨ Diff弹窗原文显示优化
- 🐛 修复多个稳定性问题

### v0.1.0
- 🎉 初始版本发布
- 支持多AI提供商
- 基础文本处理功能
- 对话式交互

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🔗 相关链接

- [GitHub 仓库](https://github.com/DUZSSY/siyuan-ai-assistant)
- [思源笔记官网](https://b3log.org/siyuan)
- [思源社区](https://ld246.com/tags/siyuan)
