"use strict";var il=Object.defineProperty;var al=(s,e,t)=>e in s?il(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var V=(s,e,t)=>al(s,typeof e!="symbol"?e+"":e,t);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Oi=require("siyuan");function ze(){}function Fi(s){return s()}function Sr(){return Object.create(null)}function Ee(s){s.forEach(Fi)}function tn(s){return typeof s=="function"}function ks(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function ll(s){return Object.keys(s).length===0}function d(s,e){s.appendChild(e)}function U(s,e,t){s.insertBefore(e,t||null)}function j(s){s.parentNode&&s.parentNode.removeChild(s)}function Qe(s,e){for(let t=0;t<s.length;t+=1)s[t]&&s[t].d(e)}function w(s){return document.createElement(s)}function q(s){return document.createTextNode(s)}function A(){return q(" ")}function Li(){return q("")}function O(s,e,t,n){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t,n)}function g(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function In(s){return s===""?null:+s}function ol(s){return Array.from(s.childNodes)}function Y(s,e){e=""+e,s.data!==e&&(s.data=e)}function te(s,e){s.value=e??""}function ce(s,e,t){s.classList.toggle(e,!!t)}function cl(s,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:n})}let Yt;function Xt(s){Yt=s}function Bi(){if(!Yt)throw new Error("Function called outside component initialization");return Yt}function Ss(s){Bi().$$.on_mount.push(s)}function ul(){const s=Bi();return(e,t,{cancelable:n=!1}={})=>{const r=s.$$.callbacks[e];if(r){const i=cl(e,t,{cancelable:n});return r.slice().forEach(a=>{a.call(s,i)}),!i.defaultPrevented}return!0}}const Rt=[],as=[];let Ft=[];const Cr=[],xi=Promise.resolve();let ls=!1;function Ni(){ls||(ls=!0,xi.then(ji))}function hl(){return Ni(),xi}function os(s){Ft.push(s)}const Kn=new Set;let Et=0;function ji(){if(Et!==0)return;const s=Yt;do{try{for(;Et<Rt.length;){const e=Rt[Et];Et++,Xt(e),fl(e.$$)}}catch(e){throw Rt.length=0,Et=0,e}for(Xt(null),Rt.length=0,Et=0;as.length;)as.pop()();for(let e=0;e<Ft.length;e+=1){const t=Ft[e];Kn.has(t)||(Kn.add(t),t())}Ft.length=0}while(Rt.length);for(;Cr.length;)Cr.pop()();ls=!1,Kn.clear(),Xt(s)}function fl(s){if(s.fragment!==null){s.update(),Ee(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(os)}}function dl(s){const e=[],t=[];Ft.forEach(n=>s.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ft=e}const ml=new Set;function pl(s,e){s&&s.i&&(ml.delete(s),s.i(e))}function ue(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function gl(s,e,t){const{fragment:n,after_update:r}=s.$$;n&&n.m(e,t),os(()=>{const i=s.$$.on_mount.map(Fi).filter(tn);s.$$.on_destroy?s.$$.on_destroy.push(...i):Ee(i),s.$$.on_mount=[]}),r.forEach(os)}function _l(s,e){const t=s.$$;t.fragment!==null&&(dl(t.after_update),Ee(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function bl(s,e){s.$$.dirty[0]===-1&&(Rt.push(s),Ni(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function Cs(s,e,t,n,r,i,a=null,l=[-1]){const o=Yt;Xt(s);const c=s.$$={fragment:null,ctx:[],props:i,update:ze,not_equal:r,bound:Sr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:Sr(),dirty:l,skip_bound:!1,root:e.target||o.$$.root};a&&a(c.root);let u=!1;if(c.ctx=t?t(s,e.props||{},(h,f,...m)=>{const p=m.length?m[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=p)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](p),u&&bl(s,h)),f}):[],c.update(),u=!0,Ee(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const h=ol(e.target);c.fragment&&c.fragment.l(h),h.forEach(j)}else c.fragment&&c.fragment.c();e.intro&&pl(s.$$.fragment),gl(s,e.target,e.anchor),ji()}Xt(o)}class Es{constructor(){V(this,"$$");V(this,"$$set")}$destroy(){_l(this,1),this.$destroy=ze}$on(e,t){if(!tn(t))return ze;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!ll(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const wl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wl);const cs="RFC3986",us={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},vl="RFC1738",yl=Array.isArray,Je=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),Gn=1024,kl=(s,e,t,n,r)=>{if(s.length===0)return s;let i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(l){return"%26%23"+parseInt(l.slice(2),16)+"%3B"});let a="";for(let l=0;l<i.length;l+=Gn){const o=i.length>=Gn?i.slice(l,l+Gn):i,c=[];for(let u=0;u<o.length;++u){let h=o.charCodeAt(u);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||r===vl&&(h===40||h===41)){c[c.length]=o.charAt(u);continue}if(h<128){c[c.length]=Je[h];continue}if(h<2048){c[c.length]=Je[192|h>>6]+Je[128|h&63];continue}if(h<55296||h>=57344){c[c.length]=Je[224|h>>12]+Je[128|h>>6&63]+Je[128|h&63];continue}u+=1,h=65536+((h&1023)<<10|o.charCodeAt(u)&1023),c[c.length]=Je[240|h>>18]+Je[128|h>>12&63]+Je[128|h>>6&63]+Je[128|h&63]}a+=c.join("")}return a};function Sl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Er(s,e){if(yl(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Cl=Object.prototype.hasOwnProperty,zi={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Xe=Array.isArray,El=Array.prototype.push,Ui=function(s,e){El.apply(s,Xe(e)?e:[e])},Al=Date.prototype.toISOString,pe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:kl,encodeValuesOnly:!1,format:cs,formatter:us[cs],indices:!1,serializeDate(s){return Al.call(s)},skipNulls:!1,strictNullHandling:!1};function Pl(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const Qn={};function $i(s,e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y){let v=s,E=y,k=0,P=!1;for(;(E=E.get(Qn))!==void 0&&!P;){const F=E.get(s);if(k+=1,typeof F<"u"){if(F===k)throw new RangeError("Cyclic object value");P=!0}typeof E.get(Qn)>"u"&&(k=0)}if(typeof c=="function"?v=c(e,v):v instanceof Date?v=f==null?void 0:f(v):t==="comma"&&Xe(v)&&(v=Er(v,function(F){return F instanceof Date?f==null?void 0:f(F):F})),v===null){if(i)return o&&!_?o(e,pe.encoder,b,"key",m):e;v=""}if(Pl(v)||Sl(v)){if(o){const F=_?e:o(e,pe.encoder,b,"key",m);return[(p==null?void 0:p(F))+"="+(p==null?void 0:p(o(v,pe.encoder,b,"value",m)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(v)))]}const C=[];if(typeof v>"u")return C;let S;if(t==="comma"&&Xe(v))_&&o&&(v=Er(v,o)),S=[{value:v.length>0?v.join(",")||null:void 0}];else if(Xe(c))S=c;else{const F=Object.keys(v);S=u?F.sort(u):F}const M=l?String(e).replace(/\./g,"%2E"):String(e),R=n&&Xe(v)&&v.length===1?M+"[]":M;if(r&&Xe(v)&&v.length===0)return R+"[]";for(let F=0;F<S.length;++F){const I=S[F],T=typeof I=="object"&&typeof I.value<"u"?I.value:v[I];if(a&&T===null)continue;const D=h&&l?I.replace(/\./g,"%2E"):I,L=Xe(v)?typeof t=="function"?t(R,D):R:R+(h?"."+D:"["+D+"]");y.set(s,k);const x=new WeakMap;x.set(Qn,y),Ui(C,$i(T,L,t,n,r,i,a,l,t==="comma"&&_&&Xe(v)?null:o,c,u,h,f,m,p,_,b,x))}return C}function Dl(s=pe){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||pe.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=cs;if(typeof s.format<"u"){if(!Cl.call(us,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=us[t];let r=pe.filter;(typeof s.filter=="function"||Xe(s.filter))&&(r=s.filter);let i;if(s.arrayFormat&&s.arrayFormat in zi?i=s.arrayFormat:"indices"in s?i=s.indices?"indices":"repeat":i=pe.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:pe.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:pe.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:pe.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:pe.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?pe.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:pe.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:pe.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:pe.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:pe.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:pe.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:pe.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:pe.strictNullHandling}}function Il(s,e={}){let t=s;const n=Dl(e);let r,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):Xe(n.filter)&&(i=n.filter,r=i);const a=[];if(typeof t!="object"||t===null)return"";const l=zi[n.arrayFormat],o=l==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const c=new WeakMap;for(let f=0;f<r.length;++f){const m=r[f];n.skipNulls&&t[m]===null||Ui(a,$i(t[m],m,l,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=a.join(n.delimiter);let h=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}const Tt="4.104.0";let Ar=!1,Kt,Hi,Wi,hs,Vi,qi,Ji,Xi,Ki;function Rl(s,e={auto:!1}){if(Ar)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(Kt)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${Kt}'\``);Ar=e.auto,Kt=s.kind,Hi=s.fetch,Wi=s.FormData,hs=s.File,Vi=s.ReadableStream,qi=s.getMultipartRequestOptions,Ji=s.getDefaultAgent,Xi=s.fileFromPath,Ki=s.isFsReadStream}class Tl{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Ml({manuallyImported:s}={}){const e=s?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,r,i;try{t=fetch,n=Request,r=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:r,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,l)=>({...l,body:new Tl(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const Gi=()=>{Kt||Rl(Ml(),{auto:!0})};Gi();class z extends Error{}class ye extends z{constructor(e,t,n,r){super(`${ye.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Ln({message:n,cause:ds(t)});const i=t==null?void 0:t.error;return e===400?new Qi(e,i,n,r):e===401?new Yi(e,i,n,r):e===403?new Zi(e,i,n,r):e===404?new ea(e,i,n,r):e===409?new ta(e,i,n,r):e===422?new na(e,i,n,r):e===429?new sa(e,i,n,r):e>=500?new ra(e,i,n,r):new ye(e,i,n,r)}}class je extends ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ln extends ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class As extends Ln{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Qi extends ye{}class Yi extends ye{}class Zi extends ye{}class ea extends ye{}class ta extends ye{}class na extends ye{}class sa extends ye{}class ra extends ye{}class ia extends z{constructor(){super("Could not parse response content as the length limit was reached")}}class aa extends z{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var dn=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},bt=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},xe;class Bn{constructor(){xe.set(this,void 0),this.buffer=new Uint8Array,dn(this,xe,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let i;for(;(i=Ol(this.buffer,bt(this,xe,"f")))!=null;){if(i.carriage&&bt(this,xe,"f")==null){dn(this,xe,i.index,"f");continue}if(bt(this,xe,"f")!=null&&(i.index!==bt(this,xe,"f")+1||i.carriage)){r.push(this.decodeText(this.buffer.slice(0,bt(this,xe,"f")-1))),this.buffer=this.buffer.slice(bt(this,xe,"f")),dn(this,xe,null,"f");continue}const a=bt(this,xe,"f")!==null?i.preceding-1:i.preceding,l=this.decodeText(this.buffer.slice(0,a));r.push(l),this.buffer=this.buffer.slice(i.index),dn(this,xe,null,"f")}return r}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new z(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new z(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new z("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}xe=new WeakMap;Bn.NEWLINE_CHARS=new Set([`
`,"\r"]);Bn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ol(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Fl(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}function la(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Ge{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of Ll(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let l;try{l=JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(l&&l.error)throw new ye(void 0,l.error,void 0,ma(e.headers));yield l}else{let l;try{l=JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event=="error")throw new ye(void 0,l.error,l.message,void 0);yield{event:a.event,data:l}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Ge(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const a=new Bn,l=la(e);for await(const o of l)for(const c of a.decode(o))yield c;for(const o of a.flush())yield o}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const l of r())a||l&&(yield JSON.parse(l));a=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{a||t.abort()}}return new Ge(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Ge(()=>r(e),this.controller),new Ge(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Vi({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const l=n.encode(JSON.stringify(i)+`
`);r.enqueue(l)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*Ll(s,e){if(!s.body)throw e.abort(),new z("Attempted to iterate over a response with no body");const t=new xl,n=new Bn,r=la(s.body);for await(const i of Bl(r))for(const a of n.decode(i)){const l=t.decode(a);l&&(yield l)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*Bl(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let i;for(;(i=Fl(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class xl{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Nl(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Nl(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}const oa=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",ca=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&xn(s),xn=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",jl=s=>ca(s)||oa(s)||Ki(s);async function ua(s,e,t){var r;if(s=await s,ca(s))return s;if(oa(s)){const i=await s.blob();e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=xn(i)?[await i.arrayBuffer()]:[i];return new hs(a,e,t)}const n=await zl(s);if(e||(e=$l(s)??"unknown_file"),!(t!=null&&t.type)){const i=(r=n[0])==null?void 0:r.type;typeof i=="string"&&(t={...t,type:i})}return new hs(n,e,t)}async function zl(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(xn(s))e.push(await s.arrayBuffer());else if(Hl(s))for await(const n of s)e.push(n);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${Ul(s)}`);return e}function Ul(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function $l(s){var e;return Yn(s.name)||Yn(s.filename)||((e=Yn(s.path))==null?void 0:e.split(/[\\/]/).pop())}const Yn=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},Hl=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Pr=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody",St=async s=>{const e=await Wl(s.body);return qi(e,s)},Wl=async s=>{const e=new Wi;return await Promise.all(Object.entries(s||{}).map(([t,n])=>fs(e,t,n))),e},fs=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(jl(t)){const n=await ua(t);s.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>fs(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>fs(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Vl=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},ql=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},mn;Gi();async function ha(s){var a;const{response:e}=s;if(s.options.stream)return ht("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):Ge.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(a=t==null?void 0:t.split(";")[0])==null?void 0:a.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const l=await e.json();return ht("response",e.status,e.url,e.headers,l),fa(l,e)}const i=await e.text();return ht("response",e.status,e.url,e.headers,i),i}function fa(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Nn extends Promise{constructor(e,t=ha){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Nn(this.responsePromise,async t=>fa(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Jl{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=Zn("maxRetries",t),this.timeout=Zn("timeout",n),this.httpAgent=r,this.fetch=i??Hi}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Yl(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${no()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async r=>{const i=r&&xn(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:t,...r,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var _;const n={...e},{method:r,path:i,query:a,headers:l={}}=n,o=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Pr(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(o),u=this.buildURL(i,a);"timeout"in n&&Zn("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const h=n.httpAgent??this.httpAgent??Ji(u),f=n.timeout+1e3;typeof((_=h==null?void 0:h.options)==null?void 0:_.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),l[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:n,headers:l,contentLength:c,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...h&&{agent:h},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Tr(i,a),Tr(i,t),Pr(e.body)&&Kt!=="node"&&delete i["content-type"],gn(a,"x-stainless-retry-count")===void 0&&gn(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(r)),gn(a,"x-stainless-timeout")===void 0&&gn(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return ye.generate(e,t,n,r)}request(e,t=null){return new Nn(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const n=await e,r=n.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(n);const{req:i,url:a,timeout:l}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(i,{url:a,options:n}),ht("request",a,n,i.headers),(h=n.signal)!=null&&h.aborted)throw new je;const o=new AbortController,c=await this.fetchWithTimeout(a,i,l,o).catch(ds);if(c instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new je;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new As:new Ln({cause:c})}const u=ma(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const v=`retrying, ${t} attempts remaining`;return ht(`response (error; ${v})`,c.status,a,u),this.retryRequest(n,t,u)}const m=await c.text().catch(v=>ds(v).message),p=Zl(m),_=p?void 0:m;throw ht(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,_),this.makeStatusError(c.status,p,_,u)}return{response:c,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Xl(this,n,e)}buildURL(e,t){const n=to(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return pa(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new z(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>r.abort());const l=setTimeout(()=>r.abort(),n),o={signal:r.signal,...a};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally(()=>{clearTimeout(l)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let r;const i=n==null?void 0:n["retry-after-ms"];if(i){const l=parseFloat(i);Number.isNaN(l)||(r=l)}const a=n==null?void 0:n["retry-after"];if(a&&!r){const l=parseFloat(a);Number.isNaN(l)?r=Date.parse(a)-Date.now():r=l*1e3}if(!(r&&0<=r&&r<60*1e3)){const l=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,l)}return await nn(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return a*l*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Tt}`}}class da{constructor(e,t,n,r){mn.set(this,void 0),Vl(this,mn,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new z("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[r,i]of n)e.url.searchParams.set(r,i);t.query=void 0,t.path=e.url.toString()}return await ql(this,mn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(mn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Xl extends Nn{constructor(e,t,n){super(t,async r=>new n(e,r.response,await ha(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ma=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Kl={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ie=s=>typeof s=="object"&&s!==null&&!pa(s)&&Object.keys(s).every(e=>ga(Kl,e)),Gl=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":Ir(Deno.build.os),"X-Stainless-Arch":Dr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":Ir(process.platform),"X-Stainless-Arch":Dr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const s=Ql();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Ql(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${r}.${i}.${a}`}}}return null}const Dr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Ir=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Rr;const Yl=()=>Rr??(Rr=Gl()),Zl=s=>{try{return JSON.parse(s)}catch{return}},eo=/^[a-z][a-z0-9+.-]*:/i,to=s=>eo.test(s),nn=s=>new Promise(e=>setTimeout(e,s)),Zn=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new z(`${s} must be an integer`);if(e<0)throw new z(`${s} must be a positive integer`);return e},ds=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(s)},pn=s=>{var e,t,n,r,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[s])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,s))==null?void 0:i.trim()};function pa(s){if(!s)return!0;for(const e in s)return!1;return!0}function ga(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Tr(s,e){for(const t in e){if(!ga(e,t))continue;const n=t.toLowerCase();if(!n)continue;const r=e[t];r===null?delete s[n]:r!==void 0&&(s[n]=r)}}const Mr=new Set(["authorization","api-key"]);function ht(s,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const n=e.map(r=>{if(!r)return r;if(r.headers){const a={...r,headers:{...r.headers}};for(const l in r.headers)Mr.has(l.toLowerCase())&&(a.headers[l]="REDACTED");return a}let i=null;for(const a in r)Mr.has(a.toLowerCase())&&(i??(i={...r}),i[a]="REDACTED");return i??r});console.log(`OpenAI:DEBUG:${s}`,...n)}}const no=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),so=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ro=s=>typeof(s==null?void 0:s.get)=="function",gn=(s,e)=>{var n;const t=e.toLowerCase();if(ro(s)){const r=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,l)=>a+l.toUpperCase());for(const i of[e,t,e.toUpperCase(),r]){const a=s.get(i);if(a)return a}}for(const[r,i]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i},io=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};function es(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}class jn extends da{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class _e extends da{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class ${constructor(e){this._client=e}}let _a=class extends ${list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,ao,{query:t,...n})}},zn=class extends ${constructor(){super(...arguments),this.messages=new _a(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/chat/completions",Un,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Un extends _e{}class ao extends _e{}zn.ChatCompletionsPage=Un;zn.Messages=_a;let $n=class extends ${constructor(){super(...arguments),this.completions=new zn(this._client)}};$n.Completions=zn;$n.ChatCompletionsPage=Un;class ba extends ${create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class wa extends ${create(e,t){return this._client.post("/audio/transcriptions",St({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class va extends ${create(e,t){return this._client.post("/audio/translations",St({body:e,...t,__metadata:{model:e.model}}))}}class sn extends ${constructor(){super(...arguments),this.transcriptions=new wa(this._client),this.translations=new va(this._client),this.speech=new ba(this._client)}}sn.Transcriptions=wa;sn.Translations=va;sn.Speech=ba;class Ps extends ${create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/batches",Ds,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Ds extends _e{}Ps.BatchesPage=Ds;var $e=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},re=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},ms,Sn,Cn,$t,Ht,En,Wt,st,Vt,Rn,Tn,Mt,ya;class Is{constructor(){ms.add(this),this.controller=new AbortController,Sn.set(this,void 0),Cn.set(this,()=>{}),$t.set(this,()=>{}),Ht.set(this,void 0),En.set(this,()=>{}),Wt.set(this,()=>{}),st.set(this,{}),Vt.set(this,!1),Rn.set(this,!1),Tn.set(this,!1),Mt.set(this,!1),$e(this,Sn,new Promise((e,t)=>{$e(this,Cn,e,"f"),$e(this,$t,t,"f")}),"f"),$e(this,Ht,new Promise((e,t)=>{$e(this,En,e,"f"),$e(this,Wt,t,"f")}),"f"),re(this,Sn,"f").catch(()=>{}),re(this,Ht,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},re(this,ms,"m",ya).bind(this))},0)}_connected(){this.ended||(re(this,Cn,"f").call(this),this._emit("connect"))}get ended(){return re(this,Vt,"f")}get errored(){return re(this,Rn,"f")}get aborted(){return re(this,Tn,"f")}abort(){this.controller.abort()}on(e,t){return(re(this,st,"f")[e]||(re(this,st,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=re(this,st,"f")[e];if(!n)return this;const r=n.findIndex(i=>i.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(re(this,st,"f")[e]||(re(this,st,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{$e(this,Mt,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){$e(this,Mt,!0,"f"),await re(this,Ht,"f")}_emit(e,...t){if(re(this,Vt,"f"))return;e==="end"&&($e(this,Vt,!0,"f"),re(this,En,"f").call(this));const n=re(this,st,"f")[e];if(n&&(re(this,st,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!re(this,Mt,"f")&&!(n!=null&&n.length)&&Promise.reject(r),re(this,$t,"f").call(this,r),re(this,Wt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!re(this,Mt,"f")&&!(n!=null&&n.length)&&Promise.reject(r),re(this,$t,"f").call(this,r),re(this,Wt,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Sn=new WeakMap,Cn=new WeakMap,$t=new WeakMap,Ht=new WeakMap,En=new WeakMap,Wt=new WeakMap,st=new WeakMap,Vt=new WeakMap,Rn=new WeakMap,Tn=new WeakMap,Mt=new WeakMap,ms=new WeakSet,ya=function(e){if($e(this,Rn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new je),e instanceof je)return $e(this,Tn,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){const t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))};var B=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Be=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},ve,ps,Ke,An,He,yt,Ot,vt,Mn,Ne,Pn,Dn,Gt,qt,Jt,Or,Fr,Lr,Br,xr,Nr,jr;class We extends Is{constructor(){super(...arguments),ve.add(this),ps.set(this,[]),Ke.set(this,{}),An.set(this,{}),He.set(this,void 0),yt.set(this,void 0),Ot.set(this,void 0),vt.set(this,void 0),Mn.set(this,void 0),Ne.set(this,void 0),Pn.set(this,void 0),Dn.set(this,void 0),Gt.set(this,void 0)}[(ps=new WeakMap,Ke=new WeakMap,An=new WeakMap,He=new WeakMap,yt=new WeakMap,Ot=new WeakMap,vt=new WeakMap,Mn=new WeakMap,Ne=new WeakMap,Pn=new WeakMap,Dn=new WeakMap,Gt=new WeakMap,ve=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new We;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=Ge.fromReadableStream(e,this.controller);for await(const a of r)B(this,ve,"m",qt).call(this,a);if((i=r.controller.signal)!=null&&i.aborted)throw new je;return this._addRun(B(this,ve,"m",Jt).call(this))}toReadableStream(){return new Ge(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,i){const a=new We;return a._run(()=>a._runToolAssistantStream(e,t,n,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const l={...r,stream:!0},o=await e.submitToolOutputs(t,n,l,{...i,signal:this.controller.signal});this._connected();for await(const u of o)B(this,ve,"m",qt).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new je;return this._addRun(B(this,ve,"m",Jt).call(this))}static createThreadAssistantStream(e,t,n){const r=new We;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const i=new We;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return B(this,Pn,"f")}currentRun(){return B(this,Dn,"f")}currentMessageSnapshot(){return B(this,He,"f")}currentRunStepSnapshot(){return B(this,Gt,"f")}async finalRunSteps(){return await this.done(),Object.values(B(this,Ke,"f"))}async finalMessages(){return await this.done(),Object.values(B(this,An,"f"))}async finalRun(){if(await this.done(),!B(this,yt,"f"))throw Error("Final run was not received.");return B(this,yt,"f")}async _createThreadAssistantStream(e,t,n){var l;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const o of a)B(this,ve,"m",qt).call(this,o);if((l=a.controller.signal)!=null&&l.aborted)throw new je;return this._addRun(B(this,ve,"m",Jt).call(this))}async _createAssistantStream(e,t,n,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},l=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const c of l)B(this,ve,"m",qt).call(this,c);if((o=l.controller.signal)!=null&&o.aborted)throw new je;return this._addRun(B(this,ve,"m",Jt).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let i=e[n];if(i==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof i=="string"&&typeof r=="string")i+=r;else if(typeof i=="number"&&typeof r=="number")i+=r;else if(es(i)&&es(r))i=this.accumulateDelta(i,r);else if(Array.isArray(i)&&Array.isArray(r)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...r);continue}for(const a of r){if(!es(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const l=a.index;if(l==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof l!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${l}`);const o=i[l];o==null?i.push(a):i[l]=this.accumulateDelta(o,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,i){return await this._createToolAssistantStream(n,e,t,r,i)}}qt=function(e){if(!this.ended)switch(Be(this,Pn,e,"f"),B(this,ve,"m",Lr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":B(this,ve,"m",jr).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":B(this,ve,"m",Fr).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":B(this,ve,"m",Or).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Jt=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");if(!B(this,yt,"f"))throw Error("Final run has not been received");return B(this,yt,"f")},Or=function(e){const[t,n]=B(this,ve,"m",xr).call(this,e,B(this,He,"f"));Be(this,He,t,"f"),B(this,An,"f")[t.id]=t;for(const r of n){const i=t.content[r.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let i=r.text,a=t.content[r.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=B(this,Ot,"f")){if(B(this,vt,"f"))switch(B(this,vt,"f").type){case"text":this._emit("textDone",B(this,vt,"f").text,B(this,He,"f"));break;case"image_file":this._emit("imageFileDone",B(this,vt,"f").image_file,B(this,He,"f"));break}Be(this,Ot,r.index,"f")}Be(this,vt,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(B(this,Ot,"f")!==void 0){const r=e.data.content[B(this,Ot,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,B(this,He,"f"));break;case"text":this._emit("textDone",r.text,B(this,He,"f"));break}}B(this,He,"f")&&this._emit("messageDone",e.data),Be(this,He,void 0,"f")}},Fr=function(e){const t=B(this,ve,"m",Br).call(this,e);switch(Be(this,Gt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of n.step_details.tool_calls)i.index==B(this,Mn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(B(this,Ne,"f")&&this._emit("toolCallDone",B(this,Ne,"f")),Be(this,Mn,i.index,"f"),Be(this,Ne,t.step_details.tool_calls[i.index],"f"),B(this,Ne,"f")&&this._emit("toolCallCreated",B(this,Ne,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Be(this,Gt,void 0,"f"),e.data.step_details.type=="tool_calls"&&B(this,Ne,"f")&&(this._emit("toolCallDone",B(this,Ne,"f")),Be(this,Ne,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Lr=function(e){B(this,ps,"f").push(e),this._emit("event",e)},Br=function(e){switch(e.event){case"thread.run.step.created":return B(this,Ke,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=B(this,Ke,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=We.accumulateDelta(t,n.delta);B(this,Ke,"f")[e.data.id]=r}return B(this,Ke,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":B(this,Ke,"f")[e.data.id]=e.data;break}if(B(this,Ke,"f")[e.data.id])return B(this,Ke,"f")[e.data.id];throw new Error("No snapshot available")},xr=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const i of r.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=B(this,ve,"m",Nr).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Nr=function(e,t){return We.accumulateDelta(t,e)},jr=function(e){switch(Be(this,Dn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Be(this,yt,e.data,"f"),B(this,Ne,"f")&&(this._emit("toolCallDone",B(this,Ne,"f")),Be(this,Ne,void 0,"f"));break}};class Rs extends ${create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/assistants",Ts,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ts extends _e{}Rs.AssistantsPage=Ts;function zr(s){return typeof s.parse=="function"}const Lt=s=>(s==null?void 0:s.role)==="assistant",ka=s=>(s==null?void 0:s.role)==="function",Sa=s=>(s==null?void 0:s.role)==="tool";function Ms(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function rn(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function lo(s,e){return!e||!Ca(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Os(s,e)}function Os(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new ia;if(n.finish_reason==="content_filter")throw new aa;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(i=>co(e,i)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?oo(e,n.message.content):null}}});return{...s,choices:t}}function oo(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function co(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var i;return((i=r.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:rn(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function uo(s,e){var n;if(!s)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var i;return((i=r.function)==null?void 0:i.name)===e.function.name});return rn(t)||(t==null?void 0:t.function.strict)||!1}function Ca(s){var e;return Ms(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>rn(t)||t.type==="function"&&t.function.strict===!0))??!1}function ho(s){for(const e of s??[]){if(e.type!=="function")throw new z(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new z(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Re=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},ke,gs,On,_s,bs,ws,Ea,vs;const Ur=10;class Aa extends Is{constructor(){super(...arguments),ke.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(ka(e)||Sa(e))&&e.content)this._emit("functionCallResult",e.content);else if(Lt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Lt(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new z("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Re(this,ke,"m",gs).call(this)}async finalMessage(){return await this.done(),Re(this,ke,"m",On).call(this)}async finalFunctionCall(){return await this.done(),Re(this,ke,"m",_s).call(this)}async finalFunctionCallResult(){return await this.done(),Re(this,ke,"m",bs).call(this)}async totalUsage(){return await this.done(),Re(this,ke,"m",ws).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Re(this,ke,"m",On).call(this);t&&this._emit("finalMessage",t);const n=Re(this,ke,"m",gs).call(this);n&&this._emit("finalContent",n);const r=Re(this,ke,"m",_s).call(this);r&&this._emit("finalFunctionCall",r);const i=Re(this,ke,"m",bs).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",Re(this,ke,"m",ws).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Re(this,ke,"m",Ea).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Os(i,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;const r="function",{function_call:i="auto",stream:a,...l}=t,o=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Ur}=n||{},u={};for(const m of t.functions)u[m.name||m.function.name]=m;const h=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const _=(f=(await this._createChatCompletion(e,{...l,function_call:i,functions:h,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!_)throw new z("missing message in ChatCompletion response");if(!_.function_call)return;const{name:b,arguments:y}=_.function_call,v=u[b];if(v){if(o&&o!==b){const C=`Invalid function_call: ${JSON.stringify(b)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:b,content:C});continue}}else{const C=`Invalid function_call: ${JSON.stringify(b)}. Available options are: ${h.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:b,content:C});continue}let E;try{E=zr(v)?await v.parse(y):y}catch(C){this._addMessage({role:r,name:b,content:C instanceof Error?C.message:String(C)});continue}const k=await v.function(E,this),P=Re(this,ke,"m",vs).call(this,k);if(this._addMessage({role:r,name:b,content:P}),o)return}}async _runTools(e,t,n){var m,p,_;const r="tool",{tool_choice:i="auto",stream:a,...l}=t,o=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:c=Ur}=n||{},u=t.tools.map(b=>{if(rn(b)){if(!b.$callback)throw new z("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:b.$callback,name:b.function.name,description:b.function.description||"",parameters:b.function.parameters,parse:b.$parseRaw,strict:!0}}}return b}),h={};for(const b of u)b.type==="function"&&(h[b.function.name||b.function.function.name]=b.function);const f="tools"in t?u.map(b=>b.type==="function"?{type:"function",function:{name:b.function.name||b.function.function.name,parameters:b.function.parameters,description:b.function.description,strict:b.function.strict}}:b):void 0;for(const b of t.messages)this._addMessage(b,!1);for(let b=0;b<c;++b){const v=(p=(await this._createChatCompletion(e,{...l,tool_choice:i,tools:f,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!v)throw new z("missing message in ChatCompletion response");if(!((_=v.tool_calls)!=null&&_.length))return;for(const E of v.tool_calls){if(E.type!=="function")continue;const k=E.id,{name:P,arguments:C}=E.function,S=h[P];if(S){if(o&&o!==P){const I=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:k,content:I});continue}}else{const I=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(h).map(T=>JSON.stringify(T)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:k,content:I});continue}let M;try{M=zr(S)?await S.parse(C):C}catch(I){const T=I instanceof Error?I.message:String(I);this._addMessage({role:r,tool_call_id:k,content:T});continue}const R=await S.function(M,this),F=Re(this,ke,"m",vs).call(this,R);if(this._addMessage({role:r,tool_call_id:k,content:F}),o)return}}}}ke=new WeakSet,gs=function(){return Re(this,ke,"m",On).call(this).content??null},On=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Lt(t)){const{function_call:n,...r}=t,i={...r,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new z("stream ended without producing a ChatCompletionMessage with role=assistant")},_s=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Lt(r)&&(r!=null&&r.function_call))return r.function_call;if(Lt(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},bs=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ka(t)&&t.content!=null||Sa(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},ws=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ea=function(e){if(e.n!=null&&e.n>1)throw new z("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},vs=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Zt extends Aa{static runFunctions(e,t,n){const r=new Zt,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){const r=new Zt,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}_addMessage(e,t=!0){super._addMessage(e,t),Lt(e)&&e.content&&this._emit("content",e.content)}}const Pa=1,Da=2,Ia=4,Ra=8,Ta=16,Ma=32,Oa=64,Fa=128,La=256,Ba=Fa|La,xa=Ta|Ma|Ba|Oa,Na=Pa|Da|xa,ja=Ia|Ra,fo=Na|ja,we={STR:Pa,NUM:Da,ARR:Ia,OBJ:Ra,NULL:Ta,BOOL:Ma,NAN:Oa,INFINITY:Fa,MINUS_INFINITY:La,INF:Ba,SPECIAL:xa,ATOM:Na,COLLECTION:ja,ALL:fo};class mo extends Error{}class po extends Error{}function go(s,e=we.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return _o(s.trim(),e)}const _o=(s,e)=>{const t=s.length;let n=0;const r=f=>{throw new mo(`${f} at position ${n}`)},i=f=>{throw new po(`${f} at position ${n}`)},a=()=>(h(),n>=t&&r("Unexpected end of input"),s[n]==='"'?l():s[n]==="{"?o():s[n]==="["?c():s.substring(n,n+4)==="null"||we.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||we.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||we.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||we.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||we.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||we.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):u()),l=()=>{const f=n;let m=!1;for(n++;n<t&&(s[n]!=='"'||m&&s[n-1]==="\\");)m=s[n]==="\\"?!m:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(f,++n-Number(m)))}catch(p){i(String(p))}else if(we.STR&e)try{return JSON.parse(s.substring(f,n-Number(m))+'"')}catch{return JSON.parse(s.substring(f,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},o=()=>{n++,h();const f={};try{for(;s[n]!=="}";){if(h(),n>=t&&we.OBJ&e)return f;const m=l();h(),n++;try{const p=a();Object.defineProperty(f,m,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(we.OBJ&e)return f;throw p}h(),s[n]===","&&n++}}catch{if(we.OBJ&e)return f;r("Expected '}' at end of object")}return n++,f},c=()=>{n++;const f=[];try{for(;s[n]!=="]";)f.push(a()),h(),s[n]===","&&n++}catch{if(we.ARR&e)return f;r("Expected ']' at end of array")}return n++,f},u=()=>{if(n===0){s==="-"&&we.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(m){if(we.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}i(String(m))}}const f=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(we.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(f,n))}catch{s.substring(f,n)==="-"&&we.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(f,s.lastIndexOf("e")))}catch(p){i(String(p))}}},h=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return a()},$r=s=>go(s,we.ALL^we.NUM);var At=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Z=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},me,nt,Pt,ot,ts,_n,ns,ss,rs,bn,is,Hr;class en extends Aa{constructor(e){super(),me.add(this),nt.set(this,void 0),Pt.set(this,void 0),ot.set(this,void 0),At(this,nt,e,"f"),At(this,Pt,[],"f")}get currentChatCompletionSnapshot(){return Z(this,ot,"f")}static fromReadableStream(e){const t=new en(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new en(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var a;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Z(this,me,"m",ts).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const l of i)Z(this,me,"m",ns).call(this,l);if((a=i.controller.signal)!=null&&a.aborted)throw new je;return this._addChatCompletion(Z(this,me,"m",bn).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Z(this,me,"m",ts).call(this),this._connected();const r=Ge.fromReadableStream(e,this.controller);let i;for await(const l of r)i&&i!==l.id&&this._addChatCompletion(Z(this,me,"m",bn).call(this)),Z(this,me,"m",ns).call(this,l),i=l.id;if((a=r.controller.signal)!=null&&a.aborted)throw new je;return this._addChatCompletion(Z(this,me,"m",bn).call(this))}[(nt=new WeakMap,Pt=new WeakMap,ot=new WeakMap,me=new WeakSet,ts=function(){this.ended||At(this,ot,void 0,"f")},_n=function(t){let n=Z(this,Pt,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Z(this,Pt,"f")[t.index]=n,n)},ns=function(t){var r,i,a,l,o,c,u,h,f,m,p,_,b,y,v;if(this.ended)return;const n=Z(this,me,"m",Hr).call(this,t);this._emit("chunk",t,n);for(const E of t.choices){const k=n.choices[E.index];E.delta.content!=null&&((r=k.message)==null?void 0:r.role)==="assistant"&&((i=k.message)!=null&&i.content)&&(this._emit("content",E.delta.content,k.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:k.message.content,parsed:k.message.parsed})),E.delta.refusal!=null&&((a=k.message)==null?void 0:a.role)==="assistant"&&((l=k.message)!=null&&l.refusal)&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:k.message.refusal}),((o=E.logprobs)==null?void 0:o.content)!=null&&((c=k.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=E.logprobs)==null?void 0:u.content,snapshot:((h=k.logprobs)==null?void 0:h.content)??[]}),((f=E.logprobs)==null?void 0:f.refusal)!=null&&((m=k.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=E.logprobs)==null?void 0:p.refusal,snapshot:((_=k.logprobs)==null?void 0:_.refusal)??[]});const P=Z(this,me,"m",_n).call(this,k);k.finish_reason&&(Z(this,me,"m",rs).call(this,k),P.current_tool_call_index!=null&&Z(this,me,"m",ss).call(this,k,P.current_tool_call_index));for(const C of E.delta.tool_calls??[])P.current_tool_call_index!==C.index&&(Z(this,me,"m",rs).call(this,k),P.current_tool_call_index!=null&&Z(this,me,"m",ss).call(this,k,P.current_tool_call_index)),P.current_tool_call_index=C.index;for(const C of E.delta.tool_calls??[]){const S=(b=k.message.tool_calls)==null?void 0:b[C.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(y=S.function)==null?void 0:y.name,index:C.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:((v=C.function)==null?void 0:v.arguments)??""}):(S==null||S.type,void 0))}}},ss=function(t,n){var a,l,o;if(Z(this,me,"m",_n).call(this,t).done_tool_calls.has(n))return;const i=(a=t.message.tool_calls)==null?void 0:a[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(o=(l=Z(this,nt,"f"))==null?void 0:l.tools)==null?void 0:o.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:rn(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},rs=function(t){var r,i;const n=Z(this,me,"m",_n).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const a=Z(this,me,"m",is).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},bn=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");const t=Z(this,ot,"f");if(!t)throw new z("request ended without sending any chunks");return At(this,ot,void 0,"f"),At(this,Pt,[],"f"),bo(t,Z(this,nt,"f"))},is=function(){var n;const t=(n=Z(this,nt,"f"))==null?void 0:n.response_format;return Ms(t)?t:null},Hr=function(t){var n,r,i,a;let l=Z(this,ot,"f");const{choices:o,...c}=t;l?Object.assign(l,c):l=At(this,ot,{...c,choices:[]},"f");for(const{delta:u,finish_reason:h,index:f,logprobs:m=null,...p}of t.choices){let _=l.choices[f];if(_||(_=l.choices[f]={finish_reason:h,index:f,message:{},logprobs:m,...p}),m)if(!_.logprobs)_.logprobs=Object.assign({},m);else{const{content:C,refusal:S,...M}=m;Object.assign(_.logprobs,M),C&&((n=_.logprobs).content??(n.content=[]),_.logprobs.content.push(...C)),S&&((r=_.logprobs).refusal??(r.refusal=[]),_.logprobs.refusal.push(...S))}if(h&&(_.finish_reason=h,Z(this,nt,"f")&&Ca(Z(this,nt,"f")))){if(h==="length")throw new ia;if(h==="content_filter")throw new aa}if(Object.assign(_,p),!u)continue;const{content:b,refusal:y,function_call:v,role:E,tool_calls:k,...P}=u;if(Object.assign(_.message,P),y&&(_.message.refusal=(_.message.refusal||"")+y),E&&(_.message.role=E),v&&(_.message.function_call?(v.name&&(_.message.function_call.name=v.name),v.arguments&&((i=_.message.function_call).arguments??(i.arguments=""),_.message.function_call.arguments+=v.arguments)):_.message.function_call=v),b&&(_.message.content=(_.message.content||"")+b,!_.message.refusal&&Z(this,me,"m",is).call(this)&&(_.message.parsed=$r(_.message.content))),k){_.message.tool_calls||(_.message.tool_calls=[]);for(const{index:C,id:S,type:M,function:R,...F}of k){const I=(a=_.message.tool_calls)[C]??(a[C]={});Object.assign(I,F),S&&(I.id=S),M&&(I.type=M),R&&(I.function??(I.function={name:R.name??"",arguments:""})),R!=null&&R.name&&(I.function.name=R.name),R!=null&&R.arguments&&(I.function.arguments+=R.arguments,uo(Z(this,nt,"f"),I)&&(I.function.parsed_arguments=$r(I.function.arguments)))}}}return l},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ge(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function bo(s,e){const{id:t,choices:n,created:r,model:i,system_fingerprint:a,...l}=s,o={...l,id:t,choices:n.map(({message:c,finish_reason:u,index:h,logprobs:f,...m})=>{if(!u)throw new z(`missing finish_reason for choice ${h}`);const{content:p=null,function_call:_,tool_calls:b,...y}=c,v=c.role;if(!v)throw new z(`missing role for choice ${h}`);if(_){const{arguments:E,name:k}=_;if(E==null)throw new z(`missing function_call.arguments for choice ${h}`);if(!k)throw new z(`missing function_call.name for choice ${h}`);return{...m,message:{content:p,function_call:{arguments:E,name:k},role:v,refusal:c.refusal??null},finish_reason:u,index:h,logprobs:f}}return b?{...m,index:h,finish_reason:u,logprobs:f,message:{...y,role:v,content:p,refusal:c.refusal??null,tool_calls:b.map((E,k)=>{const{function:P,type:C,id:S,...M}=E,{arguments:R,name:F,...I}=P||{};if(S==null)throw new z(`missing choices[${h}].tool_calls[${k}].id
${wn(s)}`);if(C==null)throw new z(`missing choices[${h}].tool_calls[${k}].type
${wn(s)}`);if(F==null)throw new z(`missing choices[${h}].tool_calls[${k}].function.name
${wn(s)}`);if(R==null)throw new z(`missing choices[${h}].tool_calls[${k}].function.arguments
${wn(s)}`);return{...M,id:S,type:C,function:{...I,name:F,arguments:R}}})}}:{...m,message:{...y,content:p,role:v,refusal:c.refusal??null},finish_reason:u,index:h,logprobs:f}}),created:r,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return lo(o,e)}function wn(s){return JSON.stringify(s)}class Bt extends en{static fromReadableStream(e){const t=new Bt(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const r=new Bt(null),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){const r=new Bt(t),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}}let za=class extends ${parse(e,t){return ho(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Os(n,e))}runFunctions(e,t){return e.stream?Bt.runFunctions(this._client,e,t):Zt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Bt.runTools(this._client,e,t):Zt.runTools(this._client,e,t)}stream(e,t){return en.createChatCompletion(this._client,e,t)}};class ys extends ${constructor(){super(...arguments),this.completions=new za(this._client)}}(function(s){s.Completions=za})(ys||(ys={}));class Ua extends ${create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class $a extends ${create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Hn extends ${constructor(){super(...arguments),this.sessions=new Ua(this._client),this.transcriptionSessions=new $a(this._client)}}Hn.Sessions=Ua;Hn.TranscriptionSessions=$a;class Fs extends ${create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ls,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Ls extends _e{}Fs.MessagesPage=Ls;class Bs extends ${retrieve(e,t,n,r={},i){return ie(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,n={},r){return ie(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,xs,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class xs extends _e{}Bs.RunStepsPage=xs;let an=class extends ${constructor(){super(...arguments),this.steps=new Bs(this._client)}create(e,t,n){const{include:r,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ns,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return We.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const o=a.headers.get("openai-poll-after-ms");if(o){const c=parseInt(o);isNaN(c)||(l=c)}}await nn(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return We.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const i=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,n,r){return We.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}};class Ns extends _e{}an.RunsPage=Ns;an.Steps=Bs;an.RunStepsPage=xs;class xt extends ${constructor(){super(...arguments),this.runs=new an(this._client),this.messages=new Fs(this._client)}create(e={},t){return ie(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return We.createThreadAssistantStream(e,this._client.beta.threads,t)}}xt.Runs=an;xt.RunsPage=Ns;xt.Messages=Fs;xt.MessagesPage=Ls;class Nt extends ${constructor(){super(...arguments),this.realtime=new Hn(this._client),this.chat=new ys(this._client),this.assistants=new Rs(this._client),this.threads=new xt(this._client)}}Nt.Realtime=Hn;Nt.Assistants=Rs;Nt.AssistantsPage=Ts;Nt.Threads=xt;class Ha extends ${create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Wa extends ${retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}}let Wn=class extends ${constructor(){super(...arguments),this.content=new Wa(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,St({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,js,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}};class js extends _e{}Wn.FileListResponsesPage=js;Wn.Content=Wa;class ln extends ${constructor(){super(...arguments),this.files=new Wn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/containers",zs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class zs extends _e{}ln.ContainerListResponsesPage=zs;ln.Files=Wn;ln.FileListResponsesPage=js;class Va extends ${create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&ht("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(ht("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(l=>{const o=l.embedding;l.embedding=io(o)}),a)))}}class Us extends ${retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return ie(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,$s,{query:n,...r})}}class $s extends _e{}Us.OutputItemListResponsesPage=$s;class on extends ${constructor(){super(...arguments),this.outputItems=new Us(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Hs,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class Hs extends _e{}on.RunListResponsesPage=Hs;on.OutputItems=Us;on.OutputItemListResponsesPage=$s;class cn extends ${constructor(){super(...arguments),this.runs=new on(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/evals",Ws,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class Ws extends _e{}cn.EvalListResponsesPage=Ws;cn.Runs=on;cn.RunListResponsesPage=Hs;let Vs=class extends ${create(e,t){return this._client.post("/files",St({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/files",qs,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await nn(t),a=await this.retrieve(e),Date.now()-i>n)throw new As({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};class qs extends _e{}Vs.FileObjectsPage=qs;class qa extends ${}let Ja=class extends ${run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Js extends ${constructor(){super(...arguments),this.graders=new Ja(this._client)}}Js.Graders=Ja;class Xs extends ${create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Ks,{body:t,method:"post",...n})}retrieve(e,t={},n){return ie(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class Ks extends jn{}Xs.PermissionCreateResponsesPage=Ks;let Vn=class extends ${constructor(){super(...arguments),this.permissions=new Xs(this._client)}};Vn.Permissions=Xs;Vn.PermissionCreateResponsesPage=Ks;class Gs extends ${list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Qs,{query:t,...n})}}class Qs extends _e{}Gs.FineTuningJobCheckpointsPage=Qs;class jt extends ${constructor(){super(...arguments),this.checkpoints=new Gs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ys,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return ie(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Zs,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class Ys extends _e{}class Zs extends _e{}jt.FineTuningJobsPage=Ys;jt.FineTuningJobEventsPage=Zs;jt.Checkpoints=Gs;jt.FineTuningJobCheckpointsPage=Qs;class ft extends ${constructor(){super(...arguments),this.methods=new qa(this._client),this.jobs=new jt(this._client),this.checkpoints=new Vn(this._client),this.alpha=new Js(this._client)}}ft.Methods=qa;ft.Jobs=jt;ft.FineTuningJobsPage=Ys;ft.FineTuningJobEventsPage=Zs;ft.Checkpoints=Vn;ft.Alpha=Js;class Xa extends ${}class er extends ${constructor(){super(...arguments),this.graderModels=new Xa(this._client)}}er.GraderModels=Xa;class Ka extends ${createVariation(e,t){return this._client.post("/images/variations",St({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",St({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class tr extends ${retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",nr,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class nr extends jn{}tr.ModelsPage=nr;class Ga extends ${create(e,t){return this._client.post("/moderations",{body:e,...t})}}function wo(s,e){return!e||!yo(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Qa(s,e)}function Qa(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:Co(e,r)};if(r.type==="message"){const i=r.content.map(a=>a.type==="output_text"?{...a,parsed:vo(e,a.text)}:a);return{...r,content:i}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||Ya(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const i of r.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function vo(s,e){var t,n,r,i;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((i=s.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function yo(s){var e;return!!Ms((e=s.text)==null?void 0:e.format)}function ko(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function So(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function Co(s,e){const t=So(s.tools??[],e.name);return{...e,...e,parsed_arguments:ko(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Ya(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}class Za extends ${list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,Ao,{query:t,...n})}}var Dt=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},ct=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},It,vn,ut,yn,Wr,Vr,qr,Jr;class sr extends Is{constructor(e){super(),It.add(this),vn.set(this,void 0),ut.set(this,void 0),yn.set(this,void 0),Dt(this,vn,e,"f")}static createResponse(e,t,n){const r=new sr(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var l;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ct(this,It,"m",Wr).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const o of i)ct(this,It,"m",Vr).call(this,o,a);if((l=i.controller.signal)!=null&&l.aborted)throw new je;return ct(this,It,"m",qr).call(this)}[(vn=new WeakMap,ut=new WeakMap,yn=new WeakMap,It=new WeakSet,Wr=function(){this.ended||Dt(this,ut,void 0,"f")},Vr=function(t,n){if(this.ended)return;const r=(a,l)=>{(n==null||l.sequence_number>n)&&this._emit(a,l)},i=ct(this,It,"m",Jr).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const a=i.output[t.output_index];if(!a)throw new z(`missing output at index ${t.output_index}`);if(a.type==="message"){const l=a.content[t.content_index];if(!l)throw new z(`missing content at index ${t.content_index}`);if(l.type!=="output_text")throw new z(`expected content to be 'output_text', got ${l.type}`);r("response.output_text.delta",{...t,snapshot:l.text})}break}case"response.function_call_arguments.delta":{const a=i.output[t.output_index];if(!a)throw new z(`missing output at index ${t.output_index}`);a.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:r(t.type,t);break}},qr=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");const t=ct(this,ut,"f");if(!t)throw new z("request ended without sending any events");Dt(this,ut,void 0,"f");const n=Eo(t,ct(this,vn,"f"));return Dt(this,yn,n,"f"),n},Jr=function(t){let n=ct(this,ut,"f");if(!n){if(t.type!=="response.created")throw new z(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Dt(this,ut,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new z(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new z(`missing output at index ${t.output_index}`);if(r.type==="message"){const i=r.content[t.content_index];if(!i)throw new z(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new z(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new z(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{Dt(this,ut,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=ct(this,yn,"f");if(!e)throw new z("stream ended without producing a ChatCompletion");return e}}function Eo(s,e){return wo(s,e)}class rr extends ${constructor(){super(...arguments),this.inputItems=new Za(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Ya(n),n))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Qa(n,e))}stream(e,t){return sr.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class Ao extends _e{}rr.InputItems=Za;class el extends ${create(e,t,n){return this._client.post(`/uploads/${e}/parts`,St({body:t,...n}))}}class ir extends ${constructor(){super(...arguments),this.parts=new el(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}ir.Parts=el;const Po=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class qn extends ${create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return ie(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Jn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const o=i.response.headers.get("openai-poll-after-ms");if(o){const c=parseInt(o);isNaN(c)||(l=c)}}await nn(l);break;case"failed":case"completed":return a}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,ar,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Jn extends _e{}class ar extends jn{}qn.VectorStoreFilesPage=Jn;qn.FileContentResponsesPage=ar;class tl extends ${create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return ie(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Jn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const o=a.headers.get("openai-poll-after-ms");if(o){const c=parseInt(o);isNaN(c)||(l=c)}}await nn(l);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(r==null?void 0:r.maxConcurrency)??5,a=Math.min(i,t.length),l=this._client,o=t.values(),c=[...n];async function u(f){for(let m of f){const p=await l.files.create({file:m,purpose:"assistants"},r);c.push(p.id)}}const h=Array(a).fill(o).map(u);return await Po(h),await this.createAndPoll(e,{file_ids:c})}}class dt extends ${constructor(){super(...arguments),this.files=new qn(this._client),this.fileBatches=new tl(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return ie(e)?this.list({},e):this._client.getAPIList("/vector_stores",lr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,or,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class lr extends _e{}class or extends jn{}dt.VectorStoresPage=lr;dt.VectorStoreSearchResponsesPage=or;dt.Files=qn;dt.VectorStoreFilesPage=Jn;dt.FileContentResponsesPage=ar;dt.FileBatches=tl;var nl;class W extends Jl{constructor({baseURL:e=pn("OPENAI_BASE_URL"),apiKey:t=pn("OPENAI_API_KEY"),organization:n=pn("OPENAI_ORG_ID")??null,project:r=pn("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new z("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&so())throw new z(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Ha(this),this.chat=new $n(this),this.embeddings=new Va(this),this.files=new Vs(this),this.images=new Ka(this),this.audio=new sn(this),this.moderations=new Ga(this),this.models=new tr(this),this.fineTuning=new ft(this),this.graders=new er(this),this.vectorStores=new dt(this),this.beta=new Nt(this),this.batches=new Ps(this),this.uploads=new ir(this),this.responses=new rr(this),this.evals=new cn(this),this.containers=new ln(this),this._options=a,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Il(e,{arrayFormat:"brackets"})}}nl=W;W.OpenAI=nl;W.DEFAULT_TIMEOUT=6e5;W.OpenAIError=z;W.APIError=ye;W.APIConnectionError=Ln;W.APIConnectionTimeoutError=As;W.APIUserAbortError=je;W.NotFoundError=ea;W.ConflictError=ta;W.RateLimitError=sa;W.BadRequestError=Qi;W.AuthenticationError=Yi;W.InternalServerError=ra;W.PermissionDeniedError=Zi;W.UnprocessableEntityError=na;W.toFile=ua;W.fileFromPath=Xi;W.Completions=Ha;W.Chat=$n;W.ChatCompletionsPage=Un;W.Embeddings=Va;W.Files=Vs;W.FileObjectsPage=qs;W.Images=Ka;W.Audio=sn;W.Moderations=Ga;W.Models=tr;W.ModelsPage=nr;W.FineTuning=ft;W.Graders=er;W.VectorStores=dt;W.VectorStoresPage=lr;W.VectorStoreSearchResponsesPage=or;W.Beta=Nt;W.Batches=Ps;W.BatchesPage=Ds;W.Uploads=ir;W.Responses=rr;W.Evals=cn;W.EvalListResponsesPage=Ws;W.Containers=ln;W.ContainerListResponsesPage=zs;class Do{constructor(e){V(this,"provider");this.provider=e}getRequestModel(e){return e||this.provider.model}createSystemMessage(e){return{role:"system",content:e}}createUserMessage(e){return{role:"user",content:e}}createAssistantMessage(e){return{role:"assistant",content:e}}}class Io extends Do{constructor(t){super(t);V(this,"client");this.client=new W({apiKey:t.apiKey,baseURL:t.baseURL,dangerouslyAllowBrowser:!0,maxRetries:2,timeout:6e4})}getMetadata(){return{id:"openai-compatible",name:this.provider.name,supportStreaming:!0,maxContextToken:4096}}async chatCompletion(t,n){var l,o;const r=await this.client.chat.completions.create({model:this.getRequestModel(n),messages:t,temperature:this.provider.temperature??.7,max_tokens:this.provider.maxTokens??2048}),i=((o=(l=r.choices[0])==null?void 0:l.message)==null?void 0:o.content)||"",a=r.usage;return{content:i,usage:a?{promptTokens:a.prompt_tokens,completionTokens:a.completion_tokens,totalTokens:a.total_tokens}:void 0}}async streamChatCompletion(t,n,r){var i,a;try{const l=await this.client.chat.completions.create({model:this.getRequestModel(r),messages:t,temperature:this.provider.temperature??.7,max_tokens:this.provider.maxTokens??2048,stream:!0});for await(const o of l){const c=(a=(i=o.choices[0])==null?void 0:i.delta)==null?void 0:a.content;c&&n({content:c})}n({done:!0})}catch(l){n({error:l instanceof Error?l:new Error(String(l)),done:!0})}}async testConnection(){try{return await this.client.chat.completions.create({model:this.getRequestModel(),messages:[{role:"user",content:"Hello"}],max_tokens:5}),!0}catch{return!1}}}class Ro{static createAdapter(e){return new Io(e)}}const Xr=[{name:"Ollama (æœ¬åœ°)",baseURL:"http://localhost:11434/v1",model:"llama3.2",apiKey:"ollama",temperature:.7,maxTokens:2048},{name:"OpenAI",baseURL:"https://api.openai.com/v1",model:"gpt-3.5-turbo",apiKey:"",temperature:.7,maxTokens:2048},{name:"DeepSeek",baseURL:"https://api.deepseek.com/v1",model:"deepseek-chat",apiKey:"",temperature:.7,maxTokens:2048},{name:"Moonshot",baseURL:"https://api.moonshot.cn/v1",model:"moonshot-v1-8k",apiKey:"",temperature:.7,maxTokens:2048},{name:"æ™ºè°±AI (GLM-4-Flash)",baseURL:"https://open.bigmodel.cn/api/paas/v4",model:"glm-4-flash",apiKey:"",temperature:.7,maxTokens:4096},{name:"è‡ªå®šä¹‰ OpenAI æ ¼å¼",baseURL:"",model:"",apiKey:"",temperature:.7,maxTokens:2048}],Qt={chat:"",polish:"ä¼˜åŒ–ä»¥ä¸‹æ–‡æœ¬çš„è¡¨è¾¾ï¼Œä½¿å…¶æ›´æµç•…ã€ä¸“ä¸šã€‚ä¿æŒåŽŸæ„ï¼Œä»…è¾“å‡ºä¿®æ”¹åŽçš„æ–‡æœ¬ï¼š",translate:"å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆç›®æ ‡è¯­è¨€ï¼ˆä¸­æ–‡â†’è‹±æ–‡ï¼Œè‹±æ–‡â†’ä¸­æ–‡ï¼‰ã€‚ä¿æŒåŽŸæ„å’Œè¯­æ°”ï¼Œä»…è¾“å‡ºè¯‘æ–‡ï¼š",summarize:"æç‚¼ä»¥ä¸‹æ–‡æœ¬çš„æ ¸å¿ƒè¦ç‚¹ï¼Œç”¨3-5å¥è¯æ¦‚æ‹¬å…³é”®ä¿¡æ¯ã€‚ä»…è¾“å‡ºæ€»ç»“å†…å®¹ï¼š",expand:"åŸºäºŽä»¥ä¸‹å†…å®¹è¿›è¡Œæ‰©å±•ï¼Œå¢žåŠ ç›¸å…³ç»†èŠ‚å’Œè§£é‡Šï¼Œä½¿å†…å®¹æ›´ä¸°å¯Œå®Œæ•´ã€‚ä¿æŒä¸»é¢˜ä¸€è‡´ï¼š",condense:"åŽ‹ç¼©ä»¥ä¸‹æ–‡æœ¬ï¼ŒåŽ»é™¤å†—ä½™æè¿°å’Œé‡å¤ä¿¡æ¯ï¼Œä¿ç•™æ ¸å¿ƒè§‚ç‚¹å’Œå…³é”®æ•°æ®ï¼š",rewrite:"æ”¹å†™ä»¥ä¸‹æ–‡æœ¬ï¼Œè°ƒæ•´ä¸ºæ­£å¼ä¹¦é¢è¯­é£Žæ ¼ï¼Œé€‚ç”¨äºŽå­¦æœ¯æˆ–å•†åŠ¡åœºæ™¯ï¼š",continue:"å»¶ç»­ä»¥ä¸‹æ–‡æœ¬çš„é£Žæ ¼å’Œä¸»é¢˜ï¼Œåˆç†ç»­å†™åŽç»­å†…å®¹ï¼Œä¿æŒé€»è¾‘è¿žè´¯ï¼š",custom1:"",custom2:"",custom3:""},To=[{id:"custom1",name:"è‡ªå®šä¹‰1",icon:"âœ¨",prompt:"",enabled:!1},{id:"custom2",name:"è‡ªå®šä¹‰2",icon:"ðŸ”§",prompt:"",enabled:!1},{id:"custom3",name:"è‡ªå®šä¹‰3",icon:"ðŸŽ¯",prompt:"",enabled:!1}],Mo={polish:!0,translate:!0,summarize:!0,expand:!0,condense:!1,rewrite:!1,continue:!1,custom1:!1,custom2:!1,custom3:!1};class sl{constructor(){V(this,"adapter",null);V(this,"provider",null)}setProvider(e){this.provider=e,this.adapter=Ro.createAdapter(e)}getCurrentProvider(){return this.provider}isConfigured(){return this.adapter!==null&&this.provider!==null}async*streamChat(e){if(!this.adapter)throw new Error("AI provider not configured");let t="";await this.adapter.streamChatCompletion(e,n=>{if(n.content&&(t+=n.content),n.error)throw n.error});for(const n of t)yield n,await new Promise(r=>setTimeout(r,10))}async processText(e,t){if(!this.adapter)throw new Error("AI provider not configured");if(t==="chat")throw new Error("Use streamChat for chat operation");const n=Qt[t];if(!n)throw new Error(`Unknown operation: ${t}`);const r=[{role:"system",content:"You are a helpful writing assistant."},{role:"user",content:`${n}

${e}`}];return this.adapter.chatCompletion(r)}async testConnection(){return this.adapter?this.adapter.testConnection():!1}buildOperationMessages(e,t,n){const r=n||Qt[t];return[{role:"system",content:"You are a helpful writing assistant. Respond only with the processed text, no explanations."},{role:"user",content:`${r}

${e}`}]}}V(sl,"DEFAULT_PROMPTS",Qt);const ge=new sl,Kr="ai-assistant-settings";class Oo{constructor(){V(this,"plugin",null);V(this,"settings",this.getDefaultSettings())}init(e){this.plugin=e}async loadSettings(){if(this.plugin)try{const e=await this.plugin.loadData(Kr);e&&(this.settings={...this.getDefaultSettings(),...e})}catch{}}async saveSettings(){if(this.plugin)try{await this.plugin.saveData(Kr,this.settings)}catch{}}getSettings(){return{...this.settings}}async updateSettings(e){this.settings={...this.settings,...e},await this.saveSettings()}async addProvider(e){const t=[...this.settings.providers];(e.isDefault||t.length===0)&&(t.forEach(n=>n.isDefault=!1),e.isDefault=!0),t.push(e),this.settings.providers=t,e.isDefault&&(this.settings.currentProviderId=e.id),await this.saveSettings()}async updateProvider(e,t){const n=this.settings.providers.findIndex(i=>i.id===e);if(n===-1)return;const r=this.settings.providers[n];t.isDefault&&t.isDefault!==r.isDefault&&(this.settings.providers.forEach(i=>i.isDefault=!1),this.settings.currentProviderId=e),this.settings.providers[n]={...r,...t},await this.saveSettings()}async deleteProvider(e){const t=this.settings.providers.findIndex(r=>r.id===e);if(t===-1)return;const n=this.settings.providers[t].isDefault;this.settings.providers.splice(t,1),n&&this.settings.providers.length>0?(this.settings.providers[0].isDefault=!0,this.settings.currentProviderId=this.settings.providers[0].id):this.settings.providers.length===0&&(this.settings.currentProviderId=null),await this.saveSettings()}getProvider(e){return this.settings.providers.find(t=>t.id===e)}getCurrentProvider(){return this.settings.currentProviderId&&this.getProvider(this.settings.currentProviderId)||null}async setCurrentProvider(e){const t=this.getProvider(e);t&&(this.settings.providers.forEach(n=>n.isDefault=!1),t.isDefault=!0,this.settings.currentProviderId=e,await this.saveSettings())}getConversations(){return[...this.settings.conversations]}async addConversation(e){const t=this.settings.conversations.findIndex(n=>n.id===e.id);t>=0?this.settings.conversations[t]=e:this.settings.conversations.push(e),await this.saveSettings()}async deleteConversation(e){this.settings.conversations=this.settings.conversations.filter(t=>t.id!==e),await this.saveSettings()}getCustomButtons(){return[...this.settings.customButtons]}async updateCustomButtons(e){this.settings.customButtons=e,await this.saveSettings()}getToolbarButtons(){return{...this.settings.toolbarButtons}}async updateToolbarButtons(e){this.settings.toolbarButtons=e,await this.saveSettings()}getDefaultSettings(){const e={id:"ollama-default",name:"Ollama (æœ¬åœ°)",apiKey:"ollama",baseURL:"http://localhost:11434/v1",model:"llama3.2",temperature:.7,maxTokens:2048,isDefault:!0};return{providers:[e],currentProviderId:e.id,conversations:[],operationPrompts:Qt,uiMode:"both",diffHighlightStyle:"word",showFloatingToolbar:!0,showContextMenu:!0,autoApplyOnAccept:!1,maxConcurrentRequests:3,requestTimeout:6e4,customButtons:To,toolbarButtons:Mo,enableLocalMode:!0,redactSensitiveInfo:!1}}}const Q=new Oo;class Fo{getSelectedText(){const e=window.getSelection();return!e||e.rangeCount===0?"":e.toString().trim()}getSelectedBlockIds(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),n=new Set,r=t.commonAncestorContainer,i=r.nodeType===Node.ELEMENT_NODE?r:r.parentElement;if(i){const a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>o.hasAttribute("data-node-id")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});let l;for(;l=a.nextNode();){const o=l.getAttribute("data-node-id");o&&n.add(o)}}if(n.size===0){let a=t.startContainer;for(;a;){if(a.nodeType===Node.ELEMENT_NODE){const o=a.getAttribute("data-node-id");if(o){n.add(o);break}}a=a.parentElement}let l=t.endContainer;for(;l;){if(l.nodeType===Node.ELEMENT_NODE){const o=l.getAttribute("data-node-id");if(o){n.add(o);break}}l=l.parentElement}}if(n.size===0){const a=document.querySelector(".protyle-wysiwyg--select");if(a){const l=a.getAttribute("data-node-id");l&&n.add(l)}}if(n.size===0){const a=window.getSelection();if(a&&a.rangeCount>0){const l=a.getRangeAt(0);let o=l.startContainer.nodeType===Node.ELEMENT_NODE?l.startContainer:l.startContainer.parentElement;for(;o;){if(o.classList&&(o.classList.contains("p")||o.classList.contains("h1")||o.classList.contains("h2")||o.classList.contains("h3")||o.classList.contains("h4")||o.classList.contains("h5")||o.classList.contains("h6")||o.classList.contains("li")||o.classList.contains("blockquote")||o.classList.contains("code-block"))){const c=o.getAttribute("data-node-id");if(c){n.add(c);break}}o=o.parentElement}}}return Array.from(n)}getCurrentBlockId(){const e=this.getSelectedBlockIds();return e.length>0?e[0]:null}async getBlockContent(e){try{const t=await fetch("/api/block/getBlockInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok)throw new Error(`Failed to get block: ${t.statusText}`);const n=await t.json();if(n.code!==0||!n.data)return null;const r=n.data;return{id:r.id,type:r.type,subtype:r.subtype,content:r.content||"",markdown:r.markdown}}catch{return null}}async updateBlock(e,t){try{const n=await fetch("/api/block/updateBlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,data:t,dataType:"markdown"})});if(!n.ok)throw new Error(`Failed to update block: ${n.statusText}`);return(await n.json()).code===0}catch{return!1}}async insertBlockAfter(e,t){try{const n=await fetch("/api/block/insertBlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({previousID:e,data:t,dataType:"markdown"})});if(!n.ok)throw new Error(`Failed to insert block: ${n.statusText}`);const r=await n.json();return r.code===0&&r.data&&r.data[0]?r.data[0].id:null}catch{return null}}getSelectionRange(){const e=window.getSelection();if(!e||e.rangeCount===0)return{text:"",rect:null};const n=e.getRangeAt(0).getBoundingClientRect();return{text:e.toString().trim(),rect:n}}clearSelection(){const e=window.getSelection();e&&e.removeAllRanges()}async replaceSelectedText(e,t,n){try{const r=await this.getBlockContent(e);if(!r)return{success:!1,error:"æ— æ³•èŽ·å–å—å†…å®¹"};let i=r.content;if(!t)return{success:!0,content:i};let a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(a,"");if(l.test(i))return{success:!0,content:i.replace(l,n)};const o=t.trim();if(a=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(a,""),l.test(i)){const h=i.substring(0,i.indexOf(o)),f=i.substring(i.indexOf(o)+o.length);return{success:!0,content:h+n+f}}const c=i.trim(),u=c.indexOf(o);if(u!==-1){const h=i.substring(0,i.indexOf(c.substring(0,u>0?u:0))),f=i.indexOf(c)+u+o.length,m=i.substring(f);return{success:!0,content:h+n+m}}return await this.smartReplaceByDOMSelection(e,t,n)}catch(r){return{success:!1,error:String(r)}}}async smartReplaceByDOMSelection(e,t,n){try{const r=await this.getBlockContent(e);if(!r)return{success:!1,error:"æ— æ³•èŽ·å–å—å†…å®¹"};const i=window.getSelection();if(!i||i.rangeCount===0)return{success:!0,content:n};const a=i.getRangeAt(0),l=a.startOffset,o=a.endOffset,c=[t,t.trim(),t.replace(/\s+/g," ")];let u="",h=-1;for(const f of c){const m=r.content.indexOf(f);if(m!==-1){u=f,h=m;break}}if(h!==-1){const f=r.content.substring(0,h),m=r.content.substring(h+u.length);return{success:!0,content:f+n+m}}return{success:!0,content:n}}catch(r){return{success:!1,error:String(r)}}}}const kt=new Fo;function Gr(s,e,t){const n=s.slice();return n[26]=e[t],n}function Qr(s,e,t){const n=s.slice();return n[31]=e[t],n}function Yr(s,e,t){const n=s.slice();return n[26]=e[t],n}function Zr(s,e,t){const n=s.slice();return n[34]=e[t],n}function ei(s){let e,t,n,r,i,a,l,o,c,u,h=ue(s[5]),f=[];for(let p=0;p<h.length;p+=1)f[p]=ti(Zr(s,h,p));let m=s[5].length===0&&ni();return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="å¯¹è¯åŽ†å²",r=A(),i=w("button"),i.textContent="âœ•",a=A(),l=w("div");for(let p=0;p<f.length;p+=1)f[p].c();o=A(),m&&m.c(),g(n,"class","svelte-ou36hp"),g(i,"class","btn-close svelte-ou36hp"),g(t,"class","history-header svelte-ou36hp"),g(l,"class","history-list svelte-ou36hp"),g(e,"class","history-sidebar svelte-ou36hp")},m(p,_){U(p,e,_),d(e,t),d(t,n),d(t,r),d(t,i),d(e,a),d(e,l);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(l,null);d(l,o),m&&m.m(l,null),c||(u=O(i,"click",s[16]),c=!0)},p(p,_){if(_[0]&12336){h=ue(p[5]);let b;for(b=0;b<h.length;b+=1){const y=Zr(p,h,b);f[b]?f[b].p(y,_):(f[b]=ti(y),f[b].c(),f[b].m(l,o))}for(;b<f.length;b+=1)f[b].d(1);f.length=h.length}p[5].length===0?m||(m=ni(),m.c(),m.m(l,null)):m&&(m.d(1),m=null)},d(p){p&&j(e),Qe(f,p),m&&m.d(),c=!1,u()}}}function ti(s){let e,t,n=s[34].title+"",r,i,a,l=new Date(s[34].updatedAt).toLocaleDateString()+"",o,c,u,h,f;function m(..._){return s[17](s[34],..._)}function p(){return s[18](s[34])}return{c(){e=w("div"),t=w("div"),r=q(n),i=A(),a=w("div"),o=q(l),c=A(),u=w("button"),u.textContent="ðŸ—‘ï¸",g(t,"class","history-title svelte-ou36hp"),g(u,"class","btn-delete svelte-ou36hp"),g(a,"class","history-meta svelte-ou36hp"),g(e,"class","history-item svelte-ou36hp"),ce(e,"active",s[34].id===s[4])},m(_,b){U(_,e,b),d(e,t),d(t,r),d(e,i),d(e,a),d(a,o),d(a,c),d(a,u),h||(f=[O(u,"click",m),O(e,"click",p)],h=!0)},p(_,b){s=_,b[0]&32&&n!==(n=s[34].title+"")&&Y(r,n),b[0]&32&&l!==(l=new Date(s[34].updatedAt).toLocaleDateString()+"")&&Y(o,l),b[0]&48&&ce(e,"active",s[34].id===s[4])},d(_){_&&j(e),h=!1,Ee(f)}}}function ni(s){let e;return{c(){e=w("div"),e.textContent="æš‚æ— åŽ†å²å¯¹è¯",g(e,"class","history-empty svelte-ou36hp")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function Lo(s){let e,t,n=ue(s[1]),r=[];for(let a=0;a<n.length;a+=1)r[a]=si(Qr(s,n,a));let i=s[3]&&ri();return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=A(),i&&i.c(),t=Li()},m(a,l){for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(a,l);U(a,e,l),i&&i.m(a,l),U(a,t,l)},p(a,l){if(l[0]&2){n=ue(a[1]);let o;for(o=0;o<n.length;o+=1){const c=Qr(a,n,o);r[o]?r[o].p(c,l):(r[o]=si(c),r[o].c(),r[o].m(e.parentNode,e))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}a[3]?i||(i=ri(),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(a){a&&(j(e),j(t)),Qe(r,a),i&&i.d(a)}}}function Bo(s){let e,t,n,r,i,a,l,o,c=ue(s[8]),u=[];for(let h=0;h<c.length;h+=1)u[h]=ii(Yr(s,c,h));return{c(){e=w("div"),t=w("div"),t.textContent="ðŸ¤–",n=A(),r=w("h2"),r.textContent="AIåŠ©æ‰‹",i=A(),a=w("p"),a.textContent="é€‰æ‹©æ–‡æœ¬å¹¶ä½¿ç”¨å¿«æ·æ“ä½œï¼Œæˆ–ç›´æŽ¥å¼€å§‹å¯¹è¯",l=A(),o=w("div");for(let h=0;h<u.length;h+=1)u[h].c();g(t,"class","welcome-icon svelte-ou36hp"),g(r,"class","svelte-ou36hp"),g(a,"class","svelte-ou36hp"),g(o,"class","quick-actions svelte-ou36hp"),g(e,"class","welcome-message svelte-ou36hp")},m(h,f){U(h,e,f),d(e,t),d(e,n),d(e,r),d(e,i),d(e,a),d(e,l),d(e,o);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(o,null)},p(h,f){if(f[0]&1280){c=ue(h[8]);let m;for(m=0;m<c.length;m+=1){const p=Yr(h,c,m);u[m]?u[m].p(p,f):(u[m]=ii(p),u[m].c(),u[m].m(o,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=c.length}},d(h){h&&j(e),Qe(u,h)}}}function si(s){let e,t,n=s[31].role==="user"?"ðŸ‘¤":"ðŸ¤–",r,i,a,l,o=s[31].content+"",c,u,h,f=oi(s[31].timestamp)+"",m;return{c(){e=w("div"),t=w("div"),r=q(n),i=A(),a=w("div"),l=w("div"),c=q(o),u=A(),h=w("div"),m=q(f),g(t,"class","message-avatar svelte-ou36hp"),g(l,"class","message-text svelte-ou36hp"),g(h,"class","message-time svelte-ou36hp"),g(a,"class","message-content svelte-ou36hp"),g(e,"class","message svelte-ou36hp"),ce(e,"user",s[31].role==="user"),ce(e,"assistant",s[31].role==="assistant")},m(p,_){U(p,e,_),d(e,t),d(t,r),d(e,i),d(e,a),d(a,l),d(l,c),d(a,u),d(a,h),d(h,m)},p(p,_){_[0]&2&&n!==(n=p[31].role==="user"?"ðŸ‘¤":"ðŸ¤–")&&Y(r,n),_[0]&2&&o!==(o=p[31].content+"")&&Y(c,o),_[0]&2&&f!==(f=oi(p[31].timestamp)+"")&&Y(m,f),_[0]&2&&ce(e,"user",p[31].role==="user"),_[0]&2&&ce(e,"assistant",p[31].role==="assistant")},d(p){p&&j(e)}}}function ri(s){let e;return{c(){e=w("div"),e.innerHTML='<div class="message-avatar svelte-ou36hp">ðŸ¤–</div> <div class="message-content svelte-ou36hp"><div class="typing-indicator svelte-ou36hp"><span class="svelte-ou36hp"></span> <span class="svelte-ou36hp"></span> <span class="svelte-ou36hp"></span></div></div>',g(e,"class","message assistant streaming svelte-ou36hp")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function ii(s){let e,t,n,r,i,a,l;function o(){return s[19](s[26])}return{c(){e=w("button"),t=w("span"),t.textContent=`${s[26].icon}`,n=A(),r=w("span"),r.textContent=`${s[26].label}`,i=A(),g(t,"class","icon"),g(e,"class","quick-action-btn svelte-ou36hp")},m(c,u){U(c,e,u),d(e,t),d(e,n),d(e,r),d(e,i),a||(l=O(e,"click",o),a=!0)},p(c,u){s=c},d(c){c&&j(e),a=!1,l()}}}function ai(s){let e,t=ue(s[8]),n=[];for(let r=0;r<t.length;r+=1)n[r]=li(Gr(s,t,r));return{c(){e=w("div");for(let r=0;r<n.length;r+=1)n[r].c();g(e,"class","quick-actions-bar svelte-ou36hp")},m(r,i){U(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(r,i){if(i[0]&1288){t=ue(r[8]);let a;for(a=0;a<t.length;a+=1){const l=Gr(r,t,a);n[a]?n[a].p(l,i):(n[a]=li(l),n[a].c(),n[a].m(e,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=t.length}},d(r){r&&j(e),Qe(n,r)}}}function li(s){let e,t=s[26].icon+"",n,r,i=s[26].label+"",a,l,o,c;function u(){return s[21](s[26])}return{c(){e=w("button"),n=q(t),r=A(),a=q(i),l=A(),g(e,"class","quick-action-chip svelte-ou36hp"),e.disabled=s[3]},m(h,f){U(h,e,f),d(e,n),d(e,r),d(e,a),d(e,l),o||(c=O(e,"click",u),o=!0)},p(h,f){s=h,f[0]&8&&(e.disabled=s[3])},d(h){h&&j(e),o=!1,c()}}}function xo(s){let e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y,v,E,k=s[3]?"â³":"âž¤",P,C,S,M,R=s[6]&&ei(s);function F(L,x){return L[1].length===0?Bo:Lo}let I=F(s),T=I(s),D=s[1].length>0&&ai(s);return{c(){e=w("div"),t=w("div"),n=w("div"),n.innerHTML='<span class="icon svelte-ou36hp">ðŸ¤–</span> <span>AIåŠ©æ‰‹</span>',r=A(),i=w("div"),a=w("button"),a.textContent="ðŸ“š",l=A(),o=w("button"),o.textContent="âž•",c=A(),u=w("button"),u.textContent="âš™ï¸",h=A(),R&&R.c(),f=A(),m=w("div"),T.c(),p=A(),D&&D.c(),_=A(),b=w("div"),y=w("textarea"),v=A(),E=w("button"),P=q(k),g(n,"class","header-title svelte-ou36hp"),g(a,"class","btn-icon svelte-ou36hp"),g(a,"title","åŽ†å²è®°å½•"),g(o,"class","btn-icon svelte-ou36hp"),g(o,"title","æ–°å¯¹è¯"),g(u,"class","btn-icon svelte-ou36hp"),g(u,"title","è®¾ç½®"),g(i,"class","header-actions svelte-ou36hp"),g(t,"class","chat-header svelte-ou36hp"),g(m,"class","messages-container svelte-ou36hp"),g(y,"placeholder","è¾“å…¥æ¶ˆæ¯... (Enterå‘é€, Shift+Enteræ¢è¡Œ)"),y.disabled=s[3],g(y,"rows","2"),g(y,"class","svelte-ou36hp"),g(E,"class","send-btn svelte-ou36hp"),E.disabled=C=!s[2].trim()||s[3],g(b,"class","input-area svelte-ou36hp"),g(e,"class","ai-chat-panel svelte-ou36hp")},m(L,x){U(L,e,x),d(e,t),d(t,n),d(t,r),d(t,i),d(i,a),d(i,l),d(i,o),d(i,c),d(i,u),d(e,h),R&&R.m(e,null),d(e,f),d(e,m),T.m(m,null),s[20](m),d(e,p),D&&D.m(e,null),d(e,_),d(e,b),d(b,y),te(y,s[2]),d(b,v),d(b,E),d(E,P),S||(M=[O(a,"click",s[15]),O(o,"click",s[11]),O(u,"click",function(){tn(s[0])&&s[0].apply(this,arguments)}),O(y,"input",s[22]),O(y,"keydown",s[14]),O(E,"click",s[9])],S=!0)},p(L,x){s=L,s[6]?R?R.p(s,x):(R=ei(s),R.c(),R.m(e,f)):R&&(R.d(1),R=null),I===(I=F(s))&&T?T.p(s,x):(T.d(1),T=I(s),T&&(T.c(),T.m(m,null))),s[1].length>0?D?D.p(s,x):(D=ai(s),D.c(),D.m(e,_)):D&&(D.d(1),D=null),x[0]&8&&(y.disabled=s[3]),x[0]&4&&te(y,s[2]),x[0]&8&&k!==(k=s[3]?"â³":"âž¤")&&Y(P,k),x[0]&12&&C!==(C=!s[2].trim()||s[3])&&(E.disabled=C)},i:ze,o:ze,d(L){L&&j(e),R&&R.d(),T.d(),s[20](null),D&&D.d(),S=!1,Ee(M)}}}function wt(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function oi(s){return new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}function No(s,e,t){let{onOpenSettings:n=()=>{}}=e,r=[],i="",a=!1,l=null,o=[],c=!1,u;const h=[{type:"polish",label:"æ¶¦è‰²",icon:"âœ¨"},{type:"translate",label:"ç¿»è¯‘",icon:"ðŸŒ"},{type:"summarize",label:"æ€»ç»“",icon:"ðŸ“"},{type:"expand",label:"æ‰©å†™",icon:"ðŸ“–"}];Ss(()=>{f();const D=Q.getCurrentProvider();D&&ge.setProvider(D)});function f(){t(5,o=Q.getConversations())}async function m(){if(!i.trim()||a)return;const D={id:wt(),role:"user",content:i.trim(),timestamp:Date.now()};t(1,r=[...r,D]),t(2,i=""),t(3,a=!0),k();try{const L=[{role:"system",content:"You are a helpful assistant."},...r.map(ee=>({role:ee.role,content:ee.content}))];let x="";const G={id:wt(),role:"assistant",content:"",timestamp:Date.now()};t(1,r=[...r,G]),await ge.streamChat(L),x=(await ge.processText(D.content,"chat").catch(async()=>{var ae;return await((ae=ge.adapter)==null?void 0:ae.chatCompletion(L))||{content:"Sorry, I could not process your request."}})).content;const H=r.findIndex(ee=>ee.id===G.id);H>=0&&(t(1,r[H]={...G,content:x},r),t(1,r=[...r])),await _()}catch(L){console.error("[AI Assistant] Chat error:",L),t(1,r=[...r,{id:wt(),role:"assistant",content:"æŠ±æ­‰ï¼Œå¤„ç†è¯·æ±‚æ—¶å‡ºé”™ã€‚è¯·æ£€æŸ¥AIæä¾›å•†é…ç½®ã€‚",timestamp:Date.now()}])}finally{t(3,a=!1),k()}}async function p(D){const L=kt.getSelectedText();if(!L){t(2,i=Qt[D]);return}const x={id:wt(),role:"user",content:`[${D}] ${L.substring(0,50)}...`,timestamp:Date.now()};t(1,r=[...r,x]),t(3,a=!0),k();try{const G=await ge.processText(L,D);t(1,r=[...r,{id:wt(),role:"assistant",content:G.content,timestamp:Date.now()}]),await _()}catch(G){console.error("[AI Assistant] Action error:",G),t(1,r=[...r,{id:wt(),role:"assistant",content:"å¤„ç†å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚",timestamp:Date.now()}])}finally{t(3,a=!1),k()}}async function _(){var x;if(r.length===0)return;const D=r[0].content.substring(0,30)+(r[0].content.length>30?"...":""),L={id:l||wt(),title:D,messages:[...r],createdAt:l&&((x=o.find(G=>G.id===l))==null?void 0:x.createdAt)||Date.now(),updatedAt:Date.now()};t(4,l=L.id),await Q.addConversation(L),f()}function b(){r.length>0&&_(),t(1,r=[]),t(4,l=null)}function y(D){const L=o.find(x=>x.id===D);L&&(t(1,r=[...L.messages]),t(4,l=D),t(6,c=!1),k())}async function v(D,L){L.stopPropagation(),confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ")&&(await Q.deleteConversation(D),l===D&&b(),f())}function E(D){D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),m())}function k(){hl().then(()=>{u&&t(7,u.scrollTop=u.scrollHeight,u)})}const P=()=>t(6,c=!c),C=()=>t(6,c=!1),S=(D,L)=>v(D.id,L),M=D=>y(D.id),R=D=>p(D.type);function F(D){as[D?"unshift":"push"](()=>{u=D,t(7,u)})}const I=D=>p(D.type);function T(){i=this.value,t(2,i)}return s.$$set=D=>{"onOpenSettings"in D&&t(0,n=D.onOpenSettings)},[n,r,i,a,l,o,c,u,h,m,p,b,y,v,E,P,C,S,M,R,F,I,T]}class jo extends Es{constructor(e){super(),Cs(this,e,No,xo,ks,{onOpenSettings:0},null,[-1,-1])}}function ci(s,e,t){const n=s.slice();return n[74]=e[t],n[75]=e,n[76]=t,n}function ui(s,e,t){const n=s.slice();return n[71]=e[t],n}function hi(s,e,t){const n=s.slice();return n[68]=e[t],n}function zo(s){let e,t,n,r,i,a,l=ue(s[3]),o=[];for(let u=0;u<l.length;u+=1)o[u]=fi(ci(s,l,u));let c=s[10]&&di(s);return{c(){e=w("div"),t=w("h3"),t.textContent="è‡ªå®šä¹‰æŒ‰é’®é…ç½®",n=A(),r=w("p"),r.textContent="é…ç½®ä¸‰ä¸ªè‡ªå®šä¹‰æ“ä½œæŒ‰é’®ï¼ˆå¯ç”¨åŽä¼šè‡ªåŠ¨åŒæ­¥åˆ°å·¥å…·æ ï¼‰",i=A();for(let u=0;u<o.length;u+=1)o[u].c();a=A(),c&&c.c(),g(r,"class","section-desc svelte-j5ryrz"),g(e,"class","prompts-section")},m(u,h){U(u,e,h),d(e,t),d(e,n),d(e,r),d(e,i);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null);d(e,a),c&&c.m(e,null)},p(u,h){if(h[0]&2621448){l=ue(u[3]);let f;for(f=0;f<l.length;f+=1){const m=ci(u,l,f);o[f]?o[f].p(m,h):(o[f]=fi(m),o[f].c(),o[f].m(e,a))}for(;f<o.length;f+=1)o[f].d(1);o.length=l.length}u[10]?c?c.p(u,h):(c=di(u),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(u){u&&j(e),Qe(o,u),c&&c.d()}}}function Uo(s){let e;return{c(){e=w("div"),e.innerHTML='<h3>ç•Œé¢è®¾ç½®</h3> <p class="section-desc svelte-j5ryrz">MVPç‰ˆæœ¬æš‚ä¸æ”¯æŒç•Œé¢è‡ªå®šä¹‰</p>',g(e,"class","ui-section")},m(t,n){U(t,e,n)},p:ze,d(t){t&&j(e)}}}function $o(s){var hr,fr,dr,mr,pr,gr;let e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y,v,E,k,P,C,S,M,R,F,I,T,D,L,x,G,X,H,ee,ae,Te,K,Se,Ae,Ye,rt,Ve,Ze,Pe,Me,Oe,Ce,mt,Ue,et=(((hr=s[3][0])==null?void 0:hr.name)||"è‡ªå®šä¹‰1")+"",le,pt,Fe=(((fr=s[3][0])==null?void 0:fr.icon)||"âœ¨")+"",oe,gt,Le,he,be,J,ne=(((dr=s[3][1])==null?void 0:dr.name)||"è‡ªå®šä¹‰2")+"",zt,un,Ct=(((mr=s[3][1])==null?void 0:mr.icon)||"ðŸ”§")+"",Ut,hn,it,qe,fn,_t,N=(((pr=s[3][2])==null?void 0:pr.name)||"è‡ªå®šä¹‰3")+"",fe,at,tt=(((gr=s[3][2])==null?void 0:gr.icon)||"ðŸŽ¯")+"",lt,cr,Xn,ur,De=s[10]&&mi(s);return{c(){e=w("div"),t=w("h3"),t.textContent="æµ®åŠ¨å·¥å…·æ æŒ‰é’®",n=A(),r=w("p"),r.textContent="é€‰æ‹©åœ¨æµ®åŠ¨å·¥å…·æ ä¸­æ˜¾ç¤ºå“ªäº›æŒ‰é’®",i=A(),a=w("div"),l=w("label"),o=w("input"),c=A(),u=w("span"),u.textContent="âœ¨ æ¶¦è‰²",h=A(),f=w("label"),m=w("input"),p=A(),_=w("span"),_.textContent="ðŸŒ ç¿»è¯‘",b=A(),y=w("label"),v=w("input"),E=A(),k=w("span"),k.textContent="ðŸ“ æ€»ç»“",P=A(),C=w("label"),S=w("input"),M=A(),R=w("span"),R.textContent="ðŸ“– æ‰©å†™",F=A(),I=w("label"),T=w("input"),D=A(),L=w("span"),L.textContent="ðŸ“„ ç²¾ç®€",x=A(),G=w("label"),X=w("input"),H=A(),ee=w("span"),ee.textContent="ðŸ”„ æ”¹å†™",ae=A(),Te=w("label"),K=w("input"),Se=A(),Ae=w("span"),Ae.textContent="âž¡ï¸ ç»­å†™",Ye=A(),rt=w("h4"),rt.textContent="è‡ªå®šä¹‰æŒ‰é’®",Ve=A(),Ze=w("p"),Ze.textContent='åœ¨"è‡ªå®šä¹‰æç¤ºè¯"Tabä¸­é…ç½®åŽä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¿™é‡Œ',Pe=A(),Me=w("div"),Oe=w("label"),Ce=w("input"),mt=A(),Ue=w("span"),le=q(et),pt=A(),oe=q(Fe),gt=A(),Le=w("label"),he=w("input"),be=A(),J=w("span"),zt=q(ne),un=A(),Ut=q(Ct),hn=A(),it=w("label"),qe=w("input"),fn=A(),_t=w("span"),fe=q(N),at=A(),lt=q(tt),cr=A(),De&&De.c(),g(r,"class","section-desc svelte-j5ryrz"),g(o,"type","checkbox"),g(o,"class","svelte-j5ryrz"),g(l,"class","checkbox-item svelte-j5ryrz"),g(m,"type","checkbox"),g(m,"class","svelte-j5ryrz"),g(f,"class","checkbox-item svelte-j5ryrz"),g(v,"type","checkbox"),g(v,"class","svelte-j5ryrz"),g(y,"class","checkbox-item svelte-j5ryrz"),g(S,"type","checkbox"),g(S,"class","svelte-j5ryrz"),g(C,"class","checkbox-item svelte-j5ryrz"),g(T,"type","checkbox"),g(T,"class","svelte-j5ryrz"),g(I,"class","checkbox-item svelte-j5ryrz"),g(X,"type","checkbox"),g(X,"class","svelte-j5ryrz"),g(G,"class","checkbox-item svelte-j5ryrz"),g(K,"type","checkbox"),g(K,"class","svelte-j5ryrz"),g(Te,"class","checkbox-item svelte-j5ryrz"),g(a,"class","checkbox-list svelte-j5ryrz"),g(Ze,"class","section-desc svelte-j5ryrz"),g(Ce,"type","checkbox"),g(Ce,"class","svelte-j5ryrz"),g(Oe,"class","checkbox-item svelte-j5ryrz"),g(he,"type","checkbox"),g(he,"class","svelte-j5ryrz"),g(Le,"class","checkbox-item svelte-j5ryrz"),g(qe,"type","checkbox"),g(qe,"class","svelte-j5ryrz"),g(it,"class","checkbox-item svelte-j5ryrz"),g(Me,"class","checkbox-list svelte-j5ryrz"),g(e,"class","toolbar-section")},m(se,de){U(se,e,de),d(e,t),d(e,n),d(e,r),d(e,i),d(e,a),d(a,l),d(l,o),o.checked=s[4].polish,d(l,c),d(l,u),d(a,h),d(a,f),d(f,m),m.checked=s[4].translate,d(f,p),d(f,_),d(a,b),d(a,y),d(y,v),v.checked=s[4].summarize,d(y,E),d(y,k),d(a,P),d(a,C),d(C,S),S.checked=s[4].expand,d(C,M),d(C,R),d(a,F),d(a,I),d(I,T),T.checked=s[4].condense,d(I,D),d(I,L),d(a,x),d(a,G),d(G,X),X.checked=s[4].rewrite,d(G,H),d(G,ee),d(a,ae),d(a,Te),d(Te,K),K.checked=s[4].continue,d(Te,Se),d(Te,Ae),d(e,Ye),d(e,rt),d(e,Ve),d(e,Ze),d(e,Pe),d(e,Me),d(Me,Oe),d(Oe,Ce),Ce.checked=s[4].custom1,d(Oe,mt),d(Oe,Ue),d(Ue,le),d(Ue,pt),d(Ue,oe),d(Me,gt),d(Me,Le),d(Le,he),he.checked=s[4].custom2,d(Le,be),d(Le,J),d(J,zt),d(J,un),d(J,Ut),d(Me,hn),d(Me,it),d(it,qe),qe.checked=s[4].custom3,d(it,fn),d(it,_t),d(_t,fe),d(_t,at),d(_t,lt),d(e,cr),De&&De.m(e,null),Xn||(ur=[O(o,"change",s[36]),O(o,"change",s[37]),O(m,"change",s[38]),O(m,"change",s[39]),O(v,"change",s[40]),O(v,"change",s[41]),O(S,"change",s[42]),O(S,"change",s[43]),O(T,"change",s[44]),O(T,"change",s[45]),O(X,"change",s[46]),O(X,"change",s[47]),O(K,"change",s[48]),O(K,"change",s[49]),O(Ce,"change",s[50]),O(Ce,"change",s[51]),O(he,"change",s[52]),O(he,"change",s[53]),O(qe,"change",s[54]),O(qe,"change",s[55])],Xn=!0)},p(se,de){var _r,br,wr,vr,yr,kr;de[0]&16&&(o.checked=se[4].polish),de[0]&16&&(m.checked=se[4].translate),de[0]&16&&(v.checked=se[4].summarize),de[0]&16&&(S.checked=se[4].expand),de[0]&16&&(T.checked=se[4].condense),de[0]&16&&(X.checked=se[4].rewrite),de[0]&16&&(K.checked=se[4].continue),de[0]&16&&(Ce.checked=se[4].custom1),de[0]&8&&et!==(et=(((_r=se[3][0])==null?void 0:_r.name)||"è‡ªå®šä¹‰1")+"")&&Y(le,et),de[0]&8&&Fe!==(Fe=(((br=se[3][0])==null?void 0:br.icon)||"âœ¨")+"")&&Y(oe,Fe),de[0]&16&&(he.checked=se[4].custom2),de[0]&8&&ne!==(ne=(((wr=se[3][1])==null?void 0:wr.name)||"è‡ªå®šä¹‰2")+"")&&Y(zt,ne),de[0]&8&&Ct!==(Ct=(((vr=se[3][1])==null?void 0:vr.icon)||"ðŸ”§")+"")&&Y(Ut,Ct),de[0]&16&&(qe.checked=se[4].custom3),de[0]&8&&N!==(N=(((yr=se[3][2])==null?void 0:yr.name)||"è‡ªå®šä¹‰3")+"")&&Y(fe,N),de[0]&8&&tt!==(tt=(((kr=se[3][2])==null?void 0:kr.icon)||"ðŸŽ¯")+"")&&Y(lt,tt),se[10]?De?De.p(se,de):(De=mi(se),De.c(),De.m(e,null)):De&&(De.d(1),De=null)},d(se){se&&j(e),De&&De.d(),Xn=!1,Ee(ur)}}}function Ho(s){let e;function t(i,a){return i[5]?Vo:Wo}let n=t(s),r=n(s);return{c(){e=w("div"),r.c(),g(e,"class","providers-section")},m(i,a){U(i,e,a),r.m(e,null)},p(i,a){n===(n=t(i))&&r?r.p(i,a):(r.d(1),r=n(i),r&&(r.c(),r.m(e,null)))},d(i){i&&j(e),r.d()}}}function fi(s){let e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y,v,E,k,P,C,S,M;function R(){s[56].call(i,s[75],s[76])}function F(){return s[57](s[76])}function I(){s[58].call(f,s[75],s[76])}function T(){s[60].call(y,s[75],s[76])}function D(){s[62].call(C,s[75],s[76])}return{c(){e=w("div"),t=w("h4"),t.textContent=`è‡ªå®šä¹‰æŒ‰é’® ${s[76]+1}`,n=A(),r=w("label"),i=w("input"),a=A(),l=w("span"),l.textContent="å¯ç”¨æ­¤æŒ‰é’®",o=A(),c=w("div"),u=w("label"),u.textContent="æŒ‰é’®åç§°",h=A(),f=w("input"),m=A(),p=w("div"),_=w("label"),_.textContent="å›¾æ ‡ (emoji)",b=A(),y=w("input"),v=A(),E=w("div"),k=w("label"),k.textContent="AIæç¤ºè¯",P=A(),C=w("textarea"),g(t,"class","svelte-j5ryrz"),g(i,"type","checkbox"),g(i,"class","svelte-j5ryrz"),g(r,"class","checkbox-item svelte-j5ryrz"),g(u,"class","svelte-j5ryrz"),g(f,"type","text"),g(f,"placeholder","æŒ‰é’®æ˜¾ç¤ºåç§°"),g(f,"class","svelte-j5ryrz"),g(c,"class","form-group svelte-j5ryrz"),g(_,"class","svelte-j5ryrz"),g(y,"type","text"),g(y,"placeholder","âœ¨"),g(y,"maxlength","2"),g(y,"class","svelte-j5ryrz"),g(p,"class","form-group svelte-j5ryrz"),g(k,"class","svelte-j5ryrz"),g(C,"placeholder","è¾“å…¥AIæç¤ºè¯ï¼Œä¾‹å¦‚ï¼šè¯·å°†ä»¥ä¸‹å†…å®¹è½¬æ¢æˆè¡¨æ ¼å½¢å¼ï¼š"),g(C,"rows","3"),g(C,"class","svelte-j5ryrz"),g(E,"class","form-group svelte-j5ryrz"),g(e,"class","custom-button-form svelte-j5ryrz")},m(L,x){U(L,e,x),d(e,t),d(e,n),d(e,r),d(r,i),i.checked=s[74].enabled,d(r,a),d(r,l),d(e,o),d(e,c),d(c,u),d(c,h),d(c,f),te(f,s[74].name),d(e,m),d(e,p),d(p,_),d(p,b),d(p,y),te(y,s[74].icon),d(e,v),d(e,E),d(E,k),d(E,P),d(E,C),te(C,s[74].prompt),S||(M=[O(i,"change",R),O(i,"change",F),O(f,"input",I),O(f,"input",s[59]),O(y,"input",T),O(y,"input",s[61]),O(C,"input",D),O(C,"input",s[63])],S=!0)},p(L,x){s=L,x[0]&8&&(i.checked=s[74].enabled),x[0]&8&&f.value!==s[74].name&&te(f,s[74].name),x[0]&8&&y.value!==s[74].icon&&te(y,s[74].icon),x[0]&8&&te(C,s[74].prompt)},d(L){L&&j(e),S=!1,Ee(M)}}}function di(s){let e,t;return{c(){e=w("div"),t=q(s[10]),g(e,"class","save-message svelte-j5ryrz")},m(n,r){U(n,e,r),d(e,t)},p(n,r){r[0]&1024&&Y(t,n[10])},d(n){n&&j(e)}}}function mi(s){let e,t;return{c(){e=w("div"),t=q(s[10]),g(e,"class","save-message svelte-j5ryrz")},m(n,r){U(n,e,r),d(e,t)},p(n,r){r[0]&1024&&Y(t,n[10])},d(n){n&&j(e)}}}function Wo(s){let e,t,n,r,i,a,l,o;function c(f,m){return f[2].length===0?Jo:qo}let u=c(s),h=u(s);return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="å·²é…ç½®çš„æä¾›å•†",r=A(),i=w("button"),i.textContent="+ æ·»åŠ æä¾›å•†",a=A(),h.c(),g(n,"class","svelte-j5ryrz"),g(i,"class","btn-primary svelte-j5ryrz"),g(t,"class","section-header svelte-j5ryrz"),g(e,"class","providers-list svelte-j5ryrz")},m(f,m){U(f,e,m),d(e,t),d(t,n),d(t,r),d(t,i),d(e,a),h.m(e,null),l||(o=O(i,"click",s[11]),l=!0)},p(f,m){u===(u=c(f))&&h?h.p(f,m):(h.d(1),h=u(f),h&&(h.c(),h.m(e,null)))},d(f){f&&j(e),h.d(),l=!1,o()}}}function Vo(s){let e,t,n=s[6]?"æ·»åŠ æä¾›å•†":"ç¼–è¾‘æä¾›å•†",r,i,a,l,o,c,u,h,f,m,p,_,b,y,v,E,k,P,C,S,M,R,F,I,T,D,L,x,G,X,H,ee,ae,Te,K,Se,Ae,Ye,rt,Ve,Ze,Pe,Me,Oe,Ce,mt,Ue,et,le=s[6]&&bi(s);function pt(J,ne){if(J[7]==="success")return Ko;if(J[7]==="error")return Xo}let Fe=pt(s),oe=Fe&&Fe(s);function gt(J,ne){return J[7]==="testing"?Qo:Go}let Le=gt(s),he=Le(s),be=!s[9]&&vi();return{c(){e=w("div"),t=w("h3"),r=q(n),i=A(),le&&le.c(),a=A(),l=w("div"),o=w("label"),o.textContent="åç§° *",c=A(),u=w("input"),h=A(),f=w("div"),m=w("label"),m.textContent="APIåœ°å€ *",p=A(),_=w("input"),b=A(),y=w("div"),v=w("label"),v.textContent="APIå¯†é’¥",E=A(),k=w("input"),P=A(),C=w("div"),S=w("label"),S.textContent="æ¨¡åž‹åç§° *",M=A(),R=w("input"),F=A(),I=w("div"),T=w("div"),D=w("label"),D.textContent="æ¸©åº¦ (0-2)",L=A(),x=w("input"),G=A(),X=w("div"),H=w("label"),H.textContent="æœ€å¤§Token",ee=A(),ae=w("input"),Te=A(),oe&&oe.c(),K=A(),Se=w("div"),Ae=w("button"),he.c(),rt=A(),Ve=w("button"),Ve.textContent="å–æ¶ˆ",Ze=A(),Pe=w("button"),Me=q("ä¿å­˜"),mt=A(),be&&be.c(),g(t,"class","svelte-j5ryrz"),g(o,"class","svelte-j5ryrz"),g(u,"type","text"),g(u,"placeholder","ä¾‹å¦‚ï¼šOllamaæœ¬åœ°"),g(u,"class","svelte-j5ryrz"),g(l,"class","form-group svelte-j5ryrz"),g(m,"class","svelte-j5ryrz"),g(_,"type","text"),g(_,"placeholder","http://localhost:11434/v1"),g(_,"class","svelte-j5ryrz"),g(f,"class","form-group svelte-j5ryrz"),g(v,"class","svelte-j5ryrz"),g(k,"type","password"),g(k,"placeholder","sk-..."),g(k,"class","svelte-j5ryrz"),g(y,"class","form-group svelte-j5ryrz"),g(S,"class","svelte-j5ryrz"),g(R,"type","text"),g(R,"placeholder","llama3.2"),g(R,"class","svelte-j5ryrz"),g(C,"class","form-group svelte-j5ryrz"),g(D,"class","svelte-j5ryrz"),g(x,"type","number"),g(x,"min","0"),g(x,"max","2"),g(x,"step","0.1"),g(x,"class","svelte-j5ryrz"),g(T,"class","form-group svelte-j5ryrz"),g(H,"class","svelte-j5ryrz"),g(ae,"type","number"),g(ae,"min","100"),g(ae,"max","8192"),g(ae,"class","svelte-j5ryrz"),g(X,"class","form-group svelte-j5ryrz"),g(I,"class","form-row svelte-j5ryrz"),g(Ae,"class","btn-test svelte-j5ryrz"),Ae.disabled=Ye=s[7]==="testing",g(Ve,"class","btn-secondary svelte-j5ryrz"),g(Pe,"class","btn-primary svelte-j5ryrz"),Pe.disabled=Oe=!s[9],g(Pe,"title",Ce=s[9]?"":"è¯·å…ˆé€šè¿‡è¿žæŽ¥æµ‹è¯•"),g(Se,"class","form-actions svelte-j5ryrz"),g(e,"class","provider-form svelte-j5ryrz")},m(J,ne){U(J,e,ne),d(e,t),d(t,r),d(e,i),le&&le.m(e,null),d(e,a),d(e,l),d(l,o),d(l,c),d(l,u),te(u,s[5].name),d(e,h),d(e,f),d(f,m),d(f,p),d(f,_),te(_,s[5].baseURL),d(e,b),d(e,y),d(y,v),d(y,E),d(y,k),te(k,s[5].apiKey),d(e,P),d(e,C),d(C,S),d(C,M),d(C,R),te(R,s[5].model),d(e,F),d(e,I),d(I,T),d(T,D),d(T,L),d(T,x),te(x,s[5].temperature),d(I,G),d(I,X),d(X,H),d(X,ee),d(X,ae),te(ae,s[5].maxTokens),d(e,Te),oe&&oe.m(e,null),d(e,K),d(e,Se),d(Se,Ae),he.m(Ae,null),d(Se,rt),d(Se,Ve),d(Se,Ze),d(Se,Pe),d(Pe,Me),d(e,mt),be&&be.m(e,null),Ue||(et=[O(u,"input",s[27]),O(_,"input",s[28]),O(k,"input",s[29]),O(R,"input",s[30]),O(x,"input",s[31]),O(ae,"input",s[32]),O(Ae,"click",s[16]),O(Ve,"click",s[13]),O(Pe,"click",s[14])],Ue=!0)},p(J,ne){ne[0]&64&&n!==(n=J[6]?"æ·»åŠ æä¾›å•†":"ç¼–è¾‘æä¾›å•†")&&Y(r,n),J[6]?le?le.p(J,ne):(le=bi(J),le.c(),le.m(e,a)):le&&(le.d(1),le=null),ne[0]&32&&u.value!==J[5].name&&te(u,J[5].name),ne[0]&32&&_.value!==J[5].baseURL&&te(_,J[5].baseURL),ne[0]&32&&k.value!==J[5].apiKey&&te(k,J[5].apiKey),ne[0]&32&&R.value!==J[5].model&&te(R,J[5].model),ne[0]&32&&In(x.value)!==J[5].temperature&&te(x,J[5].temperature),ne[0]&32&&In(ae.value)!==J[5].maxTokens&&te(ae,J[5].maxTokens),Fe===(Fe=pt(J))&&oe?oe.p(J,ne):(oe&&oe.d(1),oe=Fe&&Fe(J),oe&&(oe.c(),oe.m(e,K))),Le!==(Le=gt(J))&&(he.d(1),he=Le(J),he&&(he.c(),he.m(Ae,null))),ne[0]&128&&Ye!==(Ye=J[7]==="testing")&&(Ae.disabled=Ye),ne[0]&512&&Oe!==(Oe=!J[9])&&(Pe.disabled=Oe),ne[0]&512&&Ce!==(Ce=J[9]?"":"è¯·å…ˆé€šè¿‡è¿žæŽ¥æµ‹è¯•")&&g(Pe,"title",Ce),J[9]?be&&(be.d(1),be=null):be||(be=vi(),be.c(),be.m(e,null))},d(J){J&&j(e),le&&le.d(),oe&&oe.d(),he.d(),be&&be.d(),Ue=!1,Ee(et)}}}function qo(s){let e,t=ue(s[2]),n=[];for(let r=0;r<t.length;r+=1)n[r]=_i(ui(s,t,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=Li()},m(r,i){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,i);U(r,e,i)},p(r,i){if(i[0]&167940){t=ue(r[2]);let a;for(a=0;a<t.length;a+=1){const l=ui(r,t,a);n[a]?n[a].p(l,i):(n[a]=_i(l),n[a].c(),n[a].m(e.parentNode,e))}for(;a<n.length;a+=1)n[a].d(1);n.length=t.length}},d(r){r&&j(e),Qe(n,r)}}}function Jo(s){let e,t,n,r,i,a;return{c(){e=w("div"),t=w("p"),t.textContent="æš‚æ— é…ç½®çš„AIæä¾›å•†",n=A(),r=w("button"),r.textContent="æ·»åŠ ç¬¬ä¸€ä¸ªæä¾›å•†",g(t,"class","svelte-j5ryrz"),g(r,"class","btn-primary svelte-j5ryrz"),g(e,"class","empty-state svelte-j5ryrz")},m(l,o){U(l,e,o),d(e,t),d(e,n),d(e,r),i||(a=O(r,"click",s[11]),i=!0)},p:ze,d(l){l&&j(e),i=!1,a()}}}function pi(s){let e;return{c(){e=w("span"),e.textContent="é»˜è®¤",g(e,"class","badge svelte-j5ryrz")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function gi(s){let e,t,n;function r(){return s[33](s[71])}return{c(){e=w("button"),e.textContent="è®¾ä¸ºé»˜è®¤",g(e,"class","btn-text svelte-j5ryrz")},m(i,a){U(i,e,a),t||(n=O(e,"click",r),t=!0)},p(i,a){s=i},d(i){i&&j(e),t=!1,n()}}}function _i(s){let e,t,n,r=s[71].name+"",i,a,l,o,c=s[71].model+"",u,h,f=s[71].baseURL+"",m,p,_,b,y,v,E,k,P,C,S=s[71].isDefault&&pi(),M=!s[71].isDefault&&gi(s);function R(){return s[34](s[71])}function F(){return s[35](s[71])}return{c(){e=w("div"),t=w("div"),n=w("div"),i=q(r),a=A(),S&&S.c(),l=A(),o=w("div"),u=q(c),h=q(" @ "),m=q(f),p=A(),_=w("div"),M&&M.c(),b=A(),y=w("button"),y.textContent="âœï¸",v=A(),E=w("button"),E.textContent="ðŸ—‘ï¸",k=A(),g(n,"class","provider-name svelte-j5ryrz"),g(o,"class","provider-details svelte-j5ryrz"),g(t,"class","provider-info"),g(y,"class","btn-icon svelte-j5ryrz"),g(E,"class","btn-icon svelte-j5ryrz"),g(_,"class","provider-actions svelte-j5ryrz"),g(e,"class","provider-card svelte-j5ryrz"),ce(e,"default",s[71].isDefault)},m(I,T){U(I,e,T),d(e,t),d(t,n),d(n,i),d(n,a),S&&S.m(n,null),d(t,l),d(t,o),d(o,u),d(o,h),d(o,m),d(e,p),d(e,_),M&&M.m(_,null),d(_,b),d(_,y),d(_,v),d(_,E),d(e,k),P||(C=[O(y,"click",R),O(E,"click",F)],P=!0)},p(I,T){s=I,T[0]&4&&r!==(r=s[71].name+"")&&Y(i,r),s[71].isDefault?S||(S=pi(),S.c(),S.m(n,null)):S&&(S.d(1),S=null),T[0]&4&&c!==(c=s[71].model+"")&&Y(u,c),T[0]&4&&f!==(f=s[71].baseURL+"")&&Y(m,f),s[71].isDefault?M&&(M.d(1),M=null):M?M.p(s,T):(M=gi(s),M.c(),M.m(_,b)),T[0]&4&&ce(e,"default",s[71].isDefault)},d(I){I&&j(e),S&&S.d(),M&&M.d(),P=!1,Ee(C)}}}function bi(s){let e,t,n,r=ue(Xr),i=[];for(let a=0;a<r.length;a+=1)i[a]=wi(hi(s,r,a));return{c(){e=w("div"),t=w("label"),t.textContent="å¿«é€Ÿæ¨¡æ¿ï¼š",n=A();for(let a=0;a<i.length;a+=1)i[a].c();g(t,"class","svelte-j5ryrz"),g(e,"class","template-buttons svelte-j5ryrz")},m(a,l){U(a,e,l),d(e,t),d(e,n);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null)},p(a,l){if(l[0]&262144){r=ue(Xr);let o;for(o=0;o<r.length;o+=1){const c=hi(a,r,o);i[o]?i[o].p(c,l):(i[o]=wi(c),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(a){a&&j(e),Qe(i,a)}}}function wi(s){let e,t,n;function r(){return s[26](s[68])}return{c(){e=w("button"),e.textContent=`${s[68].name} `,g(e,"class","template-btn svelte-j5ryrz")},m(i,a){U(i,e,a),t||(n=O(e,"click",r),t=!0)},p(i,a){s=i},d(i){i&&j(e),t=!1,n()}}}function Xo(s){let e,t,n,r,i;return{c(){e=w("div"),t=w("div"),t.textContent="âŒ è¿žæŽ¥å¤±è´¥",n=A(),r=w("div"),i=q(s[8]),g(t,"class","test-result-header svelte-j5ryrz"),g(r,"class","test-result-content svelte-j5ryrz"),g(e,"class","test-result error svelte-j5ryrz")},m(a,l){U(a,e,l),d(e,t),d(e,n),d(e,r),d(r,i)},p(a,l){l[0]&256&&Y(i,a[8])},d(a){a&&j(e)}}}function Ko(s){let e,t,n,r,i;return{c(){e=w("div"),t=w("div"),t.textContent="âœ… è¿žæŽ¥æˆåŠŸ",n=A(),r=w("div"),i=q(s[8]),g(t,"class","test-result-header svelte-j5ryrz"),g(r,"class","test-result-content svelte-j5ryrz"),g(e,"class","test-result success svelte-j5ryrz")},m(a,l){U(a,e,l),d(e,t),d(e,n),d(e,r),d(r,i)},p(a,l){l[0]&256&&Y(i,a[8])},d(a){a&&j(e)}}}function Go(s){let e;return{c(){e=q("æµ‹è¯•è¿žæŽ¥")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function Qo(s){let e;return{c(){e=q("æµ‹è¯•ä¸­...")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function vi(s){let e;return{c(){e=w("div"),e.textContent='âš ï¸ è¯·å…ˆç‚¹å‡»"æµ‹è¯•è¿žæŽ¥"æŒ‰é’®ï¼Œæµ‹è¯•é€šè¿‡åŽæ‰èƒ½ä¿å­˜',g(e,"class","test-warning svelte-j5ryrz")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function Yo(s){let e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y,v;function E(C,S){if(C[1]==="providers")return Ho;if(C[1]==="toolbar")return $o;if(C[1]==="ui")return Uo;if(C[1]==="prompts")return zo}let k=E(s),P=k&&k(s);return{c(){e=w("div"),t=w("div"),n=w("h2"),n.textContent="âš™ï¸ AIåŠ©æ‰‹è®¾ç½®",r=A(),i=w("button"),i.textContent="âœ•",a=A(),l=w("div"),o=w("button"),o.textContent="AIæä¾›å•†",c=A(),u=w("button"),u.textContent="å·¥å…·æ ",h=A(),f=w("button"),f.textContent="ç•Œé¢è®¾ç½®",m=A(),p=w("button"),p.textContent="è‡ªå®šä¹‰æç¤ºè¯",_=A(),b=w("div"),P&&P.c(),g(n,"class","svelte-j5ryrz"),g(i,"class","btn-close svelte-j5ryrz"),g(t,"class","settings-header svelte-j5ryrz"),g(o,"class","tab-btn svelte-j5ryrz"),ce(o,"active",s[1]==="providers"),g(u,"class","tab-btn svelte-j5ryrz"),ce(u,"active",s[1]==="toolbar"),g(f,"class","tab-btn svelte-j5ryrz"),ce(f,"active",s[1]==="ui"),g(p,"class","tab-btn svelte-j5ryrz"),ce(p,"active",s[1]==="prompts"),g(l,"class","settings-tabs svelte-j5ryrz"),g(b,"class","settings-content svelte-j5ryrz"),g(e,"class","settings-panel svelte-j5ryrz")},m(C,S){U(C,e,S),d(e,t),d(t,n),d(t,r),d(t,i),d(e,a),d(e,l),d(l,o),d(l,c),d(l,u),d(l,h),d(l,f),d(l,m),d(l,p),d(e,_),d(e,b),P&&P.m(b,null),y||(v=[O(i,"click",function(){tn(s[0])&&s[0].apply(this,arguments)}),O(o,"click",s[22]),O(u,"click",s[23]),O(f,"click",s[24]),O(p,"click",s[25])],y=!0)},p(C,S){s=C,S[0]&2&&ce(o,"active",s[1]==="providers"),S[0]&2&&ce(u,"active",s[1]==="toolbar"),S[0]&2&&ce(f,"active",s[1]==="ui"),S[0]&2&&ce(p,"active",s[1]==="prompts"),k===(k=E(s))&&P?P.p(s,S):(P&&P.d(1),P=k&&k(s),P&&(P.c(),P.m(b,null)))},i:ze,o:ze,d(C){C&&j(e),P&&P.d(),y=!1,Ee(v)}}}function Zo(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function ec(s,e,t){let{onClose:n=()=>{}}=e,r="providers",i=[],a=[],l={polish:!0,translate:!0,summarize:!0,expand:!0,condense:!1,rewrite:!1,continue:!1,custom1:!1,custom2:!1,custom3:!1},o=null,c=!1,u="idle",h="",f=!1;Ss(()=>{m()});function m(){const N=Q.getSettings();t(2,i=N.providers),t(3,a=N.customButtons),t(4,l=N.toolbarButtons)}function p(){t(6,c=!0),t(5,o={id:Zo(),name:"",apiKey:"",baseURL:"",model:"",temperature:.7,maxTokens:2048,isDefault:i.length===0})}function _(N){t(6,c=!1),t(5,o={...N})}function b(){t(5,o=null),t(6,c=!1),t(7,u="idle")}async function y(){if(o){if(!o.name||!o.baseURL||!o.model){alert("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ");return}c?await Q.addProvider(o):await Q.updateProvider(o.id,o),m(),t(5,o=null),t(6,c=!1)}}async function v(N){confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæä¾›å•†å—ï¼Ÿ")&&(await Q.deleteProvider(N),m())}async function E(){var fe;if(!o)return;t(7,u="testing"),t(8,h=""),t(9,f=!1);const N=ge.getCurrentProvider();ge.setProvider(o);try{const tt=[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹ã€‚"},{role:"user",content:"ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•"}],lt=await((fe=ge.adapter)==null?void 0:fe.chatCompletion(tt));lt&&lt.content&&lt.content.length>0?(t(7,u="success"),t(8,h=lt.content),t(9,f=!0)):(t(7,u="error"),t(8,h="AIè¿”å›žç©ºå†…å®¹"),t(9,f=!1))}catch(at){t(7,u="error"),t(8,h=at instanceof Error?at.message:"è¿žæŽ¥å¤±è´¥"),t(9,f=!1)}finally{N&&ge.setProvider(N)}}async function k(N){await Q.setCurrentProvider(N),m()}function P(N){o&&t(5,o={...o,name:N.name,baseURL:N.baseURL,model:N.model,apiKey:N.apiKey,temperature:N.temperature,maxTokens:N.maxTokens})}async function C(){await Q.updateCustomButtons(a),await M(),I("è‡ªå®šä¹‰æŒ‰é’®é…ç½®å·²ä¿å­˜")}async function S(){await Q.updateToolbarButtons(l),I("å·¥å…·æ é…ç½®å·²ä¿å­˜")}async function M(){const N=Q.getSettings().toolbarButtons;a.forEach((fe,at)=>{const tt=`custom${at+1}`;tt in N&&t(4,l[tt]=fe.enabled,l)}),await Q.updateToolbarButtons(l)}let R="",F=null;function I(N){t(10,R=N),F&&clearTimeout(F),F=window.setTimeout(()=>{t(10,R="")},2e3)}function T(N){const fe=`custom${N+1}`;fe in l&&t(4,l[fe]=a[N].enabled,l),Promise.all([Q.updateCustomButtons(a),Q.updateToolbarButtons(l)]).then(()=>{I("å·²è‡ªåŠ¨ä¿å­˜")})}const D=()=>t(1,r="providers"),L=()=>t(1,r="toolbar"),x=()=>t(1,r="ui"),G=()=>t(1,r="prompts"),X=N=>P(N);function H(){o.name=this.value,t(5,o)}function ee(){o.baseURL=this.value,t(5,o)}function ae(){o.apiKey=this.value,t(5,o)}function Te(){o.model=this.value,t(5,o)}function K(){o.temperature=In(this.value),t(5,o)}function Se(){o.maxTokens=In(this.value),t(5,o)}const Ae=N=>k(N.id),Ye=N=>_(N),rt=N=>v(N.id);function Ve(){l.polish=this.checked,t(4,l)}const Ze=()=>S();function Pe(){l.translate=this.checked,t(4,l)}const Me=()=>S();function Oe(){l.summarize=this.checked,t(4,l)}const Ce=()=>S();function mt(){l.expand=this.checked,t(4,l)}const Ue=()=>S();function et(){l.condense=this.checked,t(4,l)}const le=()=>S();function pt(){l.rewrite=this.checked,t(4,l)}const Fe=()=>S();function oe(){l.continue=this.checked,t(4,l)}const gt=()=>S();function Le(){l.custom1=this.checked,t(4,l)}const he=()=>S();function be(){l.custom2=this.checked,t(4,l)}const J=()=>S();function ne(){l.custom3=this.checked,t(4,l)}const zt=()=>S();function un(N,fe){N[fe].enabled=this.checked,t(3,a)}const Ct=N=>T(N);function Ut(N,fe){N[fe].name=this.value,t(3,a)}const hn=()=>C();function it(N,fe){N[fe].icon=this.value,t(3,a)}const qe=()=>C();function fn(N,fe){N[fe].prompt=this.value,t(3,a)}const _t=()=>C();return s.$$set=N=>{"onClose"in N&&t(0,n=N.onClose)},[n,r,i,a,l,o,c,u,h,f,R,p,_,b,y,v,E,k,P,C,S,T,D,L,x,G,X,H,ee,ae,Te,K,Se,Ae,Ye,rt,Ve,Ze,Pe,Me,Oe,Ce,mt,Ue,et,le,pt,Fe,oe,gt,Le,he,be,J,ne,zt,un,Ct,Ut,hn,it,qe,fn,_t]}class tc extends Es{constructor(e){super(),Cs(this,e,ec,Yo,ks,{onClose:0},null,[-1,-1,-1])}}function nc(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var rl={exports:{}};(function(s){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,r=0;e.Diff=function(i,a){return[i,a]},e.prototype.diff_main=function(i,a,l,o){typeof o>"u"&&(this.Diff_Timeout<=0?o=Number.MAX_VALUE:o=new Date().getTime()+this.Diff_Timeout*1e3);var c=o;if(i==null||a==null)throw new Error("Null input. (diff_main)");if(i==a)return i?[new e.Diff(r,i)]:[];typeof l>"u"&&(l=!0);var u=l,h=this.diff_commonPrefix(i,a),f=i.substring(0,h);i=i.substring(h),a=a.substring(h),h=this.diff_commonSuffix(i,a);var m=i.substring(i.length-h);i=i.substring(0,i.length-h),a=a.substring(0,a.length-h);var p=this.diff_compute_(i,a,u,c);return f&&p.unshift(new e.Diff(r,f)),m&&p.push(new e.Diff(r,m)),this.diff_cleanupMerge(p),p},e.prototype.diff_compute_=function(i,a,l,o){var c;if(!i)return[new e.Diff(n,a)];if(!a)return[new e.Diff(t,i)];var u=i.length>a.length?i:a,h=i.length>a.length?a:i,f=u.indexOf(h);if(f!=-1)return c=[new e.Diff(n,u.substring(0,f)),new e.Diff(r,h),new e.Diff(n,u.substring(f+h.length))],i.length>a.length&&(c[0][0]=c[2][0]=t),c;if(h.length==1)return[new e.Diff(t,i),new e.Diff(n,a)];var m=this.diff_halfMatch_(i,a);if(m){var p=m[0],_=m[1],b=m[2],y=m[3],v=m[4],E=this.diff_main(p,b,l,o),k=this.diff_main(_,y,l,o);return E.concat([new e.Diff(r,v)],k)}return l&&i.length>100&&a.length>100?this.diff_lineMode_(i,a,o):this.diff_bisect_(i,a,o)},e.prototype.diff_lineMode_=function(i,a,l){var o=this.diff_linesToChars_(i,a);i=o.chars1,a=o.chars2;var c=o.lineArray,u=this.diff_main(i,a,!1,l);this.diff_charsToLines_(u,c),this.diff_cleanupSemantic(u),u.push(new e.Diff(r,""));for(var h=0,f=0,m=0,p="",_="";h<u.length;){switch(u[h][0]){case n:m++,_+=u[h][1];break;case t:f++,p+=u[h][1];break;case r:if(f>=1&&m>=1){u.splice(h-f-m,f+m),h=h-f-m;for(var b=this.diff_main(p,_,!1,l),y=b.length-1;y>=0;y--)u.splice(h,0,b[y]);h=h+b.length}m=0,f=0,p="",_="";break}h++}return u.pop(),u},e.prototype.diff_bisect_=function(i,a,l){for(var o=i.length,c=a.length,u=Math.ceil((o+c)/2),h=u,f=2*u,m=new Array(f),p=new Array(f),_=0;_<f;_++)m[_]=-1,p[_]=-1;m[h+1]=0,p[h+1]=0;for(var b=o-c,y=b%2!=0,v=0,E=0,k=0,P=0,C=0;C<u&&!(new Date().getTime()>l);C++){for(var S=-C+v;S<=C-E;S+=2){var M=h+S,R;S==-C||S!=C&&m[M-1]<m[M+1]?R=m[M+1]:R=m[M-1]+1;for(var F=R-S;R<o&&F<c&&i.charAt(R)==a.charAt(F);)R++,F++;if(m[M]=R,R>o)E+=2;else if(F>c)v+=2;else if(y){var I=h+b-S;if(I>=0&&I<f&&p[I]!=-1){var T=o-p[I];if(R>=T)return this.diff_bisectSplit_(i,a,R,F,l)}}}for(var D=-C+k;D<=C-P;D+=2){var I=h+D,T;D==-C||D!=C&&p[I-1]<p[I+1]?T=p[I+1]:T=p[I-1]+1;for(var L=T-D;T<o&&L<c&&i.charAt(o-T-1)==a.charAt(c-L-1);)T++,L++;if(p[I]=T,T>o)P+=2;else if(L>c)k+=2;else if(!y){var M=h+b-D;if(M>=0&&M<f&&m[M]!=-1){var R=m[M],F=h+R-M;if(T=o-T,R>=T)return this.diff_bisectSplit_(i,a,R,F,l)}}}}return[new e.Diff(t,i),new e.Diff(n,a)]},e.prototype.diff_bisectSplit_=function(i,a,l,o,c){var u=i.substring(0,l),h=a.substring(0,o),f=i.substring(l),m=a.substring(o),p=this.diff_main(u,h,!1,c),_=this.diff_main(f,m,!1,c);return p.concat(_)},e.prototype.diff_linesToChars_=function(i,a){var l=[],o={};l[0]="";function c(m){for(var p="",_=0,b=-1,y=l.length;b<m.length-1;){b=m.indexOf(`
`,_),b==-1&&(b=m.length-1);var v=m.substring(_,b+1);(o.hasOwnProperty?o.hasOwnProperty(v):o[v]!==void 0)?p+=String.fromCharCode(o[v]):(y==u&&(v=m.substring(_),b=m.length),p+=String.fromCharCode(y),o[v]=y,l[y++]=v),_=b+1}return p}var u=4e4,h=c(i);u=65535;var f=c(a);return{chars1:h,chars2:f,lineArray:l}},e.prototype.diff_charsToLines_=function(i,a){for(var l=0;l<i.length;l++){for(var o=i[l][1],c=[],u=0;u<o.length;u++)c[u]=a[o.charCodeAt(u)];i[l][1]=c.join("")}},e.prototype.diff_commonPrefix=function(i,a){if(!i||!a||i.charAt(0)!=a.charAt(0))return 0;for(var l=0,o=Math.min(i.length,a.length),c=o,u=0;l<c;)i.substring(u,c)==a.substring(u,c)?(l=c,u=l):o=c,c=Math.floor((o-l)/2+l);return c},e.prototype.diff_commonSuffix=function(i,a){if(!i||!a||i.charAt(i.length-1)!=a.charAt(a.length-1))return 0;for(var l=0,o=Math.min(i.length,a.length),c=o,u=0;l<c;)i.substring(i.length-c,i.length-u)==a.substring(a.length-c,a.length-u)?(l=c,u=l):o=c,c=Math.floor((o-l)/2+l);return c},e.prototype.diff_commonOverlap_=function(i,a){var l=i.length,o=a.length;if(l==0||o==0)return 0;l>o?i=i.substring(l-o):l<o&&(a=a.substring(0,l));var c=Math.min(l,o);if(i==a)return c;for(var u=0,h=1;;){var f=i.substring(c-h),m=a.indexOf(f);if(m==-1)return u;h+=m,(m==0||i.substring(c-h)==a.substring(0,h))&&(u=h,h++)}},e.prototype.diff_halfMatch_=function(i,a){if(this.Diff_Timeout<=0)return null;var l=i.length>a.length?i:a,o=i.length>a.length?a:i;if(l.length<4||o.length*2<l.length)return null;var c=this;function u(E,k,P){for(var C=E.substring(P,P+Math.floor(E.length/4)),S=-1,M="",R,F,I,T;(S=k.indexOf(C,S+1))!=-1;){var D=c.diff_commonPrefix(E.substring(P),k.substring(S)),L=c.diff_commonSuffix(E.substring(0,P),k.substring(0,S));M.length<L+D&&(M=k.substring(S-L,S)+k.substring(S,S+D),R=E.substring(0,P-L),F=E.substring(P+D),I=k.substring(0,S-L),T=k.substring(S+D))}return M.length*2>=E.length?[R,F,I,T,M]:null}var h=u(l,o,Math.ceil(l.length/4)),f=u(l,o,Math.ceil(l.length/2)),m;if(!h&&!f)return null;f?h?m=h[4].length>f[4].length?h:f:m=f:m=h;var p,_,b,y;i.length>a.length?(p=m[0],_=m[1],b=m[2],y=m[3]):(b=m[0],y=m[1],p=m[2],_=m[3]);var v=m[4];return[p,_,b,y,v]},e.prototype.diff_cleanupSemantic=function(i){for(var a=!1,l=[],o=0,c=null,u=0,h=0,f=0,m=0,p=0;u<i.length;)i[u][0]==r?(l[o++]=u,h=m,f=p,m=0,p=0,c=i[u][1]):(i[u][0]==n?m+=i[u][1].length:p+=i[u][1].length,c&&c.length<=Math.max(h,f)&&c.length<=Math.max(m,p)&&(i.splice(l[o-1],0,new e.Diff(t,c)),i[l[o-1]+1][0]=n,o--,o--,u=o>0?l[o-1]:-1,h=0,f=0,m=0,p=0,c=null,a=!0)),u++;for(a&&this.diff_cleanupMerge(i),this.diff_cleanupSemanticLossless(i),u=1;u<i.length;){if(i[u-1][0]==t&&i[u][0]==n){var _=i[u-1][1],b=i[u][1],y=this.diff_commonOverlap_(_,b),v=this.diff_commonOverlap_(b,_);y>=v?(y>=_.length/2||y>=b.length/2)&&(i.splice(u,0,new e.Diff(r,b.substring(0,y))),i[u-1][1]=_.substring(0,_.length-y),i[u+1][1]=b.substring(y),u++):(v>=_.length/2||v>=b.length/2)&&(i.splice(u,0,new e.Diff(r,_.substring(0,v))),i[u-1][0]=n,i[u-1][1]=b.substring(0,b.length-v),i[u+1][0]=t,i[u+1][1]=_.substring(v),u++),u++}u++}},e.prototype.diff_cleanupSemanticLossless=function(i){function a(v,E){if(!v||!E)return 6;var k=v.charAt(v.length-1),P=E.charAt(0),C=k.match(e.nonAlphaNumericRegex_),S=P.match(e.nonAlphaNumericRegex_),M=C&&k.match(e.whitespaceRegex_),R=S&&P.match(e.whitespaceRegex_),F=M&&k.match(e.linebreakRegex_),I=R&&P.match(e.linebreakRegex_),T=F&&v.match(e.blanklineEndRegex_),D=I&&E.match(e.blanklineStartRegex_);return T||D?5:F||I?4:C&&!M&&R?3:M||R?2:C||S?1:0}for(var l=1;l<i.length-1;){if(i[l-1][0]==r&&i[l+1][0]==r){var o=i[l-1][1],c=i[l][1],u=i[l+1][1],h=this.diff_commonSuffix(o,c);if(h){var f=c.substring(c.length-h);o=o.substring(0,o.length-h),c=f+c.substring(0,c.length-h),u=f+u}for(var m=o,p=c,_=u,b=a(o,c)+a(c,u);c.charAt(0)===u.charAt(0);){o+=c.charAt(0),c=c.substring(1)+u.charAt(0),u=u.substring(1);var y=a(o,c)+a(c,u);y>=b&&(b=y,m=o,p=c,_=u)}i[l-1][1]!=m&&(m?i[l-1][1]=m:(i.splice(l-1,1),l--),i[l][1]=p,_?i[l+1][1]=_:(i.splice(l+1,1),l--))}l++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(i){for(var a=!1,l=[],o=0,c=null,u=0,h=!1,f=!1,m=!1,p=!1;u<i.length;)i[u][0]==r?(i[u][1].length<this.Diff_EditCost&&(m||p)?(l[o++]=u,h=m,f=p,c=i[u][1]):(o=0,c=null),m=p=!1):(i[u][0]==t?p=!0:m=!0,c&&(h&&f&&m&&p||c.length<this.Diff_EditCost/2&&h+f+m+p==3)&&(i.splice(l[o-1],0,new e.Diff(t,c)),i[l[o-1]+1][0]=n,o--,c=null,h&&f?(m=p=!0,o=0):(o--,u=o>0?l[o-1]:-1,m=p=!1),a=!0)),u++;a&&this.diff_cleanupMerge(i)},e.prototype.diff_cleanupMerge=function(i){i.push(new e.Diff(r,""));for(var a=0,l=0,o=0,c="",u="",h;a<i.length;)switch(i[a][0]){case n:o++,u+=i[a][1],a++;break;case t:l++,c+=i[a][1],a++;break;case r:l+o>1?(l!==0&&o!==0&&(h=this.diff_commonPrefix(u,c),h!==0&&(a-l-o>0&&i[a-l-o-1][0]==r?i[a-l-o-1][1]+=u.substring(0,h):(i.splice(0,0,new e.Diff(r,u.substring(0,h))),a++),u=u.substring(h),c=c.substring(h)),h=this.diff_commonSuffix(u,c),h!==0&&(i[a][1]=u.substring(u.length-h)+i[a][1],u=u.substring(0,u.length-h),c=c.substring(0,c.length-h))),a-=l+o,i.splice(a,l+o),c.length&&(i.splice(a,0,new e.Diff(t,c)),a++),u.length&&(i.splice(a,0,new e.Diff(n,u)),a++),a++):a!==0&&i[a-1][0]==r?(i[a-1][1]+=i[a][1],i.splice(a,1)):a++,o=0,l=0,c="",u="";break}i[i.length-1][1]===""&&i.pop();var f=!1;for(a=1;a<i.length-1;)i[a-1][0]==r&&i[a+1][0]==r&&(i[a][1].substring(i[a][1].length-i[a-1][1].length)==i[a-1][1]?(i[a][1]=i[a-1][1]+i[a][1].substring(0,i[a][1].length-i[a-1][1].length),i[a+1][1]=i[a-1][1]+i[a+1][1],i.splice(a-1,1),f=!0):i[a][1].substring(0,i[a+1][1].length)==i[a+1][1]&&(i[a-1][1]+=i[a+1][1],i[a][1]=i[a][1].substring(i[a+1][1].length)+i[a+1][1],i.splice(a+1,1),f=!0)),a++;f&&this.diff_cleanupMerge(i)},e.prototype.diff_xIndex=function(i,a){var l=0,o=0,c=0,u=0,h;for(h=0;h<i.length&&(i[h][0]!==n&&(l+=i[h][1].length),i[h][0]!==t&&(o+=i[h][1].length),!(l>a));h++)c=l,u=o;return i.length!=h&&i[h][0]===t?u:u+(a-c)},e.prototype.diff_prettyHtml=function(i){for(var a=[],l=/&/g,o=/</g,c=/>/g,u=/\n/g,h=0;h<i.length;h++){var f=i[h][0],m=i[h][1],p=m.replace(l,"&amp;").replace(o,"&lt;").replace(c,"&gt;").replace(u,"&para;<br>");switch(f){case n:a[h]='<ins style="background:#e6ffe6;">'+p+"</ins>";break;case t:a[h]='<del style="background:#ffe6e6;">'+p+"</del>";break;case r:a[h]="<span>"+p+"</span>";break}}return a.join("")},e.prototype.diff_text1=function(i){for(var a=[],l=0;l<i.length;l++)i[l][0]!==n&&(a[l]=i[l][1]);return a.join("")},e.prototype.diff_text2=function(i){for(var a=[],l=0;l<i.length;l++)i[l][0]!==t&&(a[l]=i[l][1]);return a.join("")},e.prototype.diff_levenshtein=function(i){for(var a=0,l=0,o=0,c=0;c<i.length;c++){var u=i[c][0],h=i[c][1];switch(u){case n:l+=h.length;break;case t:o+=h.length;break;case r:a+=Math.max(l,o),l=0,o=0;break}}return a+=Math.max(l,o),a},e.prototype.diff_toDelta=function(i){for(var a=[],l=0;l<i.length;l++)switch(i[l][0]){case n:a[l]="+"+encodeURI(i[l][1]);break;case t:a[l]="-"+i[l][1].length;break;case r:a[l]="="+i[l][1].length;break}return a.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(i,a){for(var l=[],o=0,c=0,u=a.split(/\t/g),h=0;h<u.length;h++){var f=u[h].substring(1);switch(u[h].charAt(0)){case"+":try{l[o++]=new e.Diff(n,decodeURI(f))}catch{throw new Error("Illegal escape in diff_fromDelta: "+f)}break;case"-":case"=":var m=parseInt(f,10);if(isNaN(m)||m<0)throw new Error("Invalid number in diff_fromDelta: "+f);var p=i.substring(c,c+=m);u[h].charAt(0)=="="?l[o++]=new e.Diff(r,p):l[o++]=new e.Diff(t,p);break;default:if(u[h])throw new Error("Invalid diff operation in diff_fromDelta: "+u[h])}}if(c!=i.length)throw new Error("Delta length ("+c+") does not equal source text length ("+i.length+").");return l},e.prototype.match_main=function(i,a,l){if(i==null||a==null||l==null)throw new Error("Null input. (match_main)");return l=Math.max(0,Math.min(l,i.length)),i==a?0:i.length?i.substring(l,l+a.length)==a?l:this.match_bitap_(i,a,l):-1},e.prototype.match_bitap_=function(i,a,l){if(a.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet_(a),c=this;function u(R,F){var I=R/a.length,T=Math.abs(l-F);return c.Match_Distance?I+T/c.Match_Distance:T?1:I}var h=this.Match_Threshold,f=i.indexOf(a,l);f!=-1&&(h=Math.min(u(0,f),h),f=i.lastIndexOf(a,l+a.length),f!=-1&&(h=Math.min(u(0,f),h)));var m=1<<a.length-1;f=-1;for(var p,_,b=a.length+i.length,y,v=0;v<a.length;v++){for(p=0,_=b;p<_;)u(v,l+_)<=h?p=_:b=_,_=Math.floor((b-p)/2+p);b=_;var E=Math.max(1,l-_+1),k=Math.min(l+_,i.length)+a.length,P=Array(k+2);P[k+1]=(1<<v)-1;for(var C=k;C>=E;C--){var S=o[i.charAt(C-1)];if(v===0?P[C]=(P[C+1]<<1|1)&S:P[C]=(P[C+1]<<1|1)&S|((y[C+1]|y[C])<<1|1)|y[C+1],P[C]&m){var M=u(v,C-1);if(M<=h)if(h=M,f=C-1,f>l)E=Math.max(1,2*l-f);else break}}if(u(v+1,l)>h)break;y=P}return f},e.prototype.match_alphabet_=function(i){for(var a={},l=0;l<i.length;l++)a[i.charAt(l)]=0;for(var l=0;l<i.length;l++)a[i.charAt(l)]|=1<<i.length-l-1;return a},e.prototype.patch_addContext_=function(i,a){if(a.length!=0){if(i.start2===null)throw Error("patch not initialized");for(var l=a.substring(i.start2,i.start2+i.length1),o=0;a.indexOf(l)!=a.lastIndexOf(l)&&l.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)o+=this.Patch_Margin,l=a.substring(i.start2-o,i.start2+i.length1+o);o+=this.Patch_Margin;var c=a.substring(i.start2-o,i.start2);c&&i.diffs.unshift(new e.Diff(r,c));var u=a.substring(i.start2+i.length1,i.start2+i.length1+o);u&&i.diffs.push(new e.Diff(r,u)),i.start1-=c.length,i.start2-=c.length,i.length1+=c.length+u.length,i.length2+=c.length+u.length}},e.prototype.patch_make=function(i,a,l){var o,c;if(typeof i=="string"&&typeof a=="string"&&typeof l>"u")o=i,c=this.diff_main(o,a,!0),c.length>2&&(this.diff_cleanupSemantic(c),this.diff_cleanupEfficiency(c));else if(i&&typeof i=="object"&&typeof a>"u"&&typeof l>"u")c=i,o=this.diff_text1(c);else if(typeof i=="string"&&a&&typeof a=="object"&&typeof l>"u")o=i,c=a;else if(typeof i=="string"&&typeof a=="string"&&l&&typeof l=="object")o=i,c=l;else throw new Error("Unknown call format to patch_make.");if(c.length===0)return[];for(var u=[],h=new e.patch_obj,f=0,m=0,p=0,_=o,b=o,y=0;y<c.length;y++){var v=c[y][0],E=c[y][1];switch(!f&&v!==r&&(h.start1=m,h.start2=p),v){case n:h.diffs[f++]=c[y],h.length2+=E.length,b=b.substring(0,p)+E+b.substring(p);break;case t:h.length1+=E.length,h.diffs[f++]=c[y],b=b.substring(0,p)+b.substring(p+E.length);break;case r:E.length<=2*this.Patch_Margin&&f&&c.length!=y+1?(h.diffs[f++]=c[y],h.length1+=E.length,h.length2+=E.length):E.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(h,_),u.push(h),h=new e.patch_obj,f=0,_=b,m=p);break}v!==n&&(m+=E.length),v!==t&&(p+=E.length)}return f&&(this.patch_addContext_(h,_),u.push(h)),u},e.prototype.patch_deepCopy=function(i){for(var a=[],l=0;l<i.length;l++){var o=i[l],c=new e.patch_obj;c.diffs=[];for(var u=0;u<o.diffs.length;u++)c.diffs[u]=new e.Diff(o.diffs[u][0],o.diffs[u][1]);c.start1=o.start1,c.start2=o.start2,c.length1=o.length1,c.length2=o.length2,a[l]=c}return a},e.prototype.patch_apply=function(i,a){if(i.length==0)return[a,[]];i=this.patch_deepCopy(i);var l=this.patch_addPadding(i);a=l+a+l,this.patch_splitMax(i);for(var o=0,c=[],u=0;u<i.length;u++){var h=i[u].start2+o,f=this.diff_text1(i[u].diffs),m,p=-1;if(f.length>this.Match_MaxBits?(m=this.match_main(a,f.substring(0,this.Match_MaxBits),h),m!=-1&&(p=this.match_main(a,f.substring(f.length-this.Match_MaxBits),h+f.length-this.Match_MaxBits),(p==-1||m>=p)&&(m=-1))):m=this.match_main(a,f,h),m==-1)c[u]=!1,o-=i[u].length2-i[u].length1;else{c[u]=!0,o=m-h;var _;if(p==-1?_=a.substring(m,m+f.length):_=a.substring(m,p+this.Match_MaxBits),f==_)a=a.substring(0,m)+this.diff_text2(i[u].diffs)+a.substring(m+f.length);else{var b=this.diff_main(f,_,!1);if(f.length>this.Match_MaxBits&&this.diff_levenshtein(b)/f.length>this.Patch_DeleteThreshold)c[u]=!1;else{this.diff_cleanupSemanticLossless(b);for(var y=0,v,E=0;E<i[u].diffs.length;E++){var k=i[u].diffs[E];k[0]!==r&&(v=this.diff_xIndex(b,y)),k[0]===n?a=a.substring(0,m+v)+k[1]+a.substring(m+v):k[0]===t&&(a=a.substring(0,m+v)+a.substring(m+this.diff_xIndex(b,y+k[1].length))),k[0]!==t&&(y+=k[1].length)}}}}}return a=a.substring(l.length,a.length-l.length),[a,c]},e.prototype.patch_addPadding=function(i){for(var a=this.Patch_Margin,l="",o=1;o<=a;o++)l+=String.fromCharCode(o);for(var o=0;o<i.length;o++)i[o].start1+=a,i[o].start2+=a;var c=i[0],u=c.diffs;if(u.length==0||u[0][0]!=r)u.unshift(new e.Diff(r,l)),c.start1-=a,c.start2-=a,c.length1+=a,c.length2+=a;else if(a>u[0][1].length){var h=a-u[0][1].length;u[0][1]=l.substring(u[0][1].length)+u[0][1],c.start1-=h,c.start2-=h,c.length1+=h,c.length2+=h}if(c=i[i.length-1],u=c.diffs,u.length==0||u[u.length-1][0]!=r)u.push(new e.Diff(r,l)),c.length1+=a,c.length2+=a;else if(a>u[u.length-1][1].length){var h=a-u[u.length-1][1].length;u[u.length-1][1]+=l.substring(0,h),c.length1+=h,c.length2+=h}return l},e.prototype.patch_splitMax=function(i){for(var a=this.Match_MaxBits,l=0;l<i.length;l++)if(!(i[l].length1<=a)){var o=i[l];i.splice(l--,1);for(var c=o.start1,u=o.start2,h="";o.diffs.length!==0;){var f=new e.patch_obj,m=!0;for(f.start1=c-h.length,f.start2=u-h.length,h!==""&&(f.length1=f.length2=h.length,f.diffs.push(new e.Diff(r,h)));o.diffs.length!==0&&f.length1<a-this.Patch_Margin;){var p=o.diffs[0][0],_=o.diffs[0][1];p===n?(f.length2+=_.length,u+=_.length,f.diffs.push(o.diffs.shift()),m=!1):p===t&&f.diffs.length==1&&f.diffs[0][0]==r&&_.length>2*a?(f.length1+=_.length,c+=_.length,m=!1,f.diffs.push(new e.Diff(p,_)),o.diffs.shift()):(_=_.substring(0,a-f.length1-this.Patch_Margin),f.length1+=_.length,c+=_.length,p===r?(f.length2+=_.length,u+=_.length):m=!1,f.diffs.push(new e.Diff(p,_)),_==o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(_.length))}h=this.diff_text2(f.diffs),h=h.substring(h.length-this.Patch_Margin);var b=this.diff_text1(o.diffs).substring(0,this.Patch_Margin);b!==""&&(f.length1+=b.length,f.length2+=b.length,f.diffs.length!==0&&f.diffs[f.diffs.length-1][0]===r?f.diffs[f.diffs.length-1][1]+=b:f.diffs.push(new e.Diff(r,b))),m||i.splice(++l,0,f)}}},e.prototype.patch_toText=function(i){for(var a=[],l=0;l<i.length;l++)a[l]=i[l];return a.join("")},e.prototype.patch_fromText=function(i){var a=[];if(!i)return a;for(var l=i.split(`
`),o=0,c=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;o<l.length;){var u=l[o].match(c);if(!u)throw new Error("Invalid patch string: "+l[o]);var h=new e.patch_obj;for(a.push(h),h.start1=parseInt(u[1],10),u[2]===""?(h.start1--,h.length1=1):u[2]=="0"?h.length1=0:(h.start1--,h.length1=parseInt(u[2],10)),h.start2=parseInt(u[3],10),u[4]===""?(h.start2--,h.length2=1):u[4]=="0"?h.length2=0:(h.start2--,h.length2=parseInt(u[4],10)),o++;o<l.length;){var f=l[o].charAt(0);try{var m=decodeURI(l[o].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+m)}if(f=="-")h.diffs.push(new e.Diff(t,m));else if(f=="+")h.diffs.push(new e.Diff(n,m));else if(f==" ")h.diffs.push(new e.Diff(r,m));else{if(f=="@")break;if(f!=="")throw new Error('Invalid patch mode "'+f+'" in: '+m)}o++}}return a},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var i,a;this.length1===0?i=this.start1+",0":this.length1==1?i=this.start1+1:i=this.start1+1+","+this.length1,this.length2===0?a=this.start2+",0":this.length2==1?a=this.start2+1:a=this.start2+1+","+this.length2;for(var l=["@@ -"+i+" +"+a+` @@
`],o,c=0;c<this.diffs.length;c++){switch(this.diffs[c][0]){case n:o="+";break;case t:o="-";break;case r:o=" ";break}l[c+1]=o+encodeURI(this.diffs[c][1])+`
`}return l.join("").replace(/%20/g," ")},s.exports=e,s.exports.diff_match_patch=e,s.exports.DIFF_DELETE=t,s.exports.DIFF_INSERT=n,s.exports.DIFF_EQUAL=r})(rl);var sc=rl.exports;const Ie=nc(sc);class rc{constructor(){V(this,"dmp");this.dmp=new Ie}computeDiff(e,t){const n=this.dmp.diff_main(e,t);return this.dmp.diff_cleanupSemantic(n),n.map(([r,i])=>{let a;switch(r){case Ie.DIFF_EQUAL:a="equal";break;case Ie.DIFF_DELETE:a="delete";break;case Ie.DIFF_INSERT:a="insert";break;default:a="equal"}return{type:a,original:r===Ie.DIFF_INSERT?"":i,modified:r===Ie.DIFF_DELETE?"":i,accepted:!0}})}computeLineDiff(e,t){const n=this.dmp.diff_linesToChars_(e,t),r=this.dmp.diff_main(n.chars1,n.chars2);return this.dmp.diff_charsToLines_(r,n.lineArray),this.dmp.diff_cleanupSemantic(r),r.map(([i,a])=>{let l;switch(i){case Ie.DIFF_EQUAL:l="equal";break;case Ie.DIFF_DELETE:l="delete";break;case Ie.DIFF_INSERT:l="insert";break;default:l="equal"}return{type:l,original:i===Ie.DIFF_INSERT?"":a,modified:i===Ie.DIFF_DELETE?"":a,accepted:!0}})}computeInlineDiff(e,t){const n=this.dmp.diff_main(e,t);this.dmp.diff_cleanupSemantic(n);const r=[],i=[];for(const[a,l]of n)switch(a){case Ie.DIFF_EQUAL:r.push({type:"equal",text:l}),i.push({type:"equal",text:l});break;case Ie.DIFF_DELETE:r.push({type:"delete",text:l});break;case Ie.DIFF_INSERT:i.push({type:"insert",text:l});break}return{original:{fullText:e,segments:r},modified:{fullText:t,segments:i}}}getInlineStats(e){const t=e.original.segments.filter(i=>i.type==="delete").length,n=e.modified.segments.filter(i=>i.type==="insert").length,r=e.original.segments.filter(i=>i.type==="equal").length;return{total:e.original.segments.length+e.modified.segments.length,unchanged:r,modified:t+n,accepted:t+n,rejected:0}}getStats(e){const t={total:e.length,unchanged:0,modified:0,accepted:0,rejected:0};for(const n of e)n.type==="equal"?t.unchanged++:t.modified++,n.accepted?t.accepted++:t.rejected++;return t}acceptAll(e){return e.map(t=>({...t,accepted:t.type!=="delete"}))}rejectAll(e){return e.map(t=>({...t,accepted:t.type==="delete"}))}toggleAtIndex(e,t){if(t<0||t>=e.length)return e;const n=[...e];return n[t]={...n[t],accepted:!n[t].accepted},n}mergeAcceptedChanges(e){return e.map(t=>t.accepted?t.modified||"":t.original||"").join("")}createPatch(e,t){const n=this.dmp.diff_main(e,t),r=this.dmp.patch_make(e,n);return this.dmp.patch_toText(r)}applyPatch(e,t){const n=this.dmp.patch_fromText(t),r=this.dmp.patch_apply(n,e);return{result:r[0],applied:r[1].every(Boolean)}}}const kn=new rc;function yi(s,e,t){const n=s.slice();return n[35]=e[t],n}function ki(s,e,t){const n=s.slice();return n[35]=e[t],n}function Si(s,e,t){const n=s.slice();return n[40]=e[t],n}function Ci(s){let e,t=ue(s[9]),n=[];for(let r=0;r<t.length;r+=1)n[r]=Ai(Si(s,t,r));return{c(){e=w("div");for(let r=0;r<n.length;r+=1)n[r].c();g(e,"class","model-dropdown svelte-negwbs")},m(r,i){U(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(r,i){if(i[0]&525824){t=ue(r[9]);let a;for(a=0;a<t.length;a+=1){const l=Si(r,t,a);n[a]?n[a].p(l,i):(n[a]=Ai(l),n[a].c(),n[a].m(e,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=t.length}},d(r){r&&j(e),Qe(n,r)}}}function Ei(s){let e;return{c(){e=w("span"),e.textContent="âœ“",g(e,"class","check svelte-negwbs")},m(t,n){U(t,e,n)},d(t){t&&j(e)}}}function Ai(s){var y;let e,t,n=s[40].name+"",r,i,a,l,o=s[40].model+"",c,u,h,f,m,p=s[40].id===((y=s[10])==null?void 0:y.id)&&Ei();function _(){return s[26](s[40])}function b(...v){return s[27](s[40],...v)}return{c(){var v;e=w("div"),t=w("span"),r=q(n),i=A(),a=w("span"),l=q(": "),c=q(o),u=A(),p&&p.c(),h=A(),g(a,"class","model-name svelte-negwbs"),g(e,"class","dropdown-item svelte-negwbs"),g(e,"role","button"),g(e,"tabindex","0"),ce(e,"active",s[40].id===((v=s[10])==null?void 0:v.id))},m(v,E){U(v,e,E),d(e,t),d(t,r),d(e,i),d(e,a),d(a,l),d(a,c),d(e,u),p&&p.m(e,null),d(e,h),f||(m=[O(e,"click",_),O(e,"keydown",b)],f=!0)},p(v,E){var k,P;s=v,E[0]&512&&n!==(n=s[40].name+"")&&Y(r,n),E[0]&512&&o!==(o=s[40].model+"")&&Y(c,o),s[40].id===((k=s[10])==null?void 0:k.id)?p||(p=Ei(),p.c(),p.m(e,h)):p&&(p.d(1),p=null),E[0]&1536&&ce(e,"active",s[40].id===((P=s[10])==null?void 0:P.id))},d(v){v&&j(e),p&&p.d(),f=!1,Ee(m)}}}function Pi(s){let e,t,n=s[6]?"âœ• å–æ¶ˆç¼–è¾‘":"âœï¸ ç›´æŽ¥ç¼–è¾‘",r,i,a,l,o,c,u,h,f;return{c(){e=w("div"),t=w("button"),r=q(n),i=A(),a=w("button"),a.textContent="ðŸ”„ é‡æ–°ç”Ÿæˆ",l=A(),o=w("button"),o.textContent="âœ“ åº”ç”¨ä¿®æ”¹",c=A(),u=w("button"),u.textContent="å–æ¶ˆ",g(t,"class","btn-edit svelte-negwbs"),g(a,"class","btn-regenerate svelte-negwbs"),g(o,"class","btn-apply svelte-negwbs"),g(u,"class","btn-cancel svelte-negwbs"),g(e,"class","diff-actions svelte-negwbs")},m(m,p){U(m,e,p),d(e,t),d(t,r),d(e,i),d(e,a),d(e,l),d(e,o),d(e,c),d(e,u),h||(f=[O(t,"click",function(){tn(s[6]?s[15]:s[13])&&(s[6]?s[15]:s[13]).apply(this,arguments)}),O(a,"click",s[28]),O(o,"click",s[16]),O(u,"click",s[17])],h=!0)},p(m,p){s=m,p[0]&64&&n!==(n=s[6]?"âœ• å–æ¶ˆç¼–è¾‘":"âœï¸ ç›´æŽ¥ç¼–è¾‘")&&Y(r,n)},d(m){m&&j(e),h=!1,Ee(f)}}}function Di(s){let e,t,n,r,i,a,l,o,c,u,h,f,m,p,_,b,y,v,E;return{c(){e=w("div"),t=w("div"),n=w("span"),n.textContent="ðŸ’¬ é‡æ–°ç”Ÿæˆ - æ ¹æ®æ‚¨çš„è¦æ±‚è°ƒæ•´ç»“æžœ",r=A(),i=w("button"),i.textContent="âœ•",a=A(),l=w("div"),o=w("p"),o.innerHTML=`ðŸ’¡ è¾“å…¥æ‚¨çš„è¦æ±‚ï¼ŒAIå°†åŸºäºŽåŽŸæ–‡å’Œå½“å‰ç»“æžœè¿›è¡Œè°ƒæ•´ã€‚<br/>
          ä¾‹å¦‚ï¼š&quot;è¯·æ›´ç®€æ´ä¸€äº›&quot;ã€&quot;å¢žåŠ æ›´å¤šæŠ€æœ¯ç»†èŠ‚&quot;ã€&quot;è¯­æ°”æ›´æ­£å¼&quot;ç­‰ã€‚`,c=A(),u=w("textarea"),h=A(),f=w("div"),m=w("button"),m.textContent="å–æ¶ˆ",p=A(),_=w("button"),b=q("å‘é€è¯·æ±‚"),g(i,"class","btn-close svelte-negwbs"),g(t,"class","regenerate-header svelte-negwbs"),g(o,"class","regenerate-hint svelte-negwbs"),g(u,"placeholder","è¯·è¾“å…¥æ‚¨çš„ä¿®æ”¹è¦æ±‚..."),g(u,"rows","3"),g(u,"class","regenerate-input svelte-negwbs"),g(m,"class","btn-secondary svelte-negwbs"),g(_,"class","btn-primary svelte-negwbs"),_.disabled=y=!s[4].trim(),g(f,"class","regenerate-actions svelte-negwbs"),g(l,"class","regenerate-content svelte-negwbs"),g(e,"class","regenerate-panel svelte-negwbs")},m(k,P){U(k,e,P),d(e,t),d(t,n),d(t,r),d(t,i),d(e,a),d(e,l),d(l,o),d(l,c),d(l,u),te(u,s[4]),d(l,h),d(l,f),d(f,m),d(f,p),d(f,_),d(_,b),v||(E=[O(i,"click",s[29]),O(u,"input",s[30]),O(m,"click",s[31]),O(_,"click",s[18])],v=!0)},p(k,P){P[0]&16&&te(u,k[4]),P[0]&16&&y!==(y=!k[4].trim())&&(_.disabled=y)},d(k){k&&j(e),v=!1,Ee(E)}}}function ic(s){let e,t,n,r,i,a,l,o,c,u,h,f=s[6]?"ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰":"",m,p,_,b=ue(s[2].original.segments),y=[];for(let P=0;P<b.length;P+=1)y[P]=Ii(ki(s,b,P));function v(P,C){return P[6]?oc:lc}let E=v(s),k=E(s);return{c(){e=w("div"),t=w("div"),n=w("div"),n.innerHTML="<span>ðŸ“ åŽŸæ–‡</span>",r=A(),i=w("div"),a=w("div");for(let P=0;P<y.length;P+=1)y[P].c();l=A(),o=w("div"),c=w("div"),u=w("span"),h=q("âœ¨ ä¿®æ”¹åŽ "),m=q(f),p=A(),_=w("div"),k.c(),g(n,"class","panel-header svelte-negwbs"),g(a,"class","text-content svelte-negwbs"),g(i,"class","panel-content svelte-negwbs"),g(t,"class","diff-panel original svelte-negwbs"),g(c,"class","panel-header svelte-negwbs"),g(_,"class","panel-content svelte-negwbs"),g(o,"class","diff-panel modified svelte-negwbs"),ce(o,"editing",s[6]),g(e,"class","diff-content-inline svelte-negwbs")},m(P,C){U(P,e,C),d(e,t),d(t,n),d(t,r),d(t,i),d(i,a);for(let S=0;S<y.length;S+=1)y[S]&&y[S].m(a,null);d(e,l),d(e,o),d(o,c),d(c,u),d(u,h),d(u,m),d(o,p),d(o,_),k.m(_,null)},p(P,C){if(C[0]&4){b=ue(P[2].original.segments);let S;for(S=0;S<b.length;S+=1){const M=ki(P,b,S);y[S]?y[S].p(M,C):(y[S]=Ii(M),y[S].c(),y[S].m(a,null))}for(;S<y.length;S+=1)y[S].d(1);y.length=b.length}C[0]&64&&f!==(f=P[6]?"ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰":"")&&Y(m,f),E===(E=v(P))&&k?k.p(P,C):(k.d(1),k=E(P),k&&(k.c(),k.m(_,null))),C[0]&64&&ce(o,"editing",P[6])},d(P){P&&j(e),Qe(y,P),k.d()}}}function ac(s){let e;return{c(){e=w("div"),e.innerHTML='<div class="loading-spinner svelte-negwbs">â³</div> <p>æ­£åœ¨å¤„ç†ä¸­...</p>',g(e,"class","loading-content svelte-negwbs")},m(t,n){U(t,e,n)},p:ze,d(t){t&&j(e)}}}function Ii(s){let e,t=s[35].text+"",n,r;return{c(){e=w("span"),n=q(t),g(e,"class",r="segment "+Fn(s[35].type)+" svelte-negwbs")},m(i,a){U(i,e,a),d(e,n)},p(i,a){a[0]&4&&t!==(t=i[35].text+"")&&Y(n,t),a[0]&4&&r!==(r="segment "+Fn(i[35].type)+" svelte-negwbs")&&g(e,"class",r)},d(i){i&&j(e)}}}function lc(s){let e,t=ue(s[2].modified.segments),n=[];for(let r=0;r<t.length;r+=1)n[r]=Ri(yi(s,t,r));return{c(){e=w("div");for(let r=0;r<n.length;r+=1)n[r].c();g(e,"class","text-content svelte-negwbs")},m(r,i){U(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(r,i){if(i[0]&4){t=ue(r[2].modified.segments);let a;for(a=0;a<t.length;a+=1){const l=yi(r,t,a);n[a]?n[a].p(l,i):(n[a]=Ri(l),n[a].c(),n[a].m(e,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=t.length}},d(r){r&&j(e),Qe(n,r)}}}function oc(s){let e,t,n,r,i,a,l,o,c;return{c(){e=w("textarea"),n=A(),r=w("div"),i=w("button"),i.textContent="å–æ¶ˆ",a=A(),l=w("button"),l.textContent="ä¿å­˜",g(e,"class","edit-textarea svelte-negwbs"),g(e,"placeholder","åœ¨æ­¤ç›´æŽ¥ç¼–è¾‘ä¿®æ”¹åŽçš„å†…å®¹..."),g(e,"rows",t=Math.max(10,s[7].split(`
`).length)),g(i,"class","btn-secondary svelte-negwbs"),g(l,"class","btn-primary svelte-negwbs"),g(r,"class","edit-actions svelte-negwbs")},m(u,h){U(u,e,h),te(e,s[7]),U(u,n,h),U(u,r,h),d(r,i),d(r,a),d(r,l),o||(c=[O(e,"input",s[32]),O(i,"click",s[15]),O(l,"click",s[14])],o=!0)},p(u,h){h[0]&128&&t!==(t=Math.max(10,u[7].split(`
`).length))&&g(e,"rows",t),h[0]&128&&te(e,u[7])},d(u){u&&(j(e),j(n),j(r)),o=!1,Ee(c)}}}function Ri(s){let e,t=s[35].text+"",n,r;return{c(){e=w("span"),n=q(t),g(e,"class",r="segment "+Fn(s[35].type)+" svelte-negwbs")},m(i,a){U(i,e,a),d(e,n)},p(i,a){a[0]&4&&t!==(t=i[35].text+"")&&Y(n,t),a[0]&4&&r!==(r="segment "+Fn(i[35].type)+" svelte-negwbs")&&g(e,"class",r)},d(i){i&&j(e)}}}function Ti(s){let e,t,n=s[3].modified+"",r,i;return{c(){e=w("span"),t=q("å…± "),r=q(n),i=q(" å¤„ä¿®æ”¹"),g(e,"class","stats-total")},m(a,l){U(a,e,l),d(e,t),d(e,r),d(e,i)},p(a,l){l[0]&8&&n!==(n=a[3].modified+"")&&Y(r,n)},d(a){a&&j(e)}}}function cc(s){let e,t,n,r,i,a=(s[12][s[1]]||"AIå¤„ç†")+"",l,o,c,u,h=s[10]?s[10].name+" : "+s[10].model:"æœªé…ç½®",f,m,p,_,b,y,v,E,k,P,C,S,M,R,F,I=s[8]&&Ci(s),T=s[0]&&!s[11]&&Pi(s),D=s[5]&&!s[11]&&!s[6]&&Di(s);function L(H,ee){return H[11]?ac:ic}let x=L(s),G=x(s),X=s[3]&&Ti(s);return{c(){e=w("div"),t=w("div"),n=w("div"),r=w("span"),i=q("ðŸ“Š "),l=q(a),o=A(),c=w("div"),u=w("button"),f=q(h),m=A(),I&&I.c(),p=A(),T&&T.c(),_=A(),D&&D.c(),b=A(),G.c(),y=A(),v=w("div"),E=w("span"),E.innerHTML='<span class="legend-color equal svelte-negwbs"></span>æœªæ”¹å˜',k=A(),P=w("span"),P.innerHTML='<span class="legend-color delete svelte-negwbs"></span>åˆ é™¤',C=A(),S=w("span"),S.innerHTML='<span class="legend-color insert svelte-negwbs"></span>æ–°å¢ž',M=A(),X&&X.c(),g(u,"class","model-btn svelte-negwbs"),g(c,"class","model-selector svelte-negwbs"),g(n,"class","diff-title svelte-negwbs"),g(t,"class","diff-header svelte-negwbs"),g(E,"class","legend-item svelte-negwbs"),g(P,"class","legend-item svelte-negwbs"),g(S,"class","legend-item svelte-negwbs"),g(v,"class","diff-legend svelte-negwbs"),g(e,"class","diff-viewer svelte-negwbs")},m(H,ee){U(H,e,ee),d(e,t),d(t,n),d(n,r),d(r,i),d(r,l),d(n,o),d(n,c),d(c,u),d(u,f),d(c,m),I&&I.m(c,null),d(t,p),T&&T.m(t,null),d(e,_),D&&D.m(e,null),d(e,b),G.m(e,null),d(e,y),d(e,v),d(v,E),d(v,k),d(v,P),d(v,C),d(v,S),d(v,M),X&&X.m(v,null),R||(F=O(u,"click",s[20]),R=!0)},p(H,ee){ee[0]&2&&a!==(a=(H[12][H[1]]||"AIå¤„ç†")+"")&&Y(l,a),ee[0]&1024&&h!==(h=H[10]?H[10].name+" : "+H[10].model:"æœªé…ç½®")&&Y(f,h),H[8]?I?I.p(H,ee):(I=Ci(H),I.c(),I.m(c,null)):I&&(I.d(1),I=null),H[0]&&!H[11]?T?T.p(H,ee):(T=Pi(H),T.c(),T.m(t,null)):T&&(T.d(1),T=null),H[5]&&!H[11]&&!H[6]?D?D.p(H,ee):(D=Di(H),D.c(),D.m(e,b)):D&&(D.d(1),D=null),x===(x=L(H))&&G?G.p(H,ee):(G.d(1),G=x(H),G&&(G.c(),G.m(e,y))),H[3]?X?X.p(H,ee):(X=Ti(H),X.c(),X.m(v,null)):X&&(X.d(1),X=null)},i:ze,o:ze,d(H){H&&j(e),I&&I.d(),T&&T.d(),D&&D.d(),G.d(),X&&X.d(),R=!1,F()}}}function Fn(s){switch(s){case"equal":return"equal";case"delete":return"delete";case"insert":return"insert";default:return"equal"}}function uc(s,e,t){let n,r,{original:i}=e,{modified:a}=e,{selectedText:l=""}=e,{showActions:o=!0}=e,{operationType:c="polish"}=e,{blockId:u=""}=e;const h=ul();let f,m,p="",_=!1,b=!1,y="",v=!1,E=[],k=null;const P={chat:"å¯¹è¯",polish:"æ¶¦è‰²",translate:"ç¿»è¯‘",summarize:"æ€»ç»“",expand:"æ‰©å†™",condense:"ç²¾ç®€",rewrite:"æ”¹å†™",continue:"ç»­å†™",custom1:"è‡ªå®šä¹‰1",custom2:"è‡ªå®šä¹‰2",custom3:"è‡ªå®šä¹‰3"};Ss(()=>{C()});function C(){const K=Q.getSettings();t(9,E=K.providers),t(10,k=Q.getCurrentProvider())}function S(){t(7,y=a),t(6,b=!0),C()}function M(){t(21,a=y),t(6,b=!1),t(2,f=kn.computeInlineDiff(i,a)),t(3,m=kn.getInlineStats(f))}function R(){t(6,b=!1),t(7,y="")}function F(){h("apply",a)}function I(){h("cancel")}function T(){if(!p.trim()){alert("è¯·è¾“å…¥ä¿®æ”¹è¦æ±‚");return}h("regenerate",{instruction:p,original:n,currentModified:a}),t(4,p=""),t(5,_=!1)}function D(K){h("switchModel",K),t(8,v=!1),C()}function L(){t(8,v=!v),C()}const x=K=>D(K.id),G=(K,Se)=>Se.key==="Enter"&&D(K.id),X=()=>t(5,_=!_),H=()=>t(5,_=!1);function ee(){p=this.value,t(4,p)}const ae=()=>t(5,_=!1);function Te(){y=this.value,t(7,y)}return s.$$set=K=>{"original"in K&&t(22,i=K.original),"modified"in K&&t(21,a=K.modified),"selectedText"in K&&t(23,l=K.selectedText),"showActions"in K&&t(0,o=K.showActions),"operationType"in K&&t(1,c=K.operationType),"blockId"in K&&t(24,u=K.blockId)},s.$$.update=()=>{s.$$.dirty[0]&12582912&&t(25,n=l||i),s.$$.dirty[0]&2097152&&t(11,r=a.startsWith("â³")||a===""||a===null||a===void 0),s.$$.dirty[0]&35651588&&(t(2,f=kn.computeInlineDiff(n,a)),t(3,m=kn.getInlineStats(f)))},[o,c,f,m,p,_,b,y,v,E,k,r,P,S,M,R,F,I,T,D,L,a,i,l,u,n,x,G,X,H,ee,ae,Te]}class hc extends Es{constructor(e){super(),Cs(this,e,uc,cc,ks,{original:22,modified:21,selectedText:23,showActions:0,operationType:1,blockId:24},null,[-1,-1])}}class fc{constructor(e){V(this,"toolbarElement",null);V(this,"options");V(this,"isVisible",!1);V(this,"hideTimeout",null);V(this,"currentSelection","");V(this,"currentBlockId",null);V(this,"currentSelectionStart",-1);V(this,"currentSelectionEnd",-1);V(this,"modelDropdownElement",null);V(this,"isDragging",!1);V(this,"dragOffsetX",0);V(this,"dragOffsetY",0);V(this,"isPinned",!1);V(this,"mouseUpHandler",null);V(this,"mouseDownHandler",null);V(this,"scrollHandler",null);V(this,"keyDownHandler",null);V(this,"mouseMoveHandler",null);V(this,"globalMouseUpHandler",null);this.options=e,this.bindEvents()}bindEvents(){let e;this.mouseUpHandler=t=>{clearTimeout(e),e=window.setTimeout(()=>{this.handleSelectionChange(t)},200)},this.mouseDownHandler=t=>{const n=t.target;this.modelDropdownElement&&!this.modelDropdownElement.contains(n)&&this.hideModelDropdown(),this.toolbarElement&&!this.toolbarElement.contains(n)&&this.hide()},this.scrollHandler=()=>{this.hide(),this.hideModelDropdown()},this.keyDownHandler=t=>{t.key==="Escape"&&(this.hideModelDropdown(),this.hide())},document.addEventListener("mouseup",this.mouseUpHandler),document.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("scroll",this.scrollHandler,!0),document.addEventListener("keydown",this.keyDownHandler)}handleSelectionChange(e){if(!Q.getSettings().showFloatingToolbar||!e.target.closest(".protyle-wysiwyg"))return;const r=window.getSelection();if(!r||r.rangeCount===0){this.hide();return}const i=r.toString().trim();if(i.length<1){this.hide();return}this.currentBlockId=kt.getCurrentBlockId(),this.calculateSelectionIndices(r,i),this.currentSelection=i,this.show(e,i)}calculateSelectionIndices(e,t){var p;this.currentSelectionStart=-1,this.currentSelectionEnd=-1;const n=e.getRangeAt(0),r=n.commonAncestorContainer;let i=r.nodeType===Node.ELEMENT_NODE?r:r.parentElement,a=null;for(;i;){if(i.classList&&i.classList.contains("p")){a=i;break}i=i.parentElement}if(!a)return;const l=a.textContent||"",o=e.toString();let c=0,u=0;const h=document.createRange();h.selectNodeContents(a),h.setEnd(n.startContainer,n.startOffset);const f=document.createElement("div");if(f.appendChild(h.cloneContents()),c=((p=f.textContent)==null?void 0:p.length)||0,u=c+o.length,this.currentSelectionStart=c,this.currentSelectionEnd=u,l.substring(c,u)!==o){const _=l.indexOf(o);_!==-1&&(this.currentSelectionStart=_,this.currentSelectionEnd=_+o.length)}}show(e,t){if(this.toolbarElement||this.createToolbar(),!this.toolbarElement)return;if(this.isPinned){this.toolbarElement.style.display="block",this.toolbarElement.classList.add("show"),this.isVisible=!0;return}this.refreshToolbar();const n=window.getSelection();if(!n||n.rangeCount===0)return;const i=n.getRangeAt(0).getBoundingClientRect(),a=this.toolbarElement.offsetHeight||50,l=this.toolbarElement.offsetWidth||300;let o=i.top-a-10,c=i.left+i.width/2-l/2;o<10&&(o=i.bottom+15),c<10&&(c=10),c+l>window.innerWidth-10&&(c=window.innerWidth-l-10),o+a>window.innerHeight-10&&o>i.bottom+10&&(o=i.top,c=i.right+10,c+l>window.innerWidth-10&&(c=i.left-l-10)),this.toolbarElement.style.top=`${o+window.scrollY}px`,this.toolbarElement.style.left=`${c+window.scrollX}px`,this.toolbarElement.style.display="block",this.toolbarElement.classList.add("show"),this.isVisible=!0,this.resetHideTimeout()}hide(){!this.toolbarElement||!this.isVisible||this.isPinned||(this.toolbarElement.classList.remove("show"),this.toolbarElement.style.display="none",this.isVisible=!1,this.currentSelection="",this.currentBlockId=null,this.currentSelectionStart=-1,this.currentSelectionEnd=-1,this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null))}forceHide(){!this.toolbarElement||!this.isVisible||(this.toolbarElement.classList.remove("show"),this.toolbarElement.style.display="none",this.isVisible=!1,this.isPinned=!1,this.currentSelection="",this.currentBlockId=null,this.currentSelectionStart=-1,this.currentSelectionEnd=-1,this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null))}resetHideTimeout(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(()=>{this.hide(),this.hideModelDropdown()},1e4)}refreshToolbar(){if(!this.toolbarElement)return;const e=Q.getSettings(),t=Q.getCurrentProvider(),n=e.toolbarButtons,r=this.toolbarElement.querySelector(".provider-name");r&&(r.textContent=t?`${t.name} : ${t.model}`:"âš ï¸ æœªé…ç½®");const i=this.toolbarElement.querySelector(".toolbar-buttons");if(i){i.innerHTML="";const a=[{type:"polish",label:"æ¶¦è‰²",icon:"âœ¨",enabled:n.polish},{type:"translate",label:"ç¿»è¯‘",icon:"ðŸŒ",enabled:n.translate},{type:"summarize",label:"æ€»ç»“",icon:"ðŸ“",enabled:n.summarize},{type:"expand",label:"æ‰©å†™",icon:"ðŸ“–",enabled:n.expand},{type:"condense",label:"ç²¾ç®€",icon:"ðŸ“„",enabled:n.condense},{type:"rewrite",label:"æ”¹å†™",icon:"ðŸ”„",enabled:n.rewrite},{type:"continue",label:"ç»­å†™",icon:"âž¡ï¸",enabled:n.continue}];e.customButtons.forEach((l,o)=>{if(l.enabled){const c=`custom${o+1}`;a.push({type:`custom${o+1}`,label:l.name,icon:l.icon,enabled:n[c]||!1})}}),a.filter(l=>l.enabled).forEach(l=>{const o=document.createElement("button");o.className="toolbar-btn",o.innerHTML=`<span class="icon">${l.icon}</span><span>${l.label}</span>`,o.addEventListener("click",()=>this.handleOperation(l.type)),i.appendChild(o)})}}createModelDropdown(){this.modelDropdownElement&&(this.modelDropdownElement.remove(),this.modelDropdownElement=null);const e=Q.getSettings(),t=e.providers,n=e.currentProviderId;if(t.length===0)return;const r=document.createElement("div");r.className="ai-model-dropdown",r.style.cssText=`
            position: fixed;
            z-index: 10000;
            background: var(--b3-theme-background, #fff);
            border: 1px solid var(--b3-border-color, #e0e0e0);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            max-height: 200px;
            overflow-y: auto;
            min-width: 200px;
            padding: 4px 0;
        `,t.forEach(i=>{const a=document.createElement("div");a.className="dropdown-item";const l=i.id===n;a.style.cssText=`
                padding: 10px 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                color: var(--b3-theme-on-background, #333);
            `,l&&(a.style.background="var(--b3-theme-primary-light, rgba(66, 133, 244, 0.1))"),a.innerHTML=`
                <span>${i.name}</span>
                <span style="color: var(--b3-theme-on-surface, #666); font-size: 12px;">: ${i.model}</span>
                ${l?'<span style="margin-left: auto; color: var(--b3-theme-success, #22c55e);">âœ“</span>':""}
            `,a.addEventListener("click",async o=>{o.stopPropagation(),await Q.setCurrentProvider(i.id),ge.setProvider(i),this.refreshToolbar(),this.hideModelDropdown()}),a.addEventListener("mouseenter",()=>{a.style.background="var(--b3-theme-hover, rgba(0, 0, 0, 0.05))"}),a.addEventListener("mouseleave",()=>{l||(a.style.background="")}),r.appendChild(a)}),document.body.appendChild(r),this.modelDropdownElement=r}showModelDropdown(){if(!this.toolbarElement||(this.hideModelDropdown(),this.createModelDropdown(),!this.modelDropdownElement))return;const e=this.toolbarElement.querySelector(".provider-name");if(!e)return;const t=e.getBoundingClientRect();this.modelDropdownElement.style.top=`${t.bottom+5}px`,this.modelDropdownElement.style.left=`${t.left}px`}hideModelDropdown(){this.modelDropdownElement&&(this.modelDropdownElement.remove(),this.modelDropdownElement=null)}createToolbar(){var u,h;const e=document.createElement("div");e.className="ai-floating-toolbar",e.style.cssText=`
            position: fixed;
            display: none;
            z-index: 9999;
            background: var(--b3-theme-background, #fff);
            border: 1px solid var(--b3-border-color, #e0e0e0);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 8px;
            font-family: var(--b3-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            user-select: none;
        `;const t=Q.getCurrentProvider(),n=t?`${t.name} : ${t.model}`:"âš ï¸ æœªé…ç½®",r=document.createElement("div");r.className="toolbar-header",r.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--b3-border-color, #e0e0e0); cursor: move;",r.innerHTML=`
            <span class="drag-handle" style="cursor: move; padding: 2px 4px; margin-right: 4px; color: var(--b3-theme-on-surface, #999);">â‹®â‹®</span>
            <span class="provider-name" style="cursor: pointer; font-weight: 500; font-size: 12px; color: var(--b3-theme-on-surface, #666); flex: 1;" title="ç‚¹å‡»åˆ‡æ¢æ¨¡åž‹">${n}</span>
            <button class="btn-pin" style="background: none; border: none; cursor: pointer; font-size: 12px; padding: 2px 6px; margin-right: 4px; opacity: 0.6;" title="å›ºå®šä½ç½®">ðŸ“Œ</button>
            <button class="btn-settings" style="background: none; border: none; cursor: pointer; font-size: 14px; padding: 2px 6px;" title="è®¾ç½®">âš™ï¸</button>
            <button class="btn-close" style="background: none; border: none; cursor: pointer; font-size: 12px; padding: 2px 6px; margin-left: 4px; color: var(--b3-theme-on-surface, #999);" title="å…³é—­">âœ•</button>
        `;const i=r.querySelector(".drag-handle"),a=f=>{f.addEventListener("mousedown",m=>{(m.target===f||m.target===r||m.target.classList.contains("provider-name"))&&(m.preventDefault(),this.isDragging=!0,this.dragOffsetX=m.clientX-e.offsetLeft,this.dragOffsetY=m.clientY-e.offsetTop,e.style.cursor="grabbing")})};a(r),i&&a(i);const l=r.querySelector(".btn-pin");l&&l.addEventListener("click",f=>{f.stopPropagation(),this.isPinned=!this.isPinned,l.style.opacity=this.isPinned?"1":"0.6",l.textContent=this.isPinned?"ðŸ“":"ðŸ“Œ",l.title=this.isPinned?"å·²å›ºå®šï¼Œç‚¹å‡»å–æ¶ˆå›ºå®š":"å›ºå®šä½ç½®"});const o=r.querySelector(".btn-close");o&&o.addEventListener("click",f=>{f.stopPropagation(),this.forceHide()}),(u=r.querySelector(".provider-name"))==null||u.addEventListener("click",f=>{f.stopPropagation(),this.showModelDropdown()}),(h=r.querySelector(".btn-settings"))==null||h.addEventListener("click",()=>{this.hideModelDropdown(),this.options.onOpenSettings(),this.forceHide()}),e.appendChild(r);const c=document.createElement("div");c.className="toolbar-buttons",c.style.cssText="display: flex; gap: 4px; flex-wrap: wrap;",e.appendChild(c),this.refreshToolbar(),document.body.appendChild(e),this.toolbarElement=e,this.mouseMoveHandler=f=>{if(this.isDragging&&this.toolbarElement){f.preventDefault();const m=f.clientX-this.dragOffsetX,p=f.clientY-this.dragOffsetY,_=window.innerWidth-this.toolbarElement.offsetWidth-10,b=window.innerHeight-this.toolbarElement.offsetHeight-10;this.toolbarElement.style.left=`${Math.max(10,Math.min(m,_))}px`,this.toolbarElement.style.top=`${Math.max(10,Math.min(p,b))}px`}},this.globalMouseUpHandler=()=>{this.isDragging&&(this.isDragging=!1,this.toolbarElement&&(this.toolbarElement.style.cursor="default"))},document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.globalMouseUpHandler),e.addEventListener("mouseenter",()=>{this.hideTimeout&&clearTimeout(this.hideTimeout)}),e.addEventListener("mouseleave",()=>{this.resetHideTimeout()})}async handleOperation(e){var o;if(!this.currentSelection)return;const n=Q.getSettings().customButtons.find(c=>c.id===e),r=n==null?void 0:n.prompt;let i="";if(this.currentBlockId){const c=await kt.getBlockContent(this.currentBlockId);i=(c==null?void 0:c.content)||""}i||(i=this.getFullBlockContentFromDOM()),i||(i=this.currentSelection);let a="";i!==this.currentSelection?a={polish:`è¯·æ¶¦è‰²ä»¥ä¸‹æ–‡æœ¬çš„é€‰ä¸­éƒ¨åˆ†ï¼Œåªè¿”å›žæ¶¦è‰²åŽçš„é€‰ä¸­éƒ¨åˆ†æ–‡æœ¬ï¼Œä¸è¦è§£é‡Šï¼š

é€‰ä¸­éƒ¨åˆ†ï¼š${this.currentSelection}`,translate:`è¯·ç¿»è¯‘ä»¥ä¸‹æ–‡æœ¬çš„é€‰ä¸­éƒ¨åˆ†ï¼Œåªè¿”å›žç¿»è¯‘åŽçš„é€‰ä¸­éƒ¨åˆ†æ–‡æœ¬ï¼Œä¸è¦è§£é‡Šï¼š

é€‰ä¸­éƒ¨åˆ†ï¼š${this.currentSelection}`,summarize:`è¯·æ€»ç»“ä»¥ä¸‹æ–‡æœ¬ï¼Œåªè¿”å›žæ€»ç»“å†…å®¹ï¼š

${i}`,expand:`è¯·æ‰©å†™ä»¥ä¸‹æ–‡æœ¬ï¼š

${i}`,condense:`è¯·ç²¾ç®€ä»¥ä¸‹æ–‡æœ¬ï¼š

${i}`,rewrite:`è¯·æ”¹å†™ä»¥ä¸‹æ–‡æœ¬ï¼š

${i}`,continue:`è¯·ç»­å†™ä»¥ä¸‹æ–‡æœ¬ï¼š

${i}`}[e]||r||`${e}: ${this.currentSelection}`:a=r||"",this.options.onOperationStart(e,i,this.currentBlockId||void 0,this.currentSelection,this.currentSelectionStart,this.currentSelectionEnd);try{this.setLoading(!0);const c=ge.buildOperationMessages(this.currentSelection,e,a),u=await((o=ge.adapter)==null?void 0:o.chatCompletion(c));u&&this.options.onOperation(e,i,u.content,this.currentBlockId||void 0,this.currentSelection,this.currentSelectionStart,this.currentSelectionEnd)}catch{alert("æ“ä½œå¤±è´¥ï¼Œè¯·æ£€æŸ¥AIæä¾›å•†é…ç½®")}finally{this.setLoading(!1),this.hide()}}getFullBlockContentFromDOM(){const e=window.getSelection();if(!e||e.rangeCount===0)return"";const n=e.getRangeAt(0).commonAncestorContainer;let r=n.nodeType===Node.ELEMENT_NODE?n:n.parentElement;for(;r;){if(r.classList&&r.classList.contains("p"))return r.textContent||"";r=r.parentElement}return this.currentSelection}setLoading(e){if(!this.toolbarElement)return;this.toolbarElement.querySelectorAll(".toolbar-btn").forEach(n=>{n.disabled=e,e?n.classList.add("loading"):n.classList.remove("loading")})}getCurrentSelection(){return this.currentSelection}getCurrentBlockId(){return this.currentBlockId}destroy(){this.hide(),this.hideModelDropdown(),this.mouseUpHandler&&(document.removeEventListener("mouseup",this.mouseUpHandler),this.mouseUpHandler=null),this.mouseDownHandler&&(document.removeEventListener("mousedown",this.mouseDownHandler),this.mouseDownHandler=null),this.scrollHandler&&(document.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null),this.keyDownHandler&&(document.removeEventListener("keydown",this.keyDownHandler),this.keyDownHandler=null),this.mouseMoveHandler&&(document.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseMoveHandler=null),this.globalMouseUpHandler&&(document.removeEventListener("mouseup",this.globalMouseUpHandler),this.globalMouseUpHandler=null),this.toolbarElement&&(this.toolbarElement.remove(),this.toolbarElement=null)}}class dc{constructor(e){V(this,"options");V(this,"menuElement",null);this.options=e}injectIntoBlockMenu(e){var l;if(!Q.getSettings().showContextMenu)return;const n=e.detail;if(!((l=n==null?void 0:n.menu)!=null&&l.element))return;const r=n.menu,i=n.blockId;if(!i)return;r.addItem({type:"separator"});const a=[{label:"âœ¨ æ¶¦è‰²æ–‡æœ¬",click:()=>this.options.onOperation("polish",i)},{label:"ðŸŒ ç¿»è¯‘æ–‡æœ¬",click:()=>this.options.onOperation("translate",i)},{label:"ðŸ“ æ€»ç»“å†…å®¹",click:()=>this.options.onOperation("summarize",i)},{label:"ðŸ“– æ‰©å†™å†…å®¹",click:()=>this.options.onOperation("expand",i)},{type:"separator"},{label:"âš™ï¸ AIåŠ©æ‰‹è®¾ç½®",click:()=>this.options.onOpenSettings()}];r.addItem({label:"ðŸ¤– AIåŠ©æ‰‹",submenu:a})}showForSelection(e,t,n){this.hide();const r=document.createElement("div");r.className="ai-context-menu",r.style.cssText=`
            position: fixed;
            z-index: 9999;
            background: var(--b3-theme-background);
            border: 1px solid var(--b3-border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 4px 0;
            min-width: 160px;
            font-family: var(--b3-font-family);
            font-size: 14px;
        `,[{label:"âœ¨ æ¶¦è‰²",action:n.onPolish},{label:"ðŸŒ ç¿»è¯‘",action:n.onTranslate},{label:"ðŸ“ æ€»ç»“",action:n.onSummarize},{label:"ðŸ“– æ‰©å†™",action:n.onExpand}].forEach(o=>{const c=document.createElement("div");c.className="ai-context-menu-item",c.textContent=o.label,c.style.cssText=`
                padding: 8px 16px;
                cursor: pointer;
                transition: background 0.15s;
            `,c.addEventListener("mouseenter",()=>{c.style.background="var(--b3-theme-hover)"}),c.addEventListener("mouseleave",()=>{c.style.background="transparent"}),c.addEventListener("click",()=>{o.action(),this.hide()}),r.appendChild(c)}),r.style.left=`${e.clientX}px`,r.style.top=`${e.clientY}px`;const a=r.getBoundingClientRect();a.right>window.innerWidth&&(r.style.left=`${e.clientX-a.width}px`),a.bottom>window.innerHeight&&(r.style.top=`${e.clientY-a.height}px`),document.body.appendChild(r),this.menuElement=r;const l=o=>{r.contains(o.target)||(this.hide(),document.removeEventListener("mousedown",l))};setTimeout(()=>{document.addEventListener("mousedown",l)},0)}hide(){this.menuElement&&(this.menuElement.remove(),this.menuElement=null)}destroy(){this.hide()}}function Mi(s){const{title:e,content:t,width:n="600px",height:r="auto",destroyCallback:i}=s;let a;typeof t=="string"?a=t:a='<div class="ai-dialog-content-placeholder"></div>';const l=new Oi.Dialog({title:e,content:a,width:n,height:r,destroyCallback:i});if(typeof t!="string"){const o=[".b3-dialog__body",".b3-dialog__content",".b3-dialog .b3-dialog__body",".b3-dialog .b3-dialog__content"];let c=null;for(const h of o)if(c=l.element.querySelector(h),c)break;c||(c=l.element);const u=c.querySelector(".ai-dialog-content-placeholder");u?u.replaceWith(t):c.appendChild(t)}return l}const mc="siyuan-ai-assistant",pc="ai_assistant_dock";class gc extends Oi.Plugin{constructor(){super(...arguments);V(this,"floatingToolbar",null);V(this,"contextMenuManager",null);V(this,"settingsDialog",null);V(this,"diffDialog",null);V(this,"chatPanelComponent",null);V(this,"currentDiffViewer",null);V(this,"currentOriginalText","");V(this,"currentSelectedText","");V(this,"currentSelectionStart",-1);V(this,"currentSelectionEnd",-1);V(this,"blockIconClickHandler",null)}async onload(){Q.init(this),await Q.loadSettings();const t=Q.getCurrentProvider();t&&ge.setProvider(t),this.addIcons(`
            <symbol id="iconAIAssistant" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                <circle cx="12" cy="12" r="3" fill="currentColor"/>
            </symbol>
            <symbol id="iconSparkles" viewBox="0 0 24 24">
                <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
            </symbol>
        `),this.addDock({config:{position:"RightBottom",size:{width:320,height:500},icon:"iconAIAssistant",title:this.i18n.title||"AIåŠ©æ‰‹"},data:{text:this.i18n.title||"AIåŠ©æ‰‹"},type:pc,init:n=>{this.initChatPanel(n.element)}}),this.initFloatingToolbar(),this.initContextMenu()}onLayoutReady(){const t=Q.getCurrentProvider();t&&ge.setProvider(t)}onunload(){this.floatingToolbar&&(this.floatingToolbar.destroy(),this.floatingToolbar=null),this.contextMenuManager&&(this.contextMenuManager.destroy(),this.contextMenuManager=null),this.settingsDialog&&(this.settingsDialog.destroy(),this.settingsDialog=null),this.diffDialog&&(this.diffDialog.destroy(),this.diffDialog=null),this.chatPanelComponent&&(this.chatPanelComponent.$destroy(),this.chatPanelComponent=null),this.blockIconClickHandler&&(this.eventBus.off("click-blockicon",this.blockIconClickHandler),this.blockIconClickHandler=null)}async uninstall(){await this.removeData(mc)}openSetting(){this.openSettings()}initChatPanel(t){t.style.height="100%",t.style.overflow="hidden";const n=new jo({target:t,props:{onOpenSettings:()=>this.openSettings()}});this.chatPanelComponent=n}initFloatingToolbar(){this.floatingToolbar=new fc({onOperation:(t,n,r,i,a,l,o)=>{this.updateDiffViewer(r,n,a,l,o)},onOperationStart:(t,n,r,i,a,l)=>{this.showDiffViewer(n,"â³ æ­£åœ¨è¯·æ±‚AIå¤„ç†...",t,r,i,a,l)},onOpenSettings:()=>this.openSettings()})}initContextMenu(){this.contextMenuManager=new dc({onOperation:async(t,n)=>{const r=await kt.getBlockContent(n);if(r)try{const i=await ge.processText(r.content,t);this.showDiffViewer(r.content,i.content,t,n)}catch{alert("æ“ä½œå¤±è´¥ï¼Œè¯·æ£€æŸ¥AIæä¾›å•†é…ç½®")}},onOpenSettings:()=>this.openSettings()}),this.blockIconClickHandler=t=>{var n;(n=this.contextMenuManager)==null||n.injectIntoBlockMenu(t)},this.eventBus.on("click-blockicon",this.blockIconClickHandler)}openSettings(){this.settingsDialog&&this.settingsDialog.destroy();const t=document.createElement("div");t.style.height="500px",new tc({target:t,props:{onClose:()=>{var n;(n=this.settingsDialog)==null||n.destroy(),this.settingsDialog=null}}}),this.settingsDialog=Mi({title:"AIåŠ©æ‰‹è®¾ç½®",content:t,width:"600px",height:"500px",destroyCallback:()=>{this.settingsDialog=null}})}showDiffViewer(t,n,r,i,a,l,o){this.diffDialog&&this.diffDialog.destroy();const c=i;this.currentOriginalText=t,this.currentSelectedText=a||"",this.currentSelectionStart=l??-1,this.currentSelectionEnd=o??-1;const u=document.createElement("div");this.currentDiffViewer=new hc({target:u,props:{original:t,modified:n,selectedText:a||"",operationType:r,blockId:i||""}}),this.currentDiffViewer.$on("apply",async f=>{var p,_;const m=f.detail;if(this.currentOriginalText){let b;if(this.currentSelectionStart>=0&&this.currentSelectionEnd>this.currentSelectionStart){const y=this.currentOriginalText.substring(0,this.currentSelectionStart),v=this.currentOriginalText.substring(this.currentSelectionEnd);b=y+m+v}else{const v=kt.getSelectedText()||this.currentSelectedText||this.currentOriginalText;b=this.currentOriginalText;const E=v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),k=new RegExp(E,"");if(k.test(b))b=b.replace(k,m);else{const P=v.trim(),C=new RegExp(P.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"");if(C.test(b))b=b.replace(C,m);else{alert("åº”ç”¨å¤±è´¥ï¼šæ— æ³•åœ¨åŽŸæ–‡ä¸­æ‰¾åˆ°é€‰ä¸­çš„æ–‡å­—"),(p=this.diffDialog)==null||p.destroy(),this.diffDialog=null;return}}}c?await kt.updateBlock(c,b)||alert("åº”ç”¨ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•"):alert("æ— æ³•ç¡®å®šè¦æ›´æ–°çš„æ–‡æœ¬å—")}else c&&(await kt.updateBlock(c,m)||alert("åº”ç”¨ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•"));(_=this.diffDialog)==null||_.destroy(),this.diffDialog=null}),this.currentDiffViewer.$on("cancel",()=>{var f;(f=this.diffDialog)==null||f.destroy(),this.diffDialog=null,this.currentDiffViewer=null}),this.currentDiffViewer.$on("regenerate",async f=>{var b;const{instruction:m,original:p,currentModified:_}=f.detail;this.updateDiffViewer("â³ æ­£åœ¨é‡æ–°ç”Ÿæˆ...");try{const y=[{role:"system",content:"ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å†™ä½œåŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„è¦æ±‚ï¼Œç»“åˆåŽŸæ–‡ï¼Œç”Ÿæˆæ›´å¥½çš„å†…å®¹ã€‚åªè¾“å‡ºç”ŸæˆåŽçš„æ–‡æœ¬ï¼Œä¸è¦æœ‰ä»»ä½•è§£é‡Šã€‚"},{role:"user",content:`ã€åŽŸæ–‡ã€‘
${p}

ã€ç”¨æˆ·è¦æ±‚ã€‘
${m}

è¯·æ ¹æ®è¦æ±‚é‡æ–°ç”Ÿæˆå†…å®¹ï¼Œç›´æŽ¥è¾“å‡ºæ–‡æœ¬ï¼Œæ— éœ€è§£é‡Šã€‚`}],v=await((b=ge.adapter)==null?void 0:b.chatCompletion(y));v&&v.content?this.updateDiffViewer(v.content):(alert("é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•"),this.updateDiffViewer(_))}catch{alert("é‡æ–°ç”Ÿæˆæ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥AIæä¾›å•†é…ç½®"),this.updateDiffViewer(_)}}),this.currentDiffViewer.$on("switchModel",async f=>{var p;const m=f.detail;try{await Q.setCurrentProvider(m),ge.setProvider(Q.getCurrentProvider()),this.updateDiffViewer("â³ æ­£åœ¨ä½¿ç”¨æ–°æ¨¡åž‹é‡æ–°å¤„ç†...");const _=ge.buildOperationMessages(t,r),b=await((p=ge.adapter)==null?void 0:p.chatCompletion(_));b&&b.content?this.updateDiffViewer(b.content):alert("ä½¿ç”¨æ–°æ¨¡åž‹å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•")}catch{alert("åˆ‡æ¢æ¨¡åž‹å¤±è´¥")}});const h={chat:"å¯¹è¯",polish:"æ¶¦è‰²",translate:"ç¿»è¯‘",summarize:"æ€»ç»“",expand:"æ‰©å†™",condense:"ç²¾ç®€",rewrite:"æ”¹å†™",continue:"ç»­å†™",custom1:"è‡ªå®šä¹‰1",custom2:"è‡ªå®šä¹‰2",custom3:"è‡ªå®šä¹‰3"};this.diffDialog=Mi({title:`${h[r]||"AI"}ç»“æžœ - å·®å¼‚å¯¹æ¯”`,content:u,width:"800px",height:"600px",destroyCallback:()=>{this.diffDialog=null,this.currentDiffViewer=null}})}updateDiffViewer(t,n,r,i,a){if(this.currentDiffViewer){const l={modified:t};r!==void 0&&(l.selectedText=r),n!==void 0&&(l.original=n),this.currentDiffViewer.$set(l),r&&(this.currentSelectedText=r),n&&(this.currentOriginalText=n),i!==void 0&&i>=0&&(this.currentSelectionStart=i),a!==void 0&&a>=0&&(this.currentSelectionEnd=a)}}}exports.default=gc;
